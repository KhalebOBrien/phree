;(function() { ;(function(){"undefined"==typeof document||"classList"in document.documentElement||function(view){"use strict";if("HTMLElement"in view||"Element"in view){var classListProp="classList",protoProp="prototype",elemCtrProto=(view.HTMLElement||view.Element)[protoProp],objCtr=Object,strTrim=String[protoProp].trim||function(){return this.replace(/^\s+|\s+$/g,"")},arrIndexOf=Array[protoProp].indexOf||function(item){for(var i=0,len=this.length;i<len;i++)if(i in this&&this[i]===item)return i;return-1},DOMEx=function(type,message){this.name=type,this.code=DOMException[type],this.message=message},checkTokenAndGetIndex=function(classList,token){if(""===token)throw new DOMEx("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(token))throw new DOMEx("INVALID_CHARACTER_ERR","String contains an invalid character");return arrIndexOf.call(classList,token)},ClassList=function(elem){for(var trimmedClasses=strTrim.call(elem.className),classes=trimmedClasses?trimmedClasses.split(/\s+/):[],i=0,len=classes.length;i<len;i++)this.push(classes[i]);this._updateClassName=function(){elem.className=this.toString()}},classListProto=ClassList[protoProp]=[],classListGetter=function(){return new ClassList(this)};if(DOMEx[protoProp]=Error[protoProp],classListProto.item=function(i){return this[i]||null},classListProto.contains=function(token){return token+="",-1!==checkTokenAndGetIndex(this,token)},classListProto.add=function(){var tokens=arguments,i=0,l=tokens.length,updated=!1,token;do token=tokens[i]+"",-1===checkTokenAndGetIndex(this,token)&&(this.push(token),updated=!0);while(++i<l);updated&&this._updateClassName()},classListProto.remove=function(){var tokens=arguments,i=0,l=tokens.length,updated=!1,token;do{token=tokens[i]+"";var index=checkTokenAndGetIndex(this,token);-1!==index&&(this.splice(index,1),updated=!0)}while(++i<l);updated&&this._updateClassName()},classListProto.toggle=function(token,forse){token+="";var result=this.contains(token),method=result?!0!==forse&&"remove":!1!==forse&&"add";return method&&this[method](token),!result},classListProto.toString=function(){return this.join(" ")},objCtr.defineProperty){var classListPropDesc={get:classListGetter,enumerable:!0,configurable:!0};try{objCtr.defineProperty(elemCtrProto,classListProp,classListPropDesc)}catch(ex){-2146823252===ex.number&&(classListPropDesc.enumerable=!1,objCtr.defineProperty(elemCtrProto,classListProp,classListPropDesc))}}else objCtr[protoProp].__defineGetter__&&elemCtrProto.__defineGetter__(classListProp,classListGetter)}}(self),window.paper=new function(undefined){function tkinter(){this.Tk=function(){}}function TextInput(callback,x,y){callback=callback||function(){},x=x||20,y=y||paper.view.bounds.height-20;var message=new PointText(x,y-20);message.content="",message.fontSize=15,message.fontFamily="monospace";var input=new PointText(x,y);input.content="",input.fontSize=15,input.fontFamily="monospace";var cursor=new Shape.Rectangle(x+5,y-11,8,14);cursor.fillColor="grey",cursor.strokeColor="grey";var cursorCount=0,cursorFilled=!0;cursor.onFrame=function(){cursorCount++,50==cursorCount&&(cursorCount=0,cursorFilled?(cursor.fillColor="white",cursorFilled=!1):(cursor.fillColor="grey",cursorFilled=!0))};var tool=new paper.Tool;return tool.onKeyDown=function(event){input.content+=event.character,"backspace"==event.key?input.content=input.content.slice(0,-1):"enter"==event.key&&(callback(input.content),input.content=""),cursor.position.x=input.bounds.width+x+5},input.setMessage=input.set_message=function(msg){message.content=msg},input.clearMessage=input.clear_message=function(){message.content=""},input}function Turtle(){function createPath(){path=new Path(t.position),path.strokeColor=t.strokeColor,path.strokeWidth=t.strokeWidth,path.strokeCap=t.strokeCap,t.bringToFront()}function getColor(c){return Array.isArray(c)?[c[0]/255,c[1]/255,c[2]/255]:c}var DEFAULT_ANIMATE=200,animate=DEFAULT_ANIMATE,stack=[],started=!1,step=[],t=new Raster(ai.m.turtleImagePath,Game.getBounds().width/2,Game.getBounds().height/2),path;t.scaling=0.5,t.strokeColor="green",t.fillColor="green",t.strokeWidth=1,t.strokeCap="round";var that=this;return this.__eq__=function(obj){return this===obj},this.setColor=this.color=function(penColor,fillColor){this._addCommand(function(){this.setPenColor(penColor),this.setFillColor(fillColor||penColor)})},this.setPenColor=this.pencolor=function(color){this._addCommand(function(){t.strokeColor=getColor(color),createPath()})},this.setFill=this.fill=function(state){this._addCommand(function(){!1===state&&path&&t.fill&&(path.fillColor=t.fillColor),t.fill=state,createPath()})},this.isFilling=this.filling=function(){this._addCommand(function(){return t.fill})},this.startFill=this.beginFill=this.begin_fill=function(){this._addCommand(function(){this.setFill(!0)})},this.endFill=this.end_fill=function(){this._addCommand(function(){this.setFill(!1)})},this.fillcolor=this.setFillColor=function(color){this._addCommand(function(){t.fillColor=getColor(color),createPath()})},this.pensize=this.setPenSize=this.width=this.setWidth=function(width){this._addCommand(function(){t.strokeWidth=width,path&&(path.strokeWidth=width)})},this.down=this.pendown=this.penDown=function(){this._addCommand(function(){path||createPath()})},this.up=this.penup=this.penUp=function(){this._addCommand(function(){path=null})},this.speed=function(speed){this._addCommand(function(){animate=speed})},this._runCommand=function(){var that=this;setTimeout(function(){for(;step.length;)ai.getEditor().session.removeMarker(step.pop().id);if(stack.length){var oldAnimate=paper.animateTurtle;paper.animateTurtle=!1;var command=stack.shift();command[0].call(that);var n=command[1];step.push(ai.getEditor().session.highlightLines(n-1)),paper.animateTurtle=oldAnimate,paper.view.draw(),that._runCommand()}else started=!1},animate)},this._addCommand=function(command){if(animate&&paper.animateTurtle){var stacks=__BRYTHON__.frames_stack,last=stacks[stacks.length-1],lineNo=+last[1].$line_info.split(",")[0];stack.push([command,lineNo]),started||(started=!0,this._runCommand())}else command()},this.forward=function(n){this._addCommand(function(){var delta=new Point;delta.angle=t.rotation,delta.length=n,t.position.x+=delta.x,t.position.y+=delta.y,path&&path.add(t.position)})},this.dot=function(size,color){this._addCommand(function(){size=size||Math.max(t.strokeWidth+4,2*t.strokeWidth),color=getColor(color||t.strokeColor);var c=new Shape.Circle(t.position,size/2);c.fillColor=color})},this.circle=function(radius,extent,steps){this._addCommand(function(){steps=steps||360;var step=2*Math.PI*(radius/steps);turn=360/steps,extent=extent||steps;for(var i=0;i<extent;i++)this.forward(step),0<radius?this.left(turn):this.right(turn)})},this.hideturtle=function(){t.visible=!1},this.backward=this.back=function(n){this._addCommand(function(){this.forward(-n)})},this.goto=this.setpos=this.setposition=this.setPosition=this.moveTo=this.move=function(x,y){this._addCommand(function(){t.position.x=x,t.position.y=y,path&&path.add(t.position)})},this.moveOffCanvas=function(){this._addCommand(function(){t.position.x=-200,t.position.y=-200})},this.setHeading=this.setheading=this.seth=function(n){this._addCommand(function(){t.rotation=360-n})},this.left=function(n){this._addCommand(function(){this.right(-n)})},this.right=function(n){this._addCommand(function(){t.rotate(n)})},this.write=function(content,move,align,font){this._addCommand(function(){var text=new PointText(t.position);text.content=content,align&&(text.justification=align),font&&(text.fontFamily=font[0],text.fontSize=font[1],text.fontWeight=font[2]),move&&(t.position=text.bounds.bottomRight,createPath())})},this.mv=this.move,this.pu=this.penUp,this.pd=this.penDown,this.fd=this.forward,this.bk=this.back,this.rt=this.right,this.lt=this.left,this.sc=this.setColor,this.sw=this.setWidth,createPath(),this}function runAfterPlay(method,args){return!paper.view._animate&&(setTimeout(function(){Game[method].apply(Game,arguments)},100),!0)}function boundsOnScreen(bounds,width,height){var tol=2;return bounds.left<0-tol||bounds.right>width+tol||bounds.top<0-tol||bounds.bottom>height+tol?!1:!0}function createCharacter(args,name){var o={};return Object.defineProperty(o,"position",{get:function(){return this.image.position},set:function(newValue){this.image.position=newValue}}),Object.defineProperty(o,"scaling",{get:function(){return this.image.scaled=!0,this.image.scaling},set:function(newValue){this.image.scaling=newValue,this.image.scaled=!0}}),o.scale=function(x,y){o.image.scale(x,y)},o.getBounds=function(){return o.image.getBounds()},o.gun,o.radius=25,source=args[2]||"/image/game/player1.png",Game.enemies||(Game.enemies=new ItemGroup),Game.players||(Game.players=[]),o}function setBackgroundImage(source,sizeX,sizeY,posX,posY){trackItem("setBackgroundImage",{source:source,sizeX:sizeX,sizeY:sizeY,posX:posX,posY:posY});var canvasElement=paper.view.getElement();Game.backgroundSurface=Game.ICE_BACKGROUND_RE.test(source)?"ice":"",source=source.replace(/\\/g,"/");var canvasStyle=canvasElement.style;canvasStyle.backgroundImage=source?"url("+source+")":"",!0===sizeX?(canvasStyle.backgroundSize="auto 100%",canvasStyle.backgroundPosition="center"):"number"==typeof sizeX?(sizeY=sizeY||sizeX,canvasStyle.backgroundSize=sizeX+"px "+sizeY+"px",canvasStyle.backgroundPosition="",canvasStyle.backgroundPosition="center"):sizeX?(canvasStyle.backgroundSize=sizeX,canvasStyle.backgroundPosition="",canvasStyle.backgroundPosition="center"):(canvasStyle.backgroundSize="",canvasStyle.backgroundPosition=""),(null!=posX||null!=posY)&&(null==posY&&(posY=posX),canvasStyle.backgroundPosition=posX+"px "+posY+"px"),Game._backgroundImage={source:source,sizeX:sizeX,sizeY:sizeY,posX:posX,posY:posY}}function sortItems(){if(Game.itemLoadCount--,Game.itemsLoaded()){var ch=paper.project.activeLayer.children;ch.sort(function(a,b){return a.position.y-b.position.y});for(var i=0;i<ch.length;i++)ch[i]._index=i}}function scaleItem(image,size){Game.itemLoadCount++,image.visible=!1,image.onLoad=function(){if(!this.loaded){this.loaded=!0;var maxScale=this.height>this.width?size/this.height:size/this.width;this.scaled||(this.scaling=maxScale),this.visible=!0,sortItems()}}}function sortOnLoad(image,callback){Game.itemLoadCount++,image.onLoad&&null==callback&&(callback=image.onLoad),image.onLoad=function(){callback&&callback.call(this),this.loaded||(this.loaded=!0,sortItems())}}function normalizeRotation(rot){return(rot+360)%360}function ItemGroup(){this.items=[];var that=this;this.project,this.length=0,this.totalCollectedValue=0,this.getLength=function(){return this.items.length},this.get=function(i){return this.items[i]},this.forEach=function(callback){this.items.forEach(callback)},this.push=function(item){this.length++,this.items.push(item),that.project||(that.project=paper.project)},this.removeAll=function(){for(var i=0;i<that.items.length;i++)that.items[i].remove();that.items=[],that.length=0},this.remove=function(item){for(var i=0;i<this.items.length;i++)if(null!=item._index&&this.items[i]._index==item._index){this.items.splice(i,1),item.remove(),this.length--;break}else if(null!=item.image._index&&this.items[i].image._index==item.image._index){this.items.splice(i,1),item.remove(),this.length--;break}}}function trackReset(){itemMap={},ai.data.set("game",itemMap)}function trackItem(name,properties){return itemMap[name]||(itemMap[name]=[]),itemMap[name].push(properties),properties}function StaticItem(name,defaultImage,x,y,source,mouseDown,mouseDrag,big){var objectSize=Game[name].size||Game.OBJECT_SIZE,tracker=trackItem(name,{source:source,x:x,y:y,mouseDown:mouseDown,mouseDrag:mouseDrag});if(x&&x.segments){big=mouseDrag,mouseDrag=mouseDown,mouseDown=source,source=y;var p1=x.segments[0].point;if(1<x.segments.length){var items=Game.createStaticItemLines(name,defaultImage,x,source,mouseDown,mouseDrag);items.push(new Game[name](p1.x,p1.y,source,mouseDown,mouseDrag)),paper.project.activeLayer.children.sort(function(a,b){return a.position.y-b.position.y}),paper.project.activeLayer.children.forEach(function(data,index){data._index=index});var visible=!0,itemsObj={items:items};return Object.defineProperty(itemsObj,"visible",{get:function(){return visible},set:function(newValue){visible=newValue,this.items.forEach(function(o){o.visible=newValue})}}),itemsObj}return new Game[name](p1.x,p1.y,source,mouseDown,mouseDrag)}var lowerName=name.charAt(0).toLowerCase()+name.substring(1)+"s";null==x&&(x=Game.getBounds().width/2),null==y&&(y=Game.getBounds().height/2),Game.staticItems&&paper.project==Game.staticItems.project||(Game.staticItems=new ItemGroup),Game[lowerName]&&paper.project==Game[lowerName].project||(Game[lowerName]=new ItemGroup);var currentImage=-1,item;return source instanceof Array&&source[0]?(item=new Raster(source[0],new Point(x,y)),currentImage=0):source?item=new Raster(source,new Point(x,y)):item=new Raster(defaultImage,new Point(x,y)),item._scaling=item.scaling,item.speed=0,Object.defineProperty(item,"scaling",{get:function(){return this.getScaling()},set:function(newValue){this.setScaling(newValue),this.scaled=!0}}),big||scaleItem(item,objectSize),mouseDown&&(item.onMouseDown=mouseDown),mouseDrag&&(item.onMouseDrag=mouseDrag),item.START_UP=90,item.START_LEFT=180,item.START_DOWN=270,item.START_RIGHT=0,item.startingRotation=item.START_UP,item.frameRate=10,item.power=0,item.jitter=!1,item.setPath=function(path){var JITTER=0.3;item.movePath=path,item.segmentNumber=0,item.reversePath=!1},item.onFrame=function(e){if(Game.itemsLoaded()&&0!=item.speed){var THRESHOLD=2,target;if(item.tempTarget)target=item.tempTarget;else if(this.movePath)target=this.movePath.segments[this.segmentNumber].point;else{for(var tempX=0,tempY=0;1>tempX||tempX+1>Game.getBounds().width;)tempX=Game.randomInt(75,1500,!0)+this.position.x;for(;1>tempY||tempY+1>Game.getBounds().height;)tempY=Game.randomInt(75,150,!0)+this.position.y;item.tempTarget=new Point(tempX,tempY),target=item.tempTarget}var deltaX=target.x-this.position.x,deltaY=target.y-this.position.y,absX=Math.abs(deltaX),absY=Math.abs(deltaY);if(deltaX=absX<THRESHOLD?0:10*(deltaX/Math.abs(absX)),deltaY=absY<THRESHOLD?0:10*(deltaY/Math.abs(absY)),deltaX||deltaY){var speed=new Point(deltaX,deltaY).normalize(this.speed);this.jitter?(this.position.x+=speed.x+Game.random(-JITTER,JITTER),this.position.y+=speed.y+Game.random(-JITTER,JITTER)):(this.position.x+=speed.x,this.position.y+=speed.y)}var speed=new Point(deltaX,deltaY);this.rotation=speed.angle+this.startingRotation,-1<currentImage&&0==e.count%this.frameRate&&(currentImage++,currentImage>=source.length&&(currentImage=0),this.source=source[currentImage]),this.hitTest(target)&&(this.movePath?this.movePath.closed?this.segmentNumber==this.movePath.segments.length-1?this.segmentNumber=0:this.segmentNumber++:this.reversePath?0==this.segmentNumber?(this.segmentNumber++,this.reversePath=!1):this.segmentNumber--:this.segmentNumber==this.movePath.segments.length-1?(this.segmentNumber--,this.reversePath=!0):this.segmentNumber++:item.tempTarget=null)}},Game[lowerName].push(item),Game.staticItems.push(item),item._itemTracker=tracker,item}function addDefaultProperties(item,props){for(var prop in props)if(props.hasOwnProperty(prop)&&"source"!=prop&&null!=props[prop])if("hitSound"==prop&&item.source){var imgSrc=(item.source.match(/\/images?\/([^/]+)\//)||[])[1],dProp=null==defaultHitSounds[imgSrc]?props[prop]:new Audio(defaultHitSounds[imgSrc]);item[prop]=dProp}else item[prop]=props[prop]}function setupEndObject(image){image.message="Good Work!",image.delay=2000,image.fade,image.setFadeMessage=function(msg){image.fade?image.fade.message.content=msg:image.message=msg},image.setFadeDelay=function(delay){image.fade?image.fade.delay=delay:image.delay=delay},image.setFadeOut=function(text,callback,delay){image.fade=Game.fadeOut(text,callback,delay,!0)}}function checkArgs(objectName,args,types){for(var i=0;i<args.length;i++)if(Array.isArray(types[i])){for(var found=!1,j=0;j<types[i].length;j++)(typeof args[i]===types[i][j]||"undefined"===types[i][j]&&null===args[i])&&(found=!0);if(!found)throw ai.f("Game.{name} error:\nPossible types for argument {count}: {type}",{name:objectName,count:i+1,type:types[i]})}else if(typeof args[i]!==types[i]||"undefined"===types[i]&&null===args[i])throw ai.f("Game.{name} error:\nExected type for argument {count}: {type}",{name:objectName,count:i+1,type:types[i]})}function checkTeleport(jumpTo){var teleport=this;Game.players.forEach(function(player){if(!player.teleported&&teleport.hitTest(player.image.getHitBounds().center)){player.image.position=jumpTo;for(var i=0,t;i<Game.teleports.length;i++)t=Game.teleports[i],t.hitTest(player.image.getHitBounds().center)&&(player.teleported=t)}})}function loadScript(url,callback){var head=document.getElementsByTagName("head")[0],script=document.createElement("script");script.type="text/javascript",script.src=url,script.onreadystatechange=callback,script.onload=callback,head.appendChild(script)}function createBadFunctionCallCatcher(incorrectName,correctName){return function(){throw ai.f(ai.m.gameBadFunctionCall,{incorrectName:incorrectName,correctName:correctName})}}var Base=new function(){function inject(dest,src,enumerable,base,preserve){function field(name,val,dontCheck){var val=val||(val=describe(src,name))&&(val.get?val:val.value);"string"==typeof val&&"#"===val[0]&&(val=dest[val.substring(1)]||val);var isFunc="function"==typeof val,res=val,prev=preserve||isFunc?val&&val.get?name in dest:dest[name]:null,bean;(dontCheck||void 0!==val&&src.hasOwnProperty(name))&&(!preserve||!prev)&&(isFunc&&prev&&(val.base=prev),isFunc&&beans&&(bean=name.match(/^([gs]et|is)(([A-Z])(.*))$/))&&(beans[bean[3].toLowerCase()+bean[4]]=bean[2]),(!res||isFunc||!res.get||"function"!=typeof res.get||!Base.isPlainObject(res))&&(res={value:res,writable:!0}),(describe(dest,name)||{configurable:!0}).configurable&&(res.configurable=!0,res.enumerable=enumerable),define(dest,name,res))}var beans;if(src){for(var name in beans={},src)src.hasOwnProperty(name)&&!hidden.test(name)&&field(name,null,!0);for(var name in field("toString"),field("valueOf"),beans){var part=beans[name],set=dest["set"+part],get=dest["get"+part]||set&&dest["is"+part];get&&(0===get.length||set)&&field(name,{get:get,set:set},!0)}}return dest}function each(obj,iter,bind){return obj&&("length"in obj&&!obj.getLength&&"number"==typeof obj.length?forEach:forIn).call(obj,iter,bind=bind||obj),bind}function copy(dest,source){for(var i in source)source.hasOwnProperty(i)&&(dest[i]=source[i]);return dest}var hidden=/^(statics|preserve|enumerable|prototype|toString|valueOf)$/,forEach=[].forEach||function(iter,bind){for(var i=0,l=this.length;i<l;i++)iter.call(bind,this[i],i,this)},forIn=function(iter,bind){for(var i in this)this.hasOwnProperty(i)&&iter.call(bind,this[i],i,this)},create=Object.create||function(proto){return{__proto__:proto}},describe=Object.getOwnPropertyDescriptor||function(obj,name){var get=obj.__lookupGetter__&&obj.__lookupGetter__(name);return get?{get:get,set:obj.__lookupSetter__(name),enumerable:!0,configurable:!0}:obj.hasOwnProperty(name)?{value:obj[name],enumerable:!0,configurable:!0,writable:!0}:null},_define=Object.defineProperty||function(obj,name,desc){return(desc.get||desc.set)&&obj.__defineGetter__?(desc.get&&obj.__defineGetter__(name,desc.get),desc.set&&obj.__defineSetter__(name,desc.set)):obj[name]=desc.value,obj},define=function(obj,name,desc){return delete obj[name],_define(obj,name,desc)};return inject(function Base(){for(var i=0,l=arguments.length;i<l;i++)copy(this,arguments[i])},{inject:function(src){if(src){var proto=this.prototype,base=Object.getPrototypeOf(proto).constructor,statics=!0===src.statics?src:src.statics;statics!=src&&inject(proto,src,src.enumerable,base&&base.prototype,src.preserve),inject(this,statics,!0,base,src.preserve)}for(var i=1,l=arguments.length;i<l;i++)this.inject(arguments[i]);return this},extend:function(){for(var base=this,i=0,l=arguments.length,ctor;i<l&&!(ctor=arguments[i].initialize);i++);return ctor=ctor||function(){base.apply(this,arguments)},ctor.prototype=create(this.prototype),ctor.base=base,define(ctor.prototype,"constructor",{value:ctor,writable:!0,configurable:!0}),inject(ctor,this,!0),arguments.length?this.inject.apply(ctor,arguments):ctor}},!0).inject({inject:function(){for(var i=0,l=arguments.length;i<l;i++)inject(this,arguments[i],arguments[i].enumerable);return this},extend:function(){var res=create(this);return res.inject.apply(res,arguments)},each:function(iter,bind){return each(this,iter,bind)},clone:function(){return new this.constructor(this)},statics:{each:each,create:create,define:define,describe:describe,copy:copy,clone:function(obj){return copy(new obj.constructor,obj)},isPlainObject:function(obj){var ctor=null!=obj&&obj.constructor;return ctor&&(ctor===Object||ctor===Base||"Object"===ctor.name)},pick:function(){for(var i=0,l=arguments.length;i<l;i++)if(void 0!==arguments[i])return arguments[i];return null}}})};"undefined"!=typeof module&&(module.exports=Base),Base.inject({toString:function(){return null==this._id?"{ "+Base.each(this,function(value,key){if(!/^_/.test(key)){var type=typeof value;this.push(key+": "+("number"==type?Formatter.instance.number(value):"string"==type?"'"+value+"'":value))}},[]).join(", ")+" }":(this._class||"Object")+(this._name?" '"+this._name+"'":" @"+this._id)},exportJSON:function(options){return Base.exportJSON(this,options)},toJSON:function(){return Base.serialize(this)},_set:function(props,exclude){if(props&&Base.isPlainObject(props)){var orig=props._filtering||props;for(var key in orig)if(key in this&&orig.hasOwnProperty(key)&&(!exclude||!exclude[key])){var value=props[key];void 0!==value&&(this[key]=value)}return!0}},statics:{exports:{},extend:function extend(){var res=extend.base.apply(this,arguments),name=res.prototype._class;return name&&!Base.exports[name]&&(Base.exports[name]=res),res},equals:function(obj1,obj2){function checkKeys(o1,o2){for(var i in o1)if(o1.hasOwnProperty(i)&&!o2.hasOwnProperty(i))return!1;return!0}if(obj1===obj2)return!0;if(obj1&&obj1.equals)return obj1.equals(obj2);if(obj2&&obj2.equals)return obj2.equals(obj1);if(Array.isArray(obj1)&&Array.isArray(obj2)){if(obj1.length!==obj2.length)return!1;for(var i=0,l=obj1.length;i<l;i++)if(!Base.equals(obj1[i],obj2[i]))return!1;return!0}if(obj1&&"object"==typeof obj1&&obj2&&"object"==typeof obj2){if(!checkKeys(obj1,obj2)||!checkKeys(obj2,obj1))return!1;for(var i in obj1)if(obj1.hasOwnProperty(i)&&!Base.equals(obj1[i],obj2[i]))return!1;return!0}return!1},read:function(list,start,options,length){if(this===Base){var value=this.peek(list,start);return list.__index++,value}var proto=this.prototype,readIndex=proto._readIndex,index=start||readIndex&&list.__index||0;length||(length=list.length-index);var obj=list[index];return obj instanceof this||options&&options.readNull&&null==obj&&1>=length?(readIndex&&(list.__index=index+1),obj&&options&&options.clone?obj.clone():obj):(obj=Base.create(this.prototype),readIndex&&(obj.__read=!0),obj=obj.initialize.apply(obj,0<index||length<list.length?Array.prototype.slice.call(list,index,index+length):list)||obj,readIndex&&(list.__index=index+obj.__read,obj.__read=void 0),obj)},peek:function(list,start){return list[list.__index=start||list.__index||0]},readAll:function(list,start,options){for(var res=[],i=start||0,l=list.length,entry;i<l;i++)res.push(Array.isArray(entry=list[i])?this.read(entry,0,options):this.read(list,i,options,1));return res},readNamed:function(list,name,start,options,length){var value=this.getNamed(list,name),hasObject=void 0!==value;if(hasObject){var filtered=list._filtered;filtered||(filtered=list._filtered=Base.create(list[0]),filtered._filtering=list[0]),filtered[name]=void 0}return this.read(hasObject?[value]:list,start,options,length)},getNamed:function(list,name){var arg=list[0];if(void 0===list._hasObject&&(list._hasObject=1===list.length&&Base.isPlainObject(arg)),list._hasObject)return name?arg[name]:list._filtered||arg},hasNamed:function(list,name){return!!this.getNamed(list,name)},isPlainValue:function(obj){return this.isPlainObject(obj)||Array.isArray(obj)},serialize:function(obj,options,compact,dictionary){options=options||{};var root=!dictionary,res;if(root&&(options.formatter=new Formatter(options.precision),dictionary={length:0,definitions:{},references:{},add:function(item,create){var id="#"+item._id,ref=this.references[id];if(!ref){this.length++;var res=create.call(item),name=item._class;name&&res[0]!==name&&res.unshift(name),this.definitions[id]=res,ref=this.references[id]=[id]}return ref}}),obj&&obj._serialize){res=obj._serialize(options,dictionary);var name=obj._class;!name||compact||res._compact||res[0]===name||res.unshift(name)}else if(Array.isArray(obj)){res=[];for(var i=0,l=obj.length;i<l;i++)res[i]=Base.serialize(obj[i],options,compact,dictionary);compact&&(res._compact=!0)}else if(Base.isPlainObject(obj))for(var i in res={},obj)obj.hasOwnProperty(i)&&(res[i]=Base.serialize(obj[i],options,compact,dictionary));else res="number"==typeof obj?options.formatter.number(obj,options.precision):obj;return root&&0<dictionary.length?[["dictionary",dictionary.definitions],res]:res},deserialize:function(json,create,_data){var res=json,isRoot=!_data;if(_data=_data||{},Array.isArray(json)){var type=json[0],isDictionary="dictionary"===type;if(!isDictionary){if(_data.dictionary&&1==json.length&&/^#/.test(type))return _data.dictionary[type];type=Base.exports[type]}res=[];for(var i=type?1:0,l=json.length;i<l;i++)res.push(Base.deserialize(json[i],create,_data));if(isDictionary)_data.dictionary=res[0];else if(type){var args=res;create?res=create(type,args,isRoot):(res=Base.create(type.prototype),type.apply(res,args))}}else if(Base.isPlainObject(json))for(var key in res={},json)res[key]=Base.deserialize(json[key],create,_data);return res},exportJSON:function(obj,options){var json=Base.serialize(obj,options);return options&&!1===options.asString?json:JSON.stringify(json)},importJSON:function(json,target){return Base.deserialize("string"==typeof json?JSON.parse(json):json,function(type,args,isRoot){var obj=target&&target.constructor===type?target:Base.create(type.prototype),isTarget=obj===target;if(!isRoot&&1===args.length&&obj instanceof Item&&(!(obj instanceof Layer)||isTarget)){var arg=args[0];Base.isPlainObject(arg)&&(arg.insert=!1)}return type.apply(obj,args),isTarget&&(target=null),obj})},splice:function(list,items,index,remove){var amount=items&&items.length,append=void 0===index;index=append?list.length:index,index>list.length&&(index=list.length);for(var i=0;i<amount;i++)items[i]._index=index+i;if(append)return list.push.apply(list,items),[];var args=[index,remove];items&&args.push.apply(args,items);for(var removed=list.splice.apply(list,args),i=0,l=removed.length;i<l;i++)removed[i]._index=void 0;for(var i=index+amount,l=list.length;i<l;i++)list[i]._index=i;return removed},capitalize:function(str){return str.replace(/\b[a-z]/g,function(match){return match.toUpperCase()})},camelize:function(str){return str.replace(/-(.)/g,function(all,chr){return chr.toUpperCase()})},hyphenate:function(str){return str.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}}});var Callback={attach:function(type,func){if("string"!=typeof type)return void Base.each(type,function(value,key){this.attach(key,value)},this);var entry=this._eventTypes[type];if(entry){var handlers=this._handlers=this._handlers||{};handlers=handlers[type]=handlers[type]||[],-1==handlers.indexOf(func)&&(handlers.push(func),entry.install&&1==handlers.length&&entry.install.call(this,type))}},detach:function(type,func){if("string"!=typeof type)return void Base.each(type,function(value,key){this.detach(key,value)},this);var entry=this._eventTypes[type],handlers=this._handlers&&this._handlers[type],index;entry&&handlers&&(func&&(-1==(index=handlers.indexOf(func))||1!=handlers.length)?-1!=index&&handlers.splice(index,1):(entry.uninstall&&entry.uninstall.call(this,type),delete this._handlers[type]))},once:function(type,func){this.attach(type,function(){func.apply(this,arguments),this.detach(type,func)})},fire:function(type,event){var handlers=this._handlers&&this._handlers[type];if(!handlers)return!1;var args=[].slice.call(arguments,1),that=this;try{for(var i in handlers)if(!1===handlers[i].apply(that,args)&&event&&event.stop){event.stop();break}return!0}catch(e){paper.PaperScript.handleException&&paper.PaperScript.handleException(e)}return!1},responds:function(type){return!!(this._handlers&&this._handlers[type])},on:"#attach",off:"#detach",trigger:"#fire",_installEvents:function(install){var handlers=this._handlers,key=install?"install":"uninstall";for(var type in handlers)if(0<handlers[type].length){var entry=this._eventTypes[type],func=entry[key];func&&func.call(this,type)}},statics:{inject:function inject(){for(var i=0,l=arguments.length;i<l;i++){var src=arguments[i],events=src._events;if(events){var types={};Base.each(events,function(entry,key){var isString="string"==typeof entry,name=isString?entry:key,part=Base.capitalize(name),type=name.substring(2).toLowerCase();types[type]=isString?{}:entry,name="_"+name,src["get"+part]=function(){return this[name]},src["set"+part]=function(func){var prev=this[name];prev&&this.detach(type,prev),func&&this.attach(type,func),this[name]=func}}),src._eventTypes=types}inject.base.call(this,src)}return this}}},PaperScope=Base.extend({_class:"PaperScope",initialize:function PaperScope(script){if(paper=this,this.project=null,this.projects=[],this.tools=[],this.palettes=[],this._id=script&&(script.getAttribute("id")||script.src)||"paperscope-"+PaperScope._id++,script&&script.setAttribute("id",this._id),PaperScope._scopes[this._id]=this,!this.support){var ctx=CanvasProvider.getContext(1,1);PaperScope.prototype.support={nativeDash:"setLineDash"in ctx||"mozDash"in ctx,nativeBlendModes:BlendMode.nativeModes},CanvasProvider.release(ctx)}},version:"0.9.15",getView:function(){return this.project&&this.project.view},getPaper:function(){return this},execute:function(code){paper.PaperScript.execute(code,this),View.updateFocus()},install:function(scope){var that=this;for(var key in Base.each(["project","view","tool"],function(key){Base.define(scope,key,{configurable:!0,get:function(){return that[key]}})}),this)!/^_/.test(key)&&this[key]&&(scope[key]=this[key])},setup:function(canvas){return paper=this,this.project=new Project(canvas),this},activate:function(){paper=this},clear:function(){for(var i=this.projects.length-1;0<=i;i--)this.projects[i].remove();for(var i=this.tools.length-1;0<=i;i--)this.tools[i].remove();for(var i=this.palettes.length-1;0<=i;i--)this.palettes[i].remove()},remove:function(){this.clear(),delete PaperScope._scopes[this._id]},statics:new function(){function handleAttribute(name){return name+="Attribute",function(el,attr){return el[name](attr)||el[name]("data-paper-"+attr)}}return{_scopes:{},_id:0,get:function(id){return id&&id.getAttribute&&(id=id.getAttribute("id")),this._scopes[id]||null},getAttribute:handleAttribute("get"),hasAttribute:handleAttribute("has")}}}),PaperScopeItem=Base.extend(Callback,{initialize:function(activate){this._scope=paper,this._index=this._scope[this._list].push(this)-1,(activate||!this._scope[this._reference])&&this.activate()},activate:function(){if(!this._scope)return!1;var prev=this._scope[this._reference];return prev&&prev!==this&&prev.fire("deactivate"),this._scope[this._reference]=this,this.fire("activate",prev),!0},isActive:function(){return this._scope[this._reference]===this},remove:function(){return null!=this._index&&(Base.splice(this._scope[this._list],null,this._index,1),this._scope[this._reference]==this&&(this._scope[this._reference]=null),this._scope=null,!0)}}),Formatter=Base.extend({initialize:function(precision){this.precision=precision||5,this.multiplier=Math.pow(10,this.precision)},number:function(val){return Math.round(val*this.multiplier)/this.multiplier},point:function(val,separator){return this.number(val.x)+(separator||",")+this.number(val.y)},size:function(val,separator){return this.number(val.width)+(separator||",")+this.number(val.height)},rectangle:function(val,separator){return this.point(val,separator)+(separator||",")+this.size(val,separator)}});Formatter.instance=new Formatter;var Numerical=new function(){function setupRoots(roots,min,max){var unbound=void 0===min,minE=min-EPSILON,maxE=max+EPSILON,count=0;return function(root){return(unbound||root>minE&&root<maxE)&&(roots[count++]=root<min?min:root>max?max:root),count}}var abscissas=[[0.5773502691896257],[0,0.7745966692414834],[0.33998104358485626,0.8611363115940526],[0,0.5384693101056831,0.906179845938664],[0.2386191860831969,0.6612093864662645,0.932469514203152],[0,0.4058451513773972,0.7415311855993945,0.9491079123427585],[0.1834346424956498,0.525532409916329,0.7966664774136267,0.9602898564975363],[0,0.3242534234038089,0.6133714327005904,0.8360311073266358,0.9681602395076261],[0.14887433898163122,0.4333953941292472,0.6794095682990244,0.8650633666889845,0.9739065285171717],[0,0.26954315595234496,0.5190961292068118,0.7301520055740494,0.8870625997680953,0.978228658146057],[0.1252334085114689,0.3678314989981802,0.5873179542866175,0.7699026741943047,0.9041172563704749,0.9815606342467192],[0,0.2304583159551348,0.44849275103644687,0.6423493394403402,0.8015780907333099,0.9175983992229779,0.9841830547185881],[0.10805494870734367,0.31911236892788974,0.5152486363581541,0.6872929048116855,0.827201315069765,0.9284348836635735,0.9862838086968123],[0,0.20119409399743451,0.3941513470775634,0.5709721726085388,0.7244177313601701,0.8482065834104272,0.937273392400706,0.9879925180204854],[0.09501250983763744,0.2816035507792589,0.45801677765722737,0.6178762444026438,0.755404408355003,0.8656312023878318,0.9445750230732326,0.9894009349916499]],weights=[[1],[0.8888888888888888,0.5555555555555556],[0.6521451548625461,0.34785484513745385],[0.5688888888888889,0.47862867049936647,0.23692688505618908],[0.46791393457269104,0.3607615730481386,0.17132449237917036],[0.4179591836734694,0.3818300505051189,0.27970539148927664,0.1294849661688697],[0.362683783378362,0.31370664587788727,0.22238103445337448,0.10122853629037626],[0.3302393550012598,0.31234707704000286,0.26061069640293544,0.1806481606948574,0.08127438836157441],[0.29552422471475287,0.26926671930999635,0.21908636251598204,0.1494513491505806,0.06667134430868814],[0.2729250867779006,0.26280454451024665,0.23319376459199048,0.18629021092773426,0.1255803694649046,0.05566856711617366],[0.24914704581340277,0.2334925365383548,0.20316742672306592,0.16007832854334622,0.10693932599531843,0.04717533638651183],[0.2325515532308739,0.22628318026289723,0.2078160475368885,0.17814598076194574,0.13887351021978725,0.09212149983772845,0.04048400476531588],[0.2152638534631578,0.2051984637212956,0.18553839747793782,0.15720316715819355,0.12151857068790319,0.08015808715976021,0.03511946033175186],[0.2025782419255613,0.19843148532711158,0.1861610000155622,0.16626920581699392,0.13957067792615432,0.10715922046717194,0.07036604748810812,0.03075324199611727],[0.1894506104550685,0.18260341504492358,0.16915651939500254,0.14959598881657674,0.12462897125553388,0.09515851168249279,0.062253523938647894,0.027152459411754096]],abs=Math.abs,sqrt=Math.sqrt,pow=Math.pow,cos=Math.cos,PI=Math.PI,TOLERANCE=10e-6,EPSILON=1e-11;return{TOLERANCE:TOLERANCE,EPSILON:EPSILON,KAPPA:4*(sqrt(2)-1)/3,isZero:function(val){return abs(val)<=EPSILON},integrate:function(f,a,b,n){for(var x=abscissas[n-2],w=weights[n-2],A=0.5*(b-a),B=A+a,i=0,m=n+1>>1,sum=1&n?w[i++]*f(B):0,Ax;i<m;)Ax=A*x[i],sum+=w[i++]*(f(B+Ax)+f(B-Ax));return A*sum},findRoot:function(f,df,x,a,b,n,tolerance){for(var i=0;i<n;i++){var fx=f(x),dx=fx/df(x),nx=x-dx;if(abs(dx)<tolerance)return nx;0<fx?(b=x,x=nx<=a?0.5*(a+b):nx):(a=x,x=nx>=b?0.5*(a+b):nx)}return x},solveQuadratic:function(a,b,c,roots,min,max){var add=setupRoots(roots,min,max);if(abs(a)<EPSILON)return abs(b)>=EPSILON?add(-c/b):abs(c)<EPSILON?-1:0;var p=b/(2*a),q=c/a,p2=p*p;if(p2<q-EPSILON)return 0;var s=p2>q?sqrt(p2-q):0,count=add(s-p);return 0<s&&(count=add(-s-p)),count},solveCubic:function(a,b,c,d,roots,min,max){if(abs(a)<EPSILON)return Numerical.solveQuadratic(b,c,d,roots,min,max);b/=a,c/=a,d/=a;var add=setupRoots(roots,min,max),bb=b*b,p=(bb-3*c)/9,q=(2*bb*b-9*b*c+27*d)/54,ppp=p*p*p,D=q*q-ppp;if(b/=3,abs(D)<EPSILON){if(abs(q)<EPSILON)return add(-b);var sqp=sqrt(p),snq=0<q?1:-1;return add(2*-snq*sqp-b),add(snq*sqp-b)}if(0>D){var sqp=sqrt(p),phi=Math.acos(q/(sqp*sqp*sqp))/3,t=-2*sqp,o=2*PI/3;return add(t*cos(phi)-b),add(t*cos(phi+o)-b),add(t*cos(phi-o)-b)}var A=(0<q?-1:1)*pow(abs(q)+sqrt(D),1/3);return add(A+p/A-b)}}},Point=Base.extend({_class:"Point",_readIndex:!0,initialize:function Point(arg0,arg1){var type=typeof arg0;if("number"==type){var hasY="number"==typeof arg1;this.x=arg0,this.y=hasY?arg1:arg0,this.__read&&(this.__read=hasY?2:1)}else"undefined"==type||null===arg0?(this.x=this.y=0,this.__read&&(this.__read=null===arg0?1:0)):(Array.isArray(arg0)?(this.x=arg0[0],this.y=1<arg0.length?arg0[1]:arg0[0]):null==arg0.x?null==arg0.width?null==arg0.angle?(this.x=this.y=0,this.__read&&(this.__read=0)):(this.x=arg0.length,this.y=0,this.setAngle(arg0.angle)):(this.x=arg0.width,this.y=arg0.height):(this.x=arg0.x,this.y=arg0.y),this.__read&&(this.__read=1))},set:function(x,y){return this.x=x,this.y=y,this},equals:function(point){return point===this||point&&(this.x===point.x&&this.y===point.y||Array.isArray(point)&&this.x===point[0]&&this.y===point[1])||!1},clone:function(){return new Point(this.x,this.y)},toString:function(){var f=Formatter.instance;return"{ x: "+f.number(this.x)+", y: "+f.number(this.y)+" }"},_serialize:function(options){var f=options.formatter;return[f.number(this.x),f.number(this.y)]},add:function(){var point=Point.read(arguments);return new Point(this.x+point.x,this.y+point.y)},subtract:function(){var point=Point.read(arguments);return new Point(this.x-point.x,this.y-point.y)},multiply:function(){var point=Point.read(arguments);return new Point(this.x*point.x,this.y*point.y)},divide:function(){var point=Point.read(arguments);return new Point(this.x/point.x,this.y/point.y)},modulo:function(){var point=Point.read(arguments);return new Point(this.x%point.x,this.y%point.y)},negate:function(){return new Point(-this.x,-this.y)},transform:function(matrix){return matrix?matrix._transformPoint(this):this},getDistance:function(_point,squared){var point=Point.read(arguments),x=point.x-this.x,y=point.y-this.y,d=x*x+y*y;return squared=Base.read(arguments),squared?d:Math.sqrt(d)},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},setLength:function(length){if(this.isZero()){var angle=this._angle||0;this.set(Math.cos(angle)*length,Math.sin(angle)*length)}else{var scale=length/this.getLength();Numerical.isZero(scale)&&this.getAngle(),this.set(this.x*scale,this.y*scale)}},normalize:function(length){void 0===length&&(length=1);var current=this.getLength(),scale=0===current?0:length/current,point=new Point(this.x*scale,this.y*scale);return point._angle=this._angle,point},getAngle:function(){return 180*this.getAngleInRadians.apply(this,arguments)/Math.PI},setAngle:function(angle){this.setAngleInRadians.call(this,angle*Math.PI/180)},getAngleInDegrees:"#getAngle",setAngleInDegrees:"#setAngle",getAngleInRadians:function(){if(!arguments.length)return this.isZero()?this._angle||0:this._angle=Math.atan2(this.y,this.x);var point=Point.read(arguments),div=this.getLength()*point.getLength();return Numerical.isZero(div)?NaN:Math.acos(this.dot(point)/div)},setAngleInRadians:function(angle){if(this._angle=angle,!this.isZero()){var length=this.getLength();this.set(Math.cos(angle)*length,Math.sin(angle)*length)}},getQuadrant:function(){return 0<=this.x?0<=this.y?1:4:0<=this.y?2:3},getDirectedAngle:function(_point){var point=_point;return point=Point.read(arguments),180*Math.atan2(this.cross(point),this.dot(point))/Math.PI},rotate:function(angle,center){if(0===angle)return this.clone();angle=angle*Math.PI/180;var point=center?this.subtract(center):this,s=Math.sin(angle),c=Math.cos(angle);return point=new Point(point.x*c-point.y*s,point.y*c+point.x*s),center?point.add(center):point},isInside:function(rect){return rect.contains(this)},isClose:function(point,tolerance){return this.getDistance(point)<tolerance},isColinear:function(point){return 0.00001>this.cross(point)},isOrthogonal:function(point){return 0.00001>this.dot(point)},isZero:function(){return Numerical.isZero(this.x)&&Numerical.isZero(this.y)},isNaN:function(){return isNaN(this.x)||isNaN(this.y)},dot:function(){var point=Point.read(arguments);return this.x*point.x+this.y*point.y},cross:function(){var point=Point.read(arguments);return this.x*point.y-this.y*point.x},project:function(){var point=Point.read(arguments);if(point.isZero())return new Point(0,0);var scale=this.dot(point)/point.dot(point);return new Point(point.x*scale,point.y*scale)},statics:{min:function(){var point1=Point.read(arguments);return point2=Point.read(arguments),new Point(Math.min(point1.x,point2.x),Math.min(point1.y,point2.y))},max:function(){var point1=Point.read(arguments);return point2=Point.read(arguments),new Point(Math.max(point1.x,point2.x),Math.max(point1.y,point2.y))},random:function(){return new Point(Math.random(),Math.random())}}},Base.each(["round","ceil","floor","abs"],function(name){var op=Math[name];this[name]=function(){return new Point(op(this.x),op(this.y))}},{})),LinkedPoint=Point.extend({initialize:function Point(x,y,owner,setter){this._x=x,this._y=y,this._owner=owner,this._setter=setter},set:function(x,y,_dontNotify){return this._x=x,this._y=y,_dontNotify||this._owner[this._setter](this),this},getX:function(){return this._x},setX:function(x){this._x=x,this._owner[this._setter](this)},getY:function(){return this._y},setY:function(y){this._y=y,this._owner[this._setter](this)}}),Size=Base.extend({_class:"Size",_readIndex:!0,initialize:function Size(arg0,arg1){var type=typeof arg0;if("number"==type){var hasHeight="number"==typeof arg1;this.width=arg0,this.height=hasHeight?arg1:arg0,this.__read&&(this.__read=hasHeight?2:1)}else"undefined"==type||null===arg0?(this.width=this.height=0,this.__read&&(this.__read=null===arg0?1:0)):(Array.isArray(arg0)?(this.width=arg0[0],this.height=1<arg0.length?arg0[1]:arg0[0]):null==arg0.width?null==arg0.x?(this.width=this.height=0,this.__read&&(this.__read=0)):(this.width=arg0.x,this.height=arg0.y):(this.width=arg0.width,this.height=arg0.height),this.__read&&(this.__read=1))},set:function(width,height){return this.width=width,this.height=height,this},equals:function(size){return size===this||size&&(this.width===size.width&&this.height===size.height||Array.isArray(size)&&this.width===size[0]&&this.height===size[1])||!1},clone:function(){return new Size(this.width,this.height)},toString:function(){var f=Formatter.instance;return"{ width: "+f.number(this.width)+", height: "+f.number(this.height)+" }"},_serialize:function(options){var f=options.formatter;return[f.number(this.width),f.number(this.height)]},add:function(){var size=Size.read(arguments);return new Size(this.width+size.width,this.height+size.height)},subtract:function(){var size=Size.read(arguments);return new Size(this.width-size.width,this.height-size.height)},multiply:function(){var size=Size.read(arguments);return new Size(this.width*size.width,this.height*size.height)},divide:function(){var size=Size.read(arguments);return new Size(this.width/size.width,this.height/size.height)},modulo:function(){var size=Size.read(arguments);return new Size(this.width%size.width,this.height%size.height)},negate:function(){return new Size(-this.width,-this.height)},isZero:function(){return Numerical.isZero(this.width)&&Numerical.isZero(this.height)},isNaN:function(){return isNaN(this.width)||isNaN(this.height)},statics:{min:function(size1,size2){return new Size(Math.min(size1.width,size2.width),Math.min(size1.height,size2.height))},max:function(size1,size2){return new Size(Math.max(size1.width,size2.width),Math.max(size1.height,size2.height))},random:function(){return new Size(Math.random(),Math.random())}}},Base.each(["round","ceil","floor","abs"],function(name){var op=Math[name];this[name]=function(){return new Size(op(this.width),op(this.height))}},{})),LinkedSize=Size.extend({initialize:function Size(width,height,owner,setter){this._width=width,this._height=height,this._owner=owner,this._setter=setter},set:function(width,height,_dontNotify){return this._width=width,this._height=height,_dontNotify||this._owner[this._setter](this),this},getWidth:function(){return this._width},setWidth:function(width){this._width=width,this._owner[this._setter](this)},getHeight:function(){return this._height},setHeight:function(height){this._height=height,this._owner[this._setter](this)}}),Rectangle=Base.extend({_class:"Rectangle",_readIndex:!0,initialize:function Rectangle(arg0,arg1,arg2,arg3){var type=typeof arg0,read=0;if("number"==type?(this.x=arg0,this.y=arg1,this.width=arg2,this.height=arg3,read=4):"undefined"==type||null===arg0?(this.x=this.y=this.width=this.height=0,read=null===arg0?1:0):1===arguments.length&&(Array.isArray(arg0)?(this.x=arg0[0],this.y=arg0[1],this.width=arg0[2],this.height=arg0[3],read=1):void 0!==arg0.x||void 0!==arg0.width?(this.x=arg0.x||0,this.y=arg0.y||0,this.width=arg0.width||0,this.height=arg0.height||0,read=1):void 0===arg0.from&&void 0===arg0.to&&(this.x=this.y=this.width=this.height=0,this._set(arg0),read=1)),!read){var point=Point.readNamed(arguments,"from"),next=Base.peek(arguments);if(this.x=point.x,this.y=point.y,next&&void 0!==next.x||Base.hasNamed(arguments,"to")){var to=Point.readNamed(arguments,"to");this.width=to.x-point.x,this.height=to.y-point.y,0>this.width&&(this.x=to.x,this.width=-this.width),0>this.height&&(this.y=to.y,this.height=-this.height)}else{var size=Size.read(arguments);this.width=size.width,this.height=size.height}read=arguments.__index}this.__read&&(this.__read=read)},set:function(x,y,width,height){return this.x=x,this.y=y,this.width=width,this.height=height,this},clone:function(){return new Rectangle(this.x,this.y,this.width,this.height)},equals:function(rect){var rt=Base.isPlainValue(rect)?Rectangle.read(arguments):rect;return rt===this||rt&&this.x===rt.x&&this.y===rt.y&&this.width===rt.width&&this.height===rt.height||!1},toString:function(){var f=Formatter.instance;return"{ x: "+f.number(this.x)+", y: "+f.number(this.y)+", width: "+f.number(this.width)+", height: "+f.number(this.height)+" }"},_serialize:function(options){var f=options.formatter;return[f.number(this.x),f.number(this.y),f.number(this.width),f.number(this.height)]},getPoint:function(_dontLink){var ctor=_dontLink?Point:LinkedPoint;return new ctor(this.x,this.y,this,"setPoint")},setPoint:function(){var point=Point.read(arguments);this.x=point.x,this.y=point.y},getSize:function(_dontLink){var ctor=_dontLink?Size:LinkedSize;return new ctor(this.width,this.height,this,"setSize")},setSize:function(){var size=Size.read(arguments);this._fixX&&(this.x+=(this.width-size.width)*this._fixX),this._fixY&&(this.y+=(this.height-size.height)*this._fixY),this.width=size.width,this.height=size.height,this._fixW=1,this._fixH=1},getLeft:function(){return this.x},setLeft:function(left){this._fixW||(this.width-=left-this.x),this.x=left,this._fixX=0},getTop:function(){return this.y},setTop:function(top){this._fixH||(this.height-=top-this.y),this.y=top,this._fixY=0},getRight:function(){return this.x+this.width},setRight:function(right){void 0!==this._fixX&&1!==this._fixX&&(this._fixW=0),this._fixW?this.x=right-this.width:this.width=right-this.x,this._fixX=1},getBottom:function(){return this.y+this.height},setBottom:function(bottom){void 0!==this._fixY&&1!==this._fixY&&(this._fixH=0),this._fixH?this.y=bottom-this.height:this.height=bottom-this.y,this._fixY=1},getCenterX:function(){return this.x+0.5*this.width},setCenterX:function(x){this.x=x-0.5*this.width,this._fixX=0.5},getCenterY:function(){return this.y+0.5*this.height},setCenterY:function(y){this.y=y-0.5*this.height,this._fixY=0.5},getCenter:function(_dontLink){var ctor=_dontLink?Point:LinkedPoint;return new ctor(this.getCenterX(),this.getCenterY(),this,"setCenter")},setCenter:function(){var point=Point.read(arguments);return this.setCenterX(point.x),this.setCenterY(point.y),this},getArea:function(){return this.width*this.height},isEmpty:function(){return 0===this.width||0===this.height},contains:function(arg){return arg&&void 0!==arg.width||4==(Array.isArray(arg)?arg:arguments).length?this._containsRectangle(Rectangle.read(arguments)):this._containsPoint(Point.read(arguments))},_containsPoint:function(point){var x=point.x,y=point.y;return x>=this.x&&y>=this.y&&x<=this.x+this.width&&y<=this.y+this.height},_containsRectangle:function(rect){var x=rect.x,y=rect.y;return x>=this.x&&y>=this.y&&x+rect.width<=this.x+this.width&&y+rect.height<=this.y+this.height},intersects:function(){var rect=Rectangle.read(arguments);return rect.x+rect.width>this.x&&rect.y+rect.height>this.y&&rect.x<this.x+this.width&&rect.y<this.y+this.height},touches:function(){var rect=Rectangle.read(arguments);return rect.x+rect.width>=this.x&&rect.y+rect.height>=this.y&&rect.x<=this.x+this.width&&rect.y<=this.y+this.height},intersect:function(){var rect=Rectangle.read(arguments),x1=Math.max(this.x,rect.x),y1=Math.max(this.y,rect.y),x2=Math.min(this.x+this.width,rect.x+rect.width),y2=Math.min(this.y+this.height,rect.y+rect.height);return new Rectangle(x1,y1,x2-x1,y2-y1)},unite:function(){var rect=Rectangle.read(arguments),x1=Math.min(this.x,rect.x),y1=Math.min(this.y,rect.y),x2=Math.max(this.x+this.width,rect.x+rect.width),y2=Math.max(this.y+this.height,rect.y+rect.height);return new Rectangle(x1,y1,x2-x1,y2-y1)},include:function(){var point=Point.read(arguments),x1=Math.min(this.x,point.x),y1=Math.min(this.y,point.y),x2=Math.max(this.x+this.width,point.x),y2=Math.max(this.y+this.height,point.y);return new Rectangle(x1,y1,x2-x1,y2-y1)},expand:function(){var amount=Size.read(arguments),hor=amount.width,ver=amount.height;return new Rectangle(this.x-hor/2,this.y-ver/2,this.width+hor,this.height+ver)},scale:function(hor,ver){return this.expand(this.width*hor-this.width,this.height*(void 0===ver?hor:ver)-this.height)}},new function(){return Base.each([["Top","Left"],["Top","Right"],["Bottom","Left"],["Bottom","Right"],["Left","Center"],["Top","Center"],["Right","Center"],["Bottom","Center"]],function(parts,index){var part=parts.join(""),xFirst=/^[RL]/.test(part);4<=index&&(parts[1]+=xFirst?"Y":"X");var x=parts[xFirst?0:1],y=parts[xFirst?1:0],getX="get"+x,getY="get"+y,setX="set"+x,setY="set"+y,get="get"+part,set="set"+part;this[get]=function(_dontLink){var ctor=_dontLink?Point:LinkedPoint;return new ctor(this[getX](),this[getY](),this,set)},this[set]=function(){var point=Point.read(arguments);this[setX](point.x),this[setY](point.y)}},{})}),LinkedRectangle=Rectangle.extend({initialize:function Rectangle(x,y,width,height,owner,setter){this.set(x,y,width,height,!0),this._owner=owner,this._setter=setter},set:function(x,y,width,height,_dontNotify){return this._x=x,this._y=y,this._width=width,this._height=height,_dontNotify||this._owner[this._setter](this),this}},new function(){var proto=Rectangle.prototype;return Base.each(["x","y","width","height"],function(key){var part=Base.capitalize(key),internal="_"+key;this["get"+part]=function(){return this[internal]},this["set"+part]=function(value){this[internal]=value,this._dontNotify||this._owner[this._setter](this)}},Base.each(["Point","Size","Center","Left","Top","Right","Bottom","CenterX","CenterY","TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],function(key){var name="set"+key;this[name]=function(){this._dontNotify=!0,proto[name].apply(this,arguments),this._dontNotify=!1,this._owner[this._setter](this)}},{isSelected:function(){return this._owner._boundsSelected},setSelected:function(selected){var owner=this._owner;owner.setSelected&&(owner._boundsSelected=selected,owner.setSelected(selected||0<owner._selectedSegmentState))}}))}),Matrix=Base.extend({_class:"Matrix",initialize:function Matrix(arg){var count=arguments.length,ok=!0;if(6===count?this.set.apply(this,arguments):1===count?arg instanceof Matrix?this.set(arg._a,arg._c,arg._b,arg._d,arg._tx,arg._ty):Array.isArray(arg)?this.set.apply(this,arg):ok=!1:0===count?this.reset():ok=!1,!ok)throw new Error("Unsupported matrix parameters")},set:function(a,c,b,d,tx,ty,_dontNotify){return this._a=a,this._c=c,this._b=b,this._d=d,this._tx=tx,this._ty=ty,_dontNotify||this._changed(),this},_serialize:function(options){return Base.serialize(this.getValues(),options)},_changed:function(){this._owner&&this._owner._changed(5)},clone:function(){return new Matrix(this._a,this._c,this._b,this._d,this._tx,this._ty)},equals:function(mx){return mx===this||mx&&this._a===mx._a&&this._b===mx._b&&this._c===mx._c&&this._d===mx._d&&this._tx===mx._tx&&this._ty===mx._ty||!1},toString:function(){var f=Formatter.instance;return"[["+[f.number(this._a),f.number(this._b),f.number(this._tx)].join(", ")+"], ["+[f.number(this._c),f.number(this._d),f.number(this._ty)].join(", ")+"]]"},reset:function(_dontNotify){return this._a=this._d=1,this._c=this._b=this._tx=this._ty=0,_dontNotify||this._changed(),this},translate:function(){var point=Point.read(arguments),x=point.x,y=point.y;return this._tx+=x*this._a+y*this._b,this._ty+=x*this._c+y*this._d,this._changed(),this},scale:function(){var scale=Point.read(arguments),center=Point.read(arguments,0,{readNull:!0});return center&&this.translate(center),this._a*=scale.x,this._c*=scale.x,this._b*=scale.y,this._d*=scale.y,center&&this.translate(center.negate()),this._changed(),this},rotate:function(angle){angle*=Math.PI/180;var center=Point.read(arguments,1),x=center.x,y=center.y,cos=Math.cos(angle),sin=Math.sin(angle),tx=x-x*cos+y*sin,ty=y-x*sin-y*cos,a=this._a,b=this._b,c=this._c,d=this._d;return this._a=cos*a+sin*b,this._b=-sin*a+cos*b,this._c=cos*c+sin*d,this._d=-sin*c+cos*d,this._tx+=tx*a+ty*b,this._ty+=tx*c+ty*d,this._changed(),this},shear:function(){var shear=Point.read(arguments),center=Point.read(arguments,0,{readNull:!0});center&&this.translate(center);var a=this._a,c=this._c;return this._a+=shear.y*this._b,this._c+=shear.y*this._d,this._b+=shear.x*a,this._d+=shear.x*c,center&&this.translate(center.negate()),this._changed(),this},skew:function(){var skew=Point.read(arguments),center=Point.read(arguments,0,{readNull:!0}),toRadians=Math.PI/180,shear=new Point(Math.tan(skew.x*toRadians),Math.tan(skew.y*toRadians));return this.shear(shear,center)},concatenate:function(mx){var a=this._a,b=this._b,c=this._c,d=this._d;return this._a=mx._a*a+mx._c*b,this._b=mx._b*a+mx._d*b,this._c=mx._a*c+mx._c*d,this._d=mx._b*c+mx._d*d,this._tx+=mx._tx*a+mx._ty*b,this._ty+=mx._tx*c+mx._ty*d,this._changed(),this},preConcatenate:function(mx){var a=this._a,b=this._b,c=this._c,d=this._d,tx=this._tx,ty=this._ty;return this._a=mx._a*a+mx._b*c,this._b=mx._a*b+mx._b*d,this._c=mx._c*a+mx._d*c,this._d=mx._c*b+mx._d*d,this._tx=mx._a*tx+mx._b*ty+mx._tx,this._ty=mx._c*tx+mx._d*ty+mx._ty,this._changed(),this},isIdentity:function(){return 1===this._a&&0===this._c&&0===this._b&&1===this._d&&0===this._tx&&0===this._ty},orNullIfIdentity:function(){return this.isIdentity()?null:this},isInvertible:function(){return!!this._getDeterminant()},isSingular:function(){return!this._getDeterminant()},transform:function(src,srcOffset,dst,dstOffset,count){return 5>arguments.length?this._transformPoint(Point.read(arguments)):this._transformCoordinates(src,srcOffset,dst,dstOffset,count)},_transformPoint:function(point,dest,_dontNotify){var x=point.x,y=point.y;return dest||(dest=new Point),dest.set(x*this._a+y*this._b+this._tx,x*this._c+y*this._d+this._ty,_dontNotify)},_transformCoordinates:function(src,srcOffset,dst,dstOffset,count){for(var i=srcOffset,j=dstOffset,max=i+2*count;i<max;){var x=src[i++],y=src[i++];dst[j++]=x*this._a+y*this._b+this._tx,dst[j++]=x*this._c+y*this._d+this._ty}return dst},_transformCorners:function(rect){var x1=rect.x,y1=rect.y,x2=x1+rect.width,y2=y1+rect.height,coords=[x1,y1,x2,y1,x2,y2,x1,y2];return this._transformCoordinates(coords,0,coords,0,4)},_transformBounds:function(bounds,dest,_dontNotify){for(var coords=this._transformCorners(bounds),min=coords.slice(0,2),max=coords.slice(),i=2;8>i;i++){var val=coords[i],j=1&i;val<min[j]?min[j]=val:val>max[j]&&(max[j]=val)}return dest||(dest=new Rectangle),dest.set(min[0],min[1],max[0]-min[0],max[1]-min[1],_dontNotify)},inverseTransform:function(){return this._inverseTransform(Point.read(arguments))},_getDeterminant:function(){var det=this._a*this._d-this._b*this._c;return isFinite(det)&&!Numerical.isZero(det)&&isFinite(this._tx)&&isFinite(this._ty)?det:null},_inverseTransform:function(point,dest,_dontNotify){var det=this._getDeterminant();if(!det)return null;var x=point.x-this._tx,y=point.y-this._ty;return dest||(dest=new Point),dest.set((x*this._d-y*this._b)/det,(y*this._a-x*this._c)/det,_dontNotify)},decompose:function(){var a=this._a,b=this._b,c=this._c,d=this._d;if(Numerical.isZero(a*d-b*c))return null;var scaleX=Math.sqrt(a*a+b*b);a/=scaleX,b/=scaleX;var shear=a*c+b*d;c-=a*shear,d-=b*shear;var scaleY=Math.sqrt(c*c+d*d);return c/=scaleY,d/=scaleY,shear/=scaleY,a*d<b*c&&(a=-a,b=-b,shear=-shear,scaleX=-scaleX),{scaling:new Point(scaleX,scaleY),rotation:180*-Math.atan2(b,a)/Math.PI,shearing:shear}},getValues:function(){return[this._a,this._c,this._b,this._d,this._tx,this._ty]},getTranslation:function(){return new Point(this._tx,this._ty)},getScaling:function(){return(this.decompose()||{}).scaling},getRotation:function(){return(this.decompose()||{}).rotation},inverted:function(){var det=this._getDeterminant();return det&&new Matrix(this._d/det,-this._c/det,-this._b/det,this._a/det,(this._b*this._ty-this._d*this._tx)/det,(this._c*this._tx-this._a*this._ty)/det)},shiftless:function(){return new Matrix(this._a,this._c,this._b,this._d,0,0)},applyToContext:function(ctx){ctx.transform(this._a,this._c,this._b,this._d,this._tx,this._ty)}},new function(){return Base.each(["a","c","b","d","tx","ty"],function(name){var part=Base.capitalize(name),prop="_"+name;this["get"+part]=function(){return this[prop]},this["set"+part]=function(value){this[prop]=value,this._changed()}},{})}),Line=Base.extend({_class:"Line",initialize:function Line(arg0,arg1,arg2,arg3,arg4){var asVector=!1;4<=arguments.length?(this._px=arg0,this._py=arg1,this._vx=arg2,this._vy=arg3,asVector=arg4):(this._px=arg0.x,this._py=arg0.y,this._vx=arg1.x,this._vy=arg1.y,asVector=arg2),asVector||(this._vx-=this._px,this._vy-=this._py)},getPoint:function(){return new Point(this._px,this._py)},getVector:function(){return new Point(this._vx,this._vy)},getLength:function(){return this.getVector().getLength()},intersect:function(line,isInfinite){return Line.intersect(this._px,this._py,this._vx,this._vy,line._px,line._py,line._vx,line._vy,!0,isInfinite)},getSide:function(point){return Line.getSide(this._px,this._py,this._vx,this._vy,point.x,point.y,!0)},getDistance:function(point){return Math.abs(Line.getSignedDistance(this._px,this._py,this._vx,this._vy,point.x,point.y,!0))},statics:{intersect:function(apx,apy,avx,avy,bpx,bpy,bvx,bvy,asVector,isInfinite){asVector||(avx-=apx,avy-=apy,bvx-=bpx,bvy-=bpy);var cross=bvy*avx-bvx*avy;if(!Numerical.isZero(cross)){var dx=apx-bpx,dy=apy-bpy,ta=(bvx*dy-bvy*dx)/cross,tb=(avx*dy-avy*dx)/cross;if((isInfinite||0<=ta&&1>=ta)&&(isInfinite||0<=tb&&1>=tb))return new Point(apx+ta*avx,apy+ta*avy)}},getSide:function(px,py,vx,vy,x,y,asVector){asVector||(vx-=px,vy-=py);var v2x=x-px,v2y=y-py,ccw=v2x*vy-v2y*vx;return 0==ccw&&(ccw=v2x*vx+v2y*vy,0<ccw&&(v2x-=vx,v2y-=vy,ccw=v2x*vx+v2y*vy,0>ccw&&(ccw=0))),0>ccw?-1:0<ccw?1:0},getSignedDistance:function(px,py,vx,vy,x,y,asVector){asVector||(vx-=px,vy-=py);var m=vy/vx,b=py-m*px;return(y-m*x-b)/Math.sqrt(m*m+1)}}}),Project=PaperScopeItem.extend({_class:"Project",_list:"projects",_reference:"project",initialize:function Project(view){PaperScopeItem.call(this,!0),this.layers=[],this.symbols=[],this._currentStyle=new Style,this.activeLayer=new Layer,view&&(this.view=view instanceof View?view:View.create(view)),this._selectedItems={},this._selectedItemCount=0,this._updateVersion=0,this.options={}},_serialize:function(options,dictionary){return Base.serialize(this.layers,options,!0,dictionary)},clear:function(){for(var i=this.layers.length-1;0<=i;i--)this.layers[i].remove();this.symbols=[]},isEmpty:function(){return 1>=this.layers.length&&(!this.activeLayer||this.activeLayer.isEmpty())},remove:function remove(){return!!remove.base.call(this)&&(this.view&&this.view.remove(),!0)},getCurrentStyle:function(){return this._currentStyle},setCurrentStyle:function(style){this._currentStyle.initialize(style)},getIndex:function(){return this._index},addChild:function(child){return child instanceof Layer?(Base.splice(this.layers,[child]),!this.activeLayer&&(this.activeLayer=child)):child instanceof Item?(this.activeLayer||this.addChild(new Layer({insert:!1}))).addChild(child):child=null,child},getSelectedItems:function(){var items=[];for(var id in this._selectedItems){var item=this._selectedItems[id];item.isInserted()&&items.push(item)}return items},_updateSelection:function(item){var id=item._id,selectedItems=this._selectedItems;item._selected?selectedItems[id]!==item&&(this._selectedItemCount++,selectedItems[id]=item):selectedItems[id]===item&&(this._selectedItemCount--,delete selectedItems[id])},selectAll:function(){for(var layers=this.layers,i=0,l=layers.length;i<l;i++)layers[i].setFullySelected(!0)},deselectAll:function(){var selectedItems=this._selectedItems;for(var i in selectedItems)selectedItems[i].setFullySelected(!1)},hitTest:function(){for(var point=Point.read(arguments),options=HitResult.getOptions(Base.read(arguments)),i=this.layers.length-1,res;0<=i;i--)if(res=this.layers[i].hitTest(point,options),res)return res;return null}},new function(){function getItems(project,match,list){for(var layers=project.layers,items=list&&[],i=0,l=layers.length,res;i<l;i++)if(res=layers[i][list?"getItems":"getItem"](match),list)items.push.apply(items,res);else if(res)return res;return list?items:null}return{getItems:function(match){return getItems(this,match,!0)},getItem:function(match){return getItems(this,match,!1)}}},{importJSON:function(json){this.activate();var layer=this.activeLayer;return Base.importJSON(json,layer&&layer.isEmpty()&&layer)},draw:function(ctx,matrix,ratio){this._updateVersion++,ctx.save(),matrix.applyToContext(ctx);for(var param=new Base({offset:new Point(0,0),ratio:ratio,trackTransforms:!0}),i=0,l=this.layers.length;i<l;i++)this.layers[i].draw(ctx,param);if(ctx.restore(),0<this._selectedItemCount){for(var id in ctx.save(),ctx.strokeWidth=1,this._selectedItems){var item=this._selectedItems[id];if(item._updateVersion===this._updateVersion&&(item._drawSelected||item._boundsSelected)){var color=item.getSelectedColor()||item.getLayer().getSelectedColor();ctx.strokeStyle=ctx.fillStyle=color?color.toCanvasStyle(ctx):"#009dec";var mx=matrix.clone().concatenate(item._globalMatrix);if(item._drawSelected&&item._drawSelected(ctx,mx),item._boundsSelected){var coords=mx._transformCorners(item.getInternalBounds());ctx.beginPath();for(var i=0;8>i;i++)ctx[0===i?"moveTo":"lineTo"](coords[i],coords[++i]);ctx.closePath(),ctx.stroke();for(var i=0;8>i;i++)ctx.beginPath(),ctx.rect(coords[i]-2,coords[++i]-2,4,4),ctx.fill()}}}ctx.restore()}}}),Symbol=Base.extend({_class:"Symbol",initialize:function Symbol(item,dontCenter){this._id=Symbol._id=(Symbol._id||0)+1,this.project=paper.project,this.project.symbols.push(this),item&&this.setDefinition(item,dontCenter)},_serialize:function(options,dictionary){return dictionary.add(this,function(){return Base.serialize([this._class,this._definition],options,!1,dictionary)})},_changed:function(flags){4&flags&&Item._clearBoundsCache(this),1&flags&&(this.project._needsUpdate=!0)},getDefinition:function(){return this._definition},setDefinition:function(item,_dontCenter){item._parentSymbol&&(item=item.clone()),this._definition&&(this._definition._parentSymbol=null),this._definition=item,item.remove(),item.setSelected(!1),_dontCenter||item.setPosition(new Point),item._parentSymbol=this,this._changed(5)},place:function(position){return new PlacedSymbol(this,position)},clone:function(){return new Symbol(this._definition.clone(!1))}}),Item=Base.extend(Callback,{statics:{extend:function extend(src){src._serializeFields&&(src._serializeFields=new Base(this.prototype._serializeFields,src._serializeFields));var res=extend.base.apply(this,arguments),proto=res.prototype,name=proto._class;return name&&(proto._type=Base.hyphenate(name)),res}},_class:"Item",_transformContent:!0,_boundsSelected:!1,_selectChildren:!1,_serializeFields:{name:null,matrix:new Matrix,pivot:null,locked:!1,visible:!0,blendMode:"normal",opacity:1,guide:!1,selected:!1,clipMask:!1,data:{}},initialize:function Item(){},_initialize:function(props,point){var internal=props&&!0===props.internal;internal||(this._id=Item._id=(Item._id||0)+1);var matrix=this._matrix=new Matrix;if(point&&matrix.translate(point),matrix._owner=this,!this._project){var project=paper.project;internal||props&&!1===props.insert?this._setProject(project):(project.activeLayer||new Layer).addChild(this)}return this._style=new Style(this._project._currentStyle,this),!props||this._set(props,{insert:!0})},_events:new function(){var mouseFlags={mousedown:{mousedown:1,mousedrag:1,click:1,doubleclick:1},mouseup:{mouseup:1,mousedrag:1,click:1,doubleclick:1},mousemove:{mousedrag:1,mousemove:1,mouseenter:1,mouseleave:1}},mouseEvent={install:function(type){var counters=this._project.view._eventCounters;if(counters)for(var key in mouseFlags)counters[key]=(counters[key]||0)+(mouseFlags[key][type]||0)},uninstall:function(type){var counters=this._project.view._eventCounters;if(counters)for(var key in mouseFlags)counters[key]-=mouseFlags[key][type]||0}};return Base.each(["onMouseDown","onMouseUp","onMouseDrag","onClick","onDoubleClick","onMouseMove","onMouseEnter","onMouseLeave"],function(name){this[name]=mouseEvent},{onFrame:{install:function(){this._animateItem(!0)},uninstall:function(){this._animateItem(!1)}},onLoad:{}})},_animateItem:function(animate){this._project.view._animateItem(this,animate)},_serialize:function(options,dictionary){function serialize(fields){for(var key in fields){var value=that[key];Base.equals(value,"leading"==key?1.2*fields.fontSize:fields[key])||(props[key]=Base.serialize(value,options,"data"!=key,dictionary))}}var props={},that=this;return serialize(this._serializeFields),this instanceof Group||serialize(this._style._defaults),[this._class,props]},_changed:function(flags){var symbol=this._parentSymbol,cacheParent=this._parent||symbol,project=this._project;if(4&flags&&(this._bounds=this._position=this._decomposed=this._globalMatrix=void 0),cacheParent&&12&flags&&Item._clearBoundsCache(cacheParent),2&flags&&Item._clearBoundsCache(this),project&&(1&flags&&(project._needsUpdate=!0),project._changes)){var entry=project._changesById[this._id];entry?entry.flags|=flags:(entry={item:this,flags:flags},project._changesById[this._id]=entry,project._changes.push(entry))}symbol&&symbol._changed(flags)},set:function(props){return props&&this._set(props,{insert:!0}),this},getId:function(){return this._id},getType:function(){return this._type},getName:function(){return this._name},setName:function(name,unique){if(this._name&&this._removeNamed(),name===+name+"")throw new Error("Names consisting only of numbers are not supported.");if(name&&this._parent){for(var children=this._parent._children,namedChildren=this._parent._namedChildren,orig=name,i=1;unique&&children[name];)name=orig+" "+i++;(namedChildren[name]=namedChildren[name]||[]).push(this),children[name]=this}this._name=name||void 0,this._changed(32)},getStyle:function(){return this._style},setStyle:function(style){this.getStyle().set(style)},hasFill:function(){return this.getStyle().hasFill()},hasStroke:function(){return this.getStyle().hasStroke()},hasShadow:function(){return this.getStyle().hasShadow()}},Base.each(["locked","visible","blendMode","opacity","guide"],function(name){var part=Base.capitalize(name),name="_"+name;this["get"+part]=function(){return this[name]},this["set"+part]=function(value){value!=this[name]&&(this[name]=value,this._changed("_locked"===name?32:33))}},{}),{_locked:!1,_visible:!0,_blendMode:"normal",_opacity:1,_guide:!1,isSelected:function(){if(this._selectChildren)for(var i=0,l=this._children.length;i<l;i++)if(this._children[i].isSelected())return!0;return this._selected},setSelected:function(selected,noChildren){if(!noChildren&&this._selectChildren)for(var i=0,l=this._children.length;i<l;i++)this._children[i].setSelected(selected);(selected=!!selected)^this._selected&&(this._selected=selected,this._project._updateSelection(this),this._changed(33))},_selected:!1,isFullySelected:function(){if(this._children&&this._selected){for(var i=0,l=this._children.length;i<l;i++)if(!this._children[i].isFullySelected())return!1;return!0}return this._selected},setFullySelected:function(selected){if(this._children)for(var i=0,l=this._children.length;i<l;i++)this._children[i].setFullySelected(selected);this.setSelected(selected,!0)},isClipMask:function(){return this._clipMask},setClipMask:function(clipMask){this._clipMask!=(clipMask=!!clipMask)&&(this._clipMask=clipMask,clipMask&&(this.setFillColor(null),this.setStrokeColor(null)),this._changed(33),this._parent&&this._parent._changed(256))},_clipMask:!1,getData:function(){return this._data||(this._data={}),this._data},setData:function(data){this._data=data},getPosition:function(_dontLink){var position=this._position,ctor=_dontLink?Point:LinkedPoint;if(!position){var pivot=this._pivot;position=this._position=pivot?this._matrix._transformPoint(pivot):this.getBounds().getCenter(!0)}return new ctor(position.x,position.y,this,"setPosition")},setPosition:function(){this.translate(Point.read(arguments).subtract(this.getPosition(!0)))},getPivot:function(_dontLink){var pivot=this._pivot;if(pivot){var ctor=_dontLink?Point:LinkedPoint;pivot=new ctor(pivot.x,pivot.y,this,"setAnchor")}return pivot},setPivot:function(){this._pivot=Point.read(arguments),this._position=void 0},_pivot:null,getRegistration:"#getPivot",setRegistration:"#setPivot"},Base.each(["bounds","strokeBounds","handleBounds","roughBounds","internalBounds","internalRoughBounds"],function(key){var getter="get"+Base.capitalize(key),match=key.match(/^internal(.*)$/),internalGetter=match?"get"+match[1]:null;this[getter]=function(_matrix){var boundsGetter=this._boundsGetter,name=!internalGetter&&("string"==typeof boundsGetter?boundsGetter:boundsGetter&&boundsGetter[getter])||getter,bounds=this._getCachedBounds(name,_matrix,null,internalGetter);return"bounds"===key?new LinkedRectangle(bounds.x,bounds.y,bounds.width,bounds.height,this,"setBounds"):bounds},this[key]={get:this[getter]}},{_getBounds:function(getter,matrix,cacheItem){var children=this._children;if(!children||0==children.length)return new Rectangle;for(var x1=Infinity,x2=-x1,y1=x1,y2=x2,i=0,l=children.length,child;i<l;i++)if(child=children[i],child._visible&&!child.isEmpty()){var rect=child._getCachedBounds(getter,matrix,cacheItem);x1=Math.min(rect.x,x1),y1=Math.min(rect.y,y1),x2=Math.max(rect.x+rect.width,x2),y2=Math.max(rect.y+rect.height,y2)}return isFinite(x1)?new Rectangle(x1,y1,x2-x1,y2-y1):new Rectangle},setBounds:function(){var rect=Rectangle.read(arguments),bounds=this.getBounds(),matrix=new Matrix,center=rect.getCenter();matrix.translate(center),(rect.width!=bounds.width||rect.height!=bounds.height)&&matrix.scale(0==bounds.width?1:rect.width/bounds.width,0==bounds.height?1:rect.height/bounds.height),center=bounds.getCenter(),matrix.translate(-center.x,-center.y),this.transform(matrix)},_getCachedBounds:function(getter,matrix,cacheItem,internalGetter){matrix=matrix&&matrix.orNullIfIdentity();var _matrix=internalGetter?null:this._matrix.orNullIfIdentity(),cache=(!matrix||matrix.equals(_matrix))&&getter,cacheParent=this._parent||this._parentSymbol;if(cacheItem&&cacheParent){var id=cacheItem._id,ref=cacheParent._boundsCache=cacheParent._boundsCache||{ids:{},list:[]};ref.ids[id]||(ref.list.push(cacheItem),ref.ids[id]=cacheItem)}if(cache&&this._bounds&&this._bounds[cache])return this._bounds[cache].clone();matrix=matrix?_matrix?matrix.clone().concatenate(_matrix):matrix:_matrix;var bounds=this._getBounds(internalGetter||getter,matrix,cache?this:cacheItem);if(cache){this._bounds||(this._bounds={});var cached=this._bounds[cache]=bounds.clone();cached._internal=!!internalGetter}return bounds},statics:{_clearBoundsCache:function(item){if(item._boundsCache){for(var i=0,list=item._boundsCache.list,l=list.length,child;i<l;i++)child=list[i],child._bounds=child._position=void 0,child!==item&&child._boundsCache&&child._clearBoundsCache();item._boundsCache=void 0}}}}),{_decompose:function(){return this._decomposed=this._matrix.decompose()},getRotation:function(){var decomposed=this._decomposed||this._decompose();return decomposed&&decomposed.rotation},setRotation:function(rotation){var current=this.getRotation();if(null!=current&&null!=rotation){var decomposed=this._decomposed;this.rotate(rotation-current),decomposed.rotation=rotation,this._decomposed=decomposed}},getScaling:function(){var decomposed=this._decomposed||this._decompose();return decomposed&&decomposed.scaling},setScaling:function(){var current=this.getScaling();if(null!=current){var scaling=Point.read(arguments,0,{clone:!0}),decomposed=this._decomposed;this.scale(scaling.x/current.x,scaling.y/current.y),decomposed.scaling=scaling,this._decomposed=decomposed}},getMatrix:function(){return this._matrix},setMatrix:function(matrix){this._matrix.initialize(matrix),this._transformContent&&this.applyMatrix(!0),this._changed(5)},getGlobalMatrix:function(){var matrix=this._globalMatrix,updateVersion=this._project._updateVersion;return matrix&&matrix._updateVersion!==updateVersion&&(matrix=null),matrix||(matrix=this._globalMatrix=this._matrix.clone(),this._parent&&matrix.preConcatenate(this._parent.getGlobalMatrix()),matrix._updateVersion=updateVersion),matrix},getTransformContent:function(){return this._transformContent},setTransformContent:function(transform){this._transformContent=transform,transform&&this.applyMatrix()},getProject:function(){return this._project},_setProject:function(project,installEvents){if(this._project!==project){this._project&&this._installEvents(!1),this._project=project;for(var children=this._children,i=0,l=children&&children.length;i<l;i++)children[i]._setProject(project);installEvents=!0}installEvents&&this._installEvents(!0)},_installEvents:function _installEvents(install){_installEvents.base.call(this,install);for(var children=this._children,i=0,l=children&&children.length;i<l;i++)children[i]._installEvents(install)},getLayer:function(){for(var parent=this;parent=parent._parent;)if(parent instanceof Layer)return parent;return null},getParent:function(){return this._parent},setParent:function(item){return item.addChild(this)},getChildren:function(){return this._children},setChildren:function(items){this.removeChildren(),this.addChildren(items)},getFirstChild:function(){return this._children&&this._children[0]||null},getLastChild:function(){return this._children&&this._children[this._children.length-1]||null},getNextSibling:function(){return this._parent&&this._parent._children[this._index+1]||null},getPreviousSibling:function(){return this._parent&&this._parent._children[this._index-1]||null},getIndex:function(){return this._index},isInserted:function(){return!!this._parent&&this._parent.isInserted()},equals:function(item){return item===this||item&&this._class===item._class&&this._style.equals(item._style)&&this._matrix.equals(item._matrix)&&this._locked===item._locked&&this._visible===item._visible&&this._blendMode===item._blendMode&&this._opacity===item._opacity&&this._clipMask===item._clipMask&&this._guide===item._guide&&this._equals(item)||!1},_equals:function(item){return Base.equals(this._children,item._children)},clone:function(insert){return this._clone(new this.constructor({insert:!1}),insert)},_clone:function(copy,insert){if(copy.setStyle(this._style),this._children)for(var i=0,l=this._children.length;i<l;i++)copy.addChild(this._children[i].clone(!1),!0);(insert||void 0===insert)&&copy.insertAbove(this);for(var keys=["_locked","_visible","_blendMode","_opacity","_clipMask","_guide"],i=0,l=keys.length,key;i<l;i++)key=keys[i],this.hasOwnProperty(key)&&(copy[key]=this[key]);return copy._matrix.initialize(this._matrix),copy._data=this._data?Base.clone(this._data):null,copy.setSelected(this._selected),this._name&&copy.setName(this._name,!0),copy},copyTo:function(itemOrProject){return itemOrProject.addChild(this.clone(!1))},rasterize:function(resolution){var bounds=this.getStrokeBounds(),scale=(resolution||72)/72,topLeft=bounds.getTopLeft().floor(),bottomRight=bounds.getBottomRight().ceil();size=new Size(bottomRight.subtract(topLeft)),canvas=CanvasProvider.getCanvas(size),ctx=canvas.getContext("2d"),matrix=new Matrix().scale(scale).translate(topLeft.negate()),ctx.save(),matrix.applyToContext(ctx),this.draw(ctx,new Base({transforms:[matrix]})),ctx.restore();var raster=new Raster({canvas:canvas,insert:!1});return raster.setPosition(topLeft.add(size.divide(2))),raster.insertAbove(this),raster},contains:function(){return!!this._contains(this._matrix._inverseTransform(Point.read(arguments)))},_contains:function(point){if(this._children){for(var i=this._children.length-1;0<=i;i--)if(this._children[i].contains(point))return!0;return!1}return point.isInside(this.getInternalBounds())},isInside:function(){return Rectangle.read(arguments).contains(this.getBounds())},_asPathItem:function(){return new Path.Rectangle({rectangle:this.getInternalBounds(),matrix:this._matrix,insert:!1})},intersects:function(item,_matrix){return!!(item instanceof Item)&&0<this._asPathItem().getIntersections(item._asPathItem(),null,_matrix,!0).length},hitTest:function(point,options){function checkBounds(type,part){var pt=bounds["get"+part]();if(1>=point.subtract(pt).divide(tolerancePadding).length)return new HitResult(type,that,{name:Base.hyphenate(part),point:pt})}if(point=Point.read(arguments),options=HitResult.getOptions(Base.read(arguments)),this._locked||!this._visible||this._guide&&!options.guides||this.isEmpty())return null;var matrix=this._matrix,parentTotalMatrix=options._totalMatrix,view=this._project.view,totalMatrix=options._totalMatrix=parentTotalMatrix?parentTotalMatrix.clone().concatenate(matrix):this.getGlobalMatrix().clone().preConcatenate(view?view._matrix:new Matrix),tolerancePadding=options._tolerancePadding=new Size(Path._getPenPadding(1,totalMatrix.inverted())).multiply(Math.max(options.tolerance,0.00001));if(point=matrix._inverseTransform(point),!this._children&&!this.getInternalRoughBounds().expand(tolerancePadding.multiply(2))._containsPoint(point))return null;var checkSelf=!(options.guides&&!this._guide||options.selected&&!this._selected||options.type&&this._type!==options.type),that=this,res;if(checkSelf&&(options.center||options.bounds)&&this._parent){var bounds=this.getInternalBounds();if(options.center&&(res=checkBounds("center","Center")),!res&&options.bounds)for(var points=["TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],i=0;8>i&&!res;i++)res=checkBounds("bounds",points[i])}var children=!res&&this._children;if(children)for(var opts=this._getChildHitTestOptions(options),i=children.length-1;0<=i&&!res;i--)res=children[i].hitTest(point,opts);return!res&&checkSelf&&(res=this._hitTest(point,options)),res&&res.point&&(res.point=matrix.transform(res.point)),options._totalMatrix=parentTotalMatrix,res},_getChildHitTestOptions:function(options){return options},_hitTest:function(point,options){if(options.fill&&this.hasFill()&&this._contains(point))return new HitResult("fill",this)},matches:function(match){function matchObject(obj1,obj2){for(var i in obj1)if(obj1.hasOwnProperty(i)){var val1=obj1[i],val2=obj2[i];if(Base.isPlainObject(val1)&&Base.isPlainObject(val2)){if(!matchObject(val1,val2))return!1;}else if(!Base.equals(val1,val2))return!1}return!0}for(var key in match)if(match.hasOwnProperty(key)){var value=this[key],compare=match[key];if(compare instanceof RegExp){if(!compare.test(value))return!1;}else if("function"==typeof compare){if(!compare(value))return!1;}else if(Base.isPlainObject(compare)){if(!matchObject(compare,value))return!1;}else if(!Base.equals(value,compare))return!1}return!0}},new function(){function getItems(item,match,list){for(var children=item._children,items=list&&[],i=0,l=children&&children.length,child;i<l;i++){if(child=children[i],child.matches(match))if(list)items.push(child);else return child;var res=getItems(child,match,list);if(list)items.push.apply(items,res);else if(res)return res}return list?items:null}return{getItems:function(match){return getItems(this,match,!0)},getItem:function(match){return getItems(this,match,!1)}}},{importJSON:function(json){var res=Base.importJSON(json,this);return res===this?res:this.addChild(res)},addChild:function(item,_preserve){return this.insertChild(void 0,item,_preserve)},insertChild:function(index,item,_preserve){var res=this.insertChildren(index,[item],_preserve);return res&&res[0]},addChildren:function(items,_preserve){return this.insertChildren(this._children.length,items,_preserve)},insertChildren:function(index,items,_preserve,_type){var children=this._children;if(children&&items&&0<items.length){items=Array.prototype.slice.apply(items);for(var i=items.length-1,item;0<=i;i--)item=items[i],_type&&item._type!==_type?items.splice(i,1):item._remove(!0);Base.splice(children,items,index,0);for(var i=0,l=items.length,item;i<l;i++)item=items[i],item._parent=this,item._setProject(this._project,!0),item._name&&item.setName(item._name);this._changed(7)}else items=null;return items},_insert:function(above,item,_preserve){if(!item._parent)return null;var index=item._index+(above?1:0);return item._parent===this._parent&&index>this._index&&index--,item._parent.insertChild(index,this,_preserve)},insertAbove:function(item,_preserve){return this._insert(!0,item,_preserve)},insertBelow:function(item,_preserve){return this._insert(!1,item,_preserve)},sendToBack:function(){return this._parent.insertChild(0,this)},bringToFront:function(){return this._parent.addChild(this)},appendTop:"#addChild",appendBottom:function(item){return this.insertChild(0,item)},moveAbove:"#insertAbove",moveBelow:"#insertBelow",reduce:function(){if(this._children&&1===this._children.length){var child=this._children[0];return child.insertAbove(this),child.setStyle(this._style),this.remove(),child}return this},_removeNamed:function(){var children=this._parent._children,namedChildren=this._parent._namedChildren,name=this._name,namedArray=namedChildren[name],index=namedArray?namedArray.indexOf(this):-1;-1==index||(children[name]==this&&delete children[name],namedArray.splice(index,1),namedArray.length?children[name]=namedArray[namedArray.length-1]:delete namedChildren[name])},_remove:function(notify){return!!this._parent&&(this._name&&this._removeNamed(),null!=this._index&&Base.splice(this._parent._children,null,this._index,1),this._installEvents(!1),notify&&this._parent._changed(7),this._parent=null,!0)},remove:function(){return this._remove(!0)},removeChildren:function(from,to){if(!this._children)return null;from=from||0,to=Base.pick(to,this._children.length);for(var removed=Base.splice(this._children,null,from,to-from),i=removed.length-1;0<=i;i--)removed[i]._remove(!1);return 0<removed.length&&this._changed(7),removed},clear:"#removeChildren",reverseChildren:function(){if(this._children){this._children.reverse();for(var i=0,l=this._children.length;i<l;i++)this._children[i]._index=i;this._changed(7)}},isEmpty:function(){return!this._children||0==this._children.length},isEditable:function(){for(var item=this;item;){if(!item._visible||item._locked)return!1;item=item._parent}return!0},_getOrder:function(item){function getList(item){var list=[];do list.unshift(item);while(item=item._parent);return list}for(var list1=getList(this),list2=getList(item),i=0,l=Math.min(list1.length,list2.length);i<l;i++)if(list1[i]!=list2[i])return list1[i]._index<list2[i]._index?1:-1;return 0},hasChildren:function(){return this._children&&0<this._children.length},isAbove:function(item){return-1===this._getOrder(item)},isBelow:function(item){return 1===this._getOrder(item)},isParent:function(item){return this._parent===item},isChild:function(item){return item&&item._parent===this},isDescendant:function(item){for(var parent=this;parent=parent._parent;)if(parent==item)return!0;return!1},isAncestor:function(item){return!!item&&item.isDescendant(this)},isGroupedWith:function(item){for(var parent=this._parent;parent;){if(parent._parent&&/^(group|layer|compound-path)$/.test(parent._type)&&item.isDescendant(parent))return!0;parent=parent._parent}return!1},translate:function(){var mx=new Matrix;return this.transform(mx.translate.apply(mx,arguments))},rotate:function(angle){return this.transform(new Matrix().rotate(angle,Point.read(arguments,1,{readNull:!0})||this.getPosition(!0)))}},Base.each(["scale","shear","skew"],function(name){this[name]=function(){var point=Point.read(arguments),center=Point.read(arguments,0,{readNull:!0});return this.transform(new Matrix()[name](point,center||this.getPosition(!0)))}},{}),{transform:function(matrix,_applyMatrix){if(matrix.isIdentity())return this;var bounds=this._bounds,position=this._position;this._matrix.preConcatenate(matrix),(this._transformContent||_applyMatrix)&&this.applyMatrix(!0),this._changed(5);var decomp=bounds&&matrix.decompose();if(decomp&&!decomp.shearing&&0==decomp.rotation%90){for(var key in bounds){var rect=bounds[key];(this._transformContent||!rect._internal)&&matrix._transformBounds(rect,rect)}var getter=this._boundsGetter,rect=bounds[getter&&getter.getBounds||getter||"getBounds"];rect&&(this._position=rect.getCenter(!0)),this._bounds=bounds}else position&&(this._position=matrix._transformPoint(position,position));return this},_applyMatrix:function(matrix,applyMatrix){var children=this._children;if(children&&0<children.length){for(var i=0,l=children.length;i<l;i++)children[i].transform(matrix,applyMatrix);return!0}},applyMatrix:function(_dontNotify){var matrix=this._matrix;if(this._applyMatrix(matrix,!0)){var pivot=this._pivot,style=this._style,fillColor=style.getFillColor(!0),strokeColor=style.getStrokeColor(!0);pivot&&pivot.transform(matrix),fillColor&&fillColor.transform(matrix),strokeColor&&strokeColor.transform(matrix),matrix.reset(!0)}return _dontNotify||this._changed(5),this},globalToLocal:function(){var matrix=this.getGlobalMatrix();return matrix&&matrix._inverseTransform(Point.read(arguments))},localToGlobal:function(){var matrix=this.getGlobalMatrix();return matrix&&matrix._transformPoint(Point.read(arguments))},fitBounds:function(rectangle,fill){rectangle=Rectangle.read(arguments);var bounds=this.getBounds(),itemRatio=bounds.height/bounds.width,rectRatio=rectangle.height/rectangle.width,scale=(fill?itemRatio>rectRatio:itemRatio<rectRatio)?rectangle.width/bounds.width:rectangle.height/bounds.height,newBounds=new Rectangle(new Point(),new Size(bounds.width*scale,bounds.height*scale));newBounds.setCenter(rectangle.getCenter()),this.setBounds(newBounds)},_setStyles:function(ctx){var style=this._style,fillColor=style.getFillColor(),strokeColor=style.getStrokeColor(),shadowColor=style.getShadowColor();if(fillColor&&(ctx.fillStyle=fillColor.toCanvasStyle(ctx)),strokeColor){var strokeWidth=style.getStrokeWidth();if(0<strokeWidth){ctx.strokeStyle=strokeColor.toCanvasStyle(ctx),ctx.lineWidth=strokeWidth;var strokeJoin=style.getStrokeJoin(),strokeCap=style.getStrokeCap(),miterLimit=style.getMiterLimit();if(strokeJoin&&(ctx.lineJoin=strokeJoin),strokeCap&&(ctx.lineCap=strokeCap),miterLimit&&(ctx.miterLimit=miterLimit),paper.support.nativeDash){var dashArray=style.getDashArray(),dashOffset=style.getDashOffset();dashArray&&dashArray.length&&("setLineDash"in ctx?(ctx.setLineDash(dashArray),ctx.lineDashOffset=dashOffset):(ctx.mozDash=dashArray,ctx.mozDashOffset=dashOffset))}}}if(shadowColor){var shadowBlur=style.getShadowBlur();if(0<shadowBlur){ctx.shadowColor=shadowColor.toCanvasStyle(ctx),ctx.shadowBlur=shadowBlur;var offset=this.getShadowOffset();ctx.shadowOffsetX=offset.x,ctx.shadowOffsetY=offset.y}}},draw:function(ctx,param){if(this._visible&&0!==this._opacity){var updateVersion=this._updateVersion=this._project._updateVersion,trackTransforms=param.trackTransforms,transforms=param.transforms=param.transforms||[new Matrix],matrix=this._matrix,parentMatrix=transforms[transforms.length-1],globalMatrix=parentMatrix.clone().concatenate(matrix);if(globalMatrix.isInvertible()){trackTransforms&&(!transforms&&(transforms=param.transforms=[]),transforms.push(this._globalMatrix=globalMatrix),globalMatrix._updateVersion=updateVersion);var blendMode=this._blendMode,opacity=this._opacity,normalBlend="normal"===blendMode,nativeBlend=BlendMode.nativeModes[blendMode],direct=normalBlend&&1===opacity||(nativeBlend||normalBlend&&1>opacity)&&this._canComposite(),mainCtx,itemOffset,prevOffset;if(!direct){var bounds=this.getStrokeBounds(parentMatrix);if(!bounds.width||!bounds.height)return;prevOffset=param.offset,itemOffset=param.offset=bounds.getTopLeft().floor(),mainCtx=ctx,ctx=CanvasProvider.getContext(bounds.getSize().ceil().add(new Size(1,1)),param.ratio)}ctx.save(),direct?(ctx.globalAlpha=opacity,nativeBlend&&(ctx.globalCompositeOperation=blendMode)):ctx.translate(-itemOffset.x,-itemOffset.y),(direct?matrix:globalMatrix).applyToContext(ctx),!direct&&param.clipItem&&param.clipItem.draw(ctx,param.extend({clip:!0})),this._draw(ctx,param),ctx.restore(),trackTransforms&&transforms.pop(),param.clip&&ctx.clip(),direct||(BlendMode.process(blendMode,ctx,mainCtx,opacity,itemOffset.subtract(prevOffset).multiply(param.ratio)),CanvasProvider.release(ctx),param.offset=prevOffset)}}},_canComposite:function(){return!1}},Base.each(["down","drag","up","move"],function(name){this["removeOn"+Base.capitalize(name)]=function(){var hash={};return hash[name]=!0,this.removeOn(hash)}},{removeOn:function(obj){for(var name in obj)if(obj[name]){var key="mouse"+name,project=this._project,sets=project._removeSets=project._removeSets||{};sets[key]=sets[key]||{},sets[key][this._id]=this}return this}})),Group=Item.extend({_class:"Group",_selectChildren:!0,_serializeFields:{children:[]},initialize:function Group(arg){this._children=[],this._namedChildren={},this._initialize(arg)||this.addChildren(Array.isArray(arg)?arg:arguments)},_changed:function _changed(flags){_changed.base.call(this,flags),2&flags&&this._transformContent&&!this._matrix.isIdentity()&&this.applyMatrix(),258&flags&&(this._clipItem=void 0)},_getClipItem:function(){if(void 0!==this._clipItem)return this._clipItem;for(var i=0,l=this._children.length,child;i<l;i++)if(child=this._children[i],child._clipMask)return this._clipItem=child;return this._clipItem=null},isClipped:function(){return!!this._getClipItem()},setClipped:function(clipped){var child=this.getFirstChild();child&&child.setClipMask(clipped)},_draw:function(ctx,param){var clipItem=param.clipItem=this._getClipItem();clipItem&&clipItem.draw(ctx,param.extend({clip:!0}));for(var i=0,l=this._children.length,item;i<l;i++)item=this._children[i],item!==clipItem&&item.draw(ctx,param);param.clipItem=null}}),Layer=Group.extend({_class:"Layer",initialize:function Layer(arg){var props=Base.isPlainObject(arg)?new Base(arg):{children:Array.isArray(arg)?arg:arguments},insert=props.insert;props.insert=!1,Group.call(this,props),(insert||void 0===insert)&&(this._project.addChild(this),this.activate())},_remove:function _remove(notify){return this._parent?_remove.base.call(this,notify):null!=this._index&&(this._project.activeLayer===this&&(this._project.activeLayer=this.getNextSibling()||this.getPreviousSibling()),Base.splice(this._project.layers,null,this._index,1),this._installEvents(!1),this._project._needsUpdate=!0,!0)},getNextSibling:function getNextSibling(){return this._parent?getNextSibling.base.call(this):this._project.layers[this._index+1]||null},getPreviousSibling:function getPreviousSibling(){return this._parent?getPreviousSibling.base.call(this):this._project.layers[this._index-1]||null},isInserted:function isInserted(){return this._parent?isInserted.base.call(this):null!=this._index},activate:function(){this._project.activeLayer=this},_insert:function _insert(above,item,_preserve){return item instanceof Layer&&!item._parent?(this._remove(!0),Base.splice(item._project.layers,[this],item._index+(above?1:0),0),this._setProject(item._project,!0),this):_insert.base.call(this,above,item,_preserve)}}),Shape=Item.extend({_class:"Shape",_transformContent:!1,_boundsSelected:!0,_serializeFields:{shape:null,size:null,radius:null},initialize:function Shape(props){this._initialize(props)},_equals:function(item){return this._shape===item._shape&&this._size.equals(item._size)&&Base.equals(this._radius,item._radius)},clone:function(insert){return this._clone(new Shape({shape:this._shape,size:this._size,radius:this._radius,insert:!1}),insert)},getShape:function(){return this._shape},setShape:function(shape){this._shape=shape},getSize:function(){var size=this._size;return new LinkedSize(size.width,size.height,this,"setSize")},setSize:function(){var size=Size.read(arguments);if(!this._size)this._size=size.clone();else if(!this._size.equals(size)){var shape=this._shape,width=size.width,height=size.height;if("rectangle"===shape){var radius=Size.min(this._radius,size.divide(2));this._radius.set(radius.width,radius.height)}else"circle"===shape?(width=height=(width+height)/2,this._radius=width/2):"ellipse"===shape&&this._radius.set(width/2,height/2);this._size.set(width,height),this._changed(5)}},getRadius:function(){var rad=this._radius;return"circle"===this._shape?rad:new LinkedSize(rad.width,rad.height,this,"setRadius")},setRadius:function(radius){var shape=this._shape;if("circle"===shape){if(radius===this._radius)return;var size=2*radius;this._radius=radius,this._size.set(size,size)}else if(radius=Size.read(arguments),!this._radius)this._radius=radius.clone();else{if(this._radius.equals(radius))return;if(this._radius.set(radius.width,radius.height),"rectangle"===shape){var size=Size.max(this._size,radius.multiply(2));this._size.set(size.width,size.height)}else"ellipse"===shape&&this._size.set(2*radius.width,2*radius.height)}this._changed(5)},isEmpty:function(){return!1},toPath:function(insert){var path=new Path[Base.capitalize(this._shape)]({center:new Point,size:this._size,radius:this._radius,insert:!1});return path.setStyle(this._style),path.transform(this._matrix),(insert||void 0===insert)&&path.insertAbove(this),path},_draw:function(ctx,param){var style=this._style,hasFill=style.hasFill(),hasStroke=style.hasStroke(),clip=param.clip;if(hasFill||hasStroke||clip){var radius=this._radius,shape=this._shape;if(ctx.beginPath(),"circle"===shape)ctx.arc(0,0,radius,0,2*Math.PI,!0);else{var rx=radius.width,ry=radius.height,kappa=Numerical.KAPPA;if("ellipse"===shape){var cx=rx*kappa,cy=ry*kappa;ctx.moveTo(-rx,0),ctx.bezierCurveTo(-rx,-cy,-cx,-ry,0,-ry),ctx.bezierCurveTo(cx,-ry,rx,-cy,rx,0),ctx.bezierCurveTo(rx,cy,cx,ry,0,ry),ctx.bezierCurveTo(-cx,ry,-rx,cy,-rx,0)}else{var size=this._size,width=size.width,height=size.height;if(0===rx&&0===ry)ctx.rect(-width/2,-height/2,width,height);else{kappa=1-kappa;var x=width/2,y=height/2,cx=rx*kappa,cy=ry*kappa;ctx.moveTo(-x,-y+ry),ctx.bezierCurveTo(-x,-y+cy,-x+cx,-y,-x+rx,-y),ctx.lineTo(x-rx,-y),ctx.bezierCurveTo(x-cx,-y,x,-y+cy,x,-y+ry),ctx.lineTo(x,y-ry),ctx.bezierCurveTo(x,y-cy,x-cx,y,x-rx,y),ctx.lineTo(-x+rx,y),ctx.bezierCurveTo(-x+cx,y,-x,y-cy,-x,y-ry)}}}ctx.closePath()}!clip&&(hasFill||hasStroke)&&(this._setStyles(ctx),hasFill&&(ctx.fill(style.getWindingRule()),ctx.shadowColor="rgba(0,0,0,0)"),hasStroke&&ctx.stroke())},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_getBounds:function(getter,matrix){var rect=new Rectangle(this._size).setCenter(0,0);return"getBounds"!==getter&&this.hasStroke()&&(rect=rect.expand(this.getStrokeWidth())),matrix?matrix._transformBounds(rect):rect}},new function(){function getCornerCenter(that,point,expand){var radius=that._radius;if(!radius.isZero())for(var halfSize=that._size.divide(2),i=0;4>i;i++){var dir=new Point(1&i?1:-1,1<i?1:-1),corner=dir.multiply(halfSize),center=corner.subtract(dir.multiply(radius)),rect=new Rectangle(corner,center);if((expand?rect.expand(expand):rect).contains(point))return center}}function getEllipseRadius(point,radius){var angle=point.getAngleInRadians(),width=2*radius.width,height=2*radius.height,x=width*Math.sin(angle),y=height*Math.cos(angle);return width*height/(2*Math.sqrt(x*x+y*y))}return{_contains:function _contains(point){if("rectangle"===this._shape){var center=getCornerCenter(this,point);return center?1>=point.subtract(center).divide(this._radius).getLength():_contains.base.call(this,point)}return 0.5>=point.divide(this.size).getLength()},_hitTest:function _hitTest(point,options){var hit=!1;if(this.hasStroke()){var shape=this._shape,radius=this._radius,strokeWidth=this.getStrokeWidth()+2*options.tolerance;if("rectangle"===shape){var center=getCornerCenter(this,point,strokeWidth);if(center){var pt=point.subtract(center);hit=2*Math.abs(pt.getLength()-getEllipseRadius(pt,radius))<=strokeWidth}else{var rect=new Rectangle(this._size).setCenter(0,0),outer=rect.expand(strokeWidth),inner=rect.expand(-strokeWidth);hit=outer._containsPoint(point)&&!inner._containsPoint(point)}}else"ellipse"===shape&&(radius=getEllipseRadius(point,radius)),hit=2*Math.abs(point.getLength()-radius)<=strokeWidth}return hit?new HitResult("stroke",this):_hitTest.base.apply(this,arguments)}}},{statics:new function(){function createShape(shape,point,size,radius,args){var item=new Shape(Base.getNamed(args));return item._shape=shape,item._size=size,item._radius=radius,item.translate(point)}return{Circle:function(){var center=Point.readNamed(arguments,"center"),radius=Base.readNamed(arguments,"radius");return createShape("circle",center,new Size(2*radius),radius,arguments)},Rectangle:function(){var rect=Rectangle.readNamed(arguments,"rectangle"),radius=Size.min(Size.readNamed(arguments,"radius"),rect.getSize(!0).divide(2));return createShape("rectangle",rect.getCenter(!0),rect.getSize(!0),radius,arguments)},Ellipse:function(){var ellipse=Shape._readEllipse(arguments);return radius=ellipse.radius,createShape("ellipse",ellipse.center,radius.multiply(2),radius,arguments)},_readEllipse:function(args){var center,radius;if(Base.hasNamed(args,"radius"))center=Point.readNamed(args,"center"),radius=Size.readNamed(args,"radius");else{var rect=Rectangle.readNamed(args,"rectangle");center=rect.getCenter(!0),radius=rect.getSize(!0).divide(2)}return{center:center,radius:radius}}}}}),Raster=Item.extend({_class:"Raster",_transformContent:!1,_boundsGetter:"getBounds",_boundsSelected:!0,_serializeFields:{source:null},initialize:function Raster(object,position){this._initialize(object,void 0!==position&&Point.read(arguments,1))||("string"==typeof object?this.setSource(object):this.setImage(object)),this._size||(this._size=new Size)},_equals:function(item){return this.getSource()===item.getSource()},clone:function(insert){var param={insert:!1},image=this._image;if(image)param.image=image;else if(this._canvas){var canvas=param.canvas=CanvasProvider.getCanvas(this._size);canvas.getContext("2d").drawImage(this._canvas,0,0)}return this._clone(new Raster(param),insert)},getSize:function(){var size=this._size;return new LinkedSize(size.width,size.height,this,"setSize")},setSize:function(){var size=Size.read(arguments);if(!this._size.equals(size)){var element=this.getElement();this.setCanvas(CanvasProvider.getCanvas(size)),element&&this.getContext(!0).drawImage(element,0,0,size.width,size.height)}},getWidth:function(){return this._size.width},getHeight:function(){return this._size.height},isEmpty:function(){return 0==this._size.width&&0==this._size.height},getPpi:function(){var matrix=this._matrix,orig=new Point(0,0).transform(matrix),u=new Point(1,0).transform(matrix).subtract(orig),v=new Point(0,1).transform(matrix).subtract(orig);return new Size(72/u.getLength(),72/v.getLength())},getImage:function(){return this._image},setImage:function(image){this._canvas&&CanvasProvider.release(this._canvas),image.getContext?(this._image=null,this._canvas=image):(this._image=image,this._canvas=null),this._size=new Size(image.naturalWidth||image.width,image.naturalHeight||image.height),this._context=null,this._changed(133)},getCanvas:function(){if(!this._canvas){var ctx=CanvasProvider.getContext(this._size);try{this._image&&ctx.drawImage(this._image,0,0),this._canvas=ctx.canvas}catch(e){CanvasProvider.release(ctx)}}return this._canvas},setCanvas:"#setImage",getContext:function(modify){return this._context||(this._context=this.getCanvas().getContext("2d")),modify&&(this._image=null,this._changed(129)),this._context},setContext:function(context){this._context=context},getSource:function(){return this._image&&this._image.src||this.toDataURL()},setSource:function(src){function loaded(){var view=that._project.view;view&&(paper=view._scope),that.setImage(image),that.fire("load"),view&&view.update()}var that=this,image;image=document.getElementById(src)||new Image,image.naturalWidth&&image.naturalHeight?setTimeout(loaded,0):(DomEvent.add(image,{load:loaded}),!image.src&&(image.src=src)),this.setImage(image)},getElement:function(){return this._canvas||this._image},getSubCanvas:function(rect){var rect=Rectangle.read(arguments),ctx=CanvasProvider.getContext(rect.getSize());return ctx.drawImage(this.getCanvas(),rect.x,rect.y,rect.width,rect.height,0,0,rect.width,rect.height),ctx.canvas},getSubRaster:function(rect){var rect=Rectangle.read(arguments),raster=new Raster({canvas:this.getSubCanvas(rect),insert:!1});return raster.translate(rect.getCenter().subtract(this.getSize().divide(2))),raster._matrix.preConcatenate(this._matrix),raster.insertAbove(this),raster},toDataURL:function(){var src=this._image&&this._image.src;if(/^data:/.test(src))return src;var canvas=this.getCanvas();return canvas?canvas.toDataURL():null},drawImage:function(image){var point=Point.read(arguments,1);this.getContext(!0).drawImage(image,point.x,point.y)},getAverageColor:function(object){var bounds,path;object?object instanceof PathItem?(path=object,bounds=object.getBounds()):object.width?bounds=new Rectangle(object):object.x&&(bounds=new Rectangle(object.x-0.5,object.y-0.5,1,1)):bounds=this.getBounds();var sampleSize=32,width=Math.min(bounds.width,sampleSize),height=Math.min(bounds.height,sampleSize),ctx=Raster._sampleContext;ctx?ctx.clearRect(0,0,sampleSize+1,sampleSize+1):ctx=Raster._sampleContext=CanvasProvider.getContext(new Size(sampleSize)),ctx.save();var matrix=new Matrix().scale(width/bounds.width,height/bounds.height).translate(-bounds.x,-bounds.y);matrix.applyToContext(ctx),path&&path.draw(ctx,new Base({clip:!0,transforms:[matrix]})),this._matrix.applyToContext(ctx),ctx.drawImage(this.getElement(),-this._size.width/2,-this._size.height/2),ctx.restore();for(var pixels=ctx.getImageData(0.5,0.5,Math.ceil(width),Math.ceil(height)).data,channels=[0,0,0],total=0,i=0,l=pixels.length,alpha;i<l;i+=4)alpha=pixels[i+3],total+=alpha,alpha/=255,channels[0]+=pixels[i]*alpha,channels[1]+=pixels[i+1]*alpha,channels[2]+=pixels[i+2]*alpha;for(var i=0;3>i;i++)channels[i]/=total;return total?Color.read(channels):null},getPixel:function(point){var point=Point.read(arguments),data=this.getContext().getImageData(point.x,point.y,1,1).data;return new Color("rgb",[data[0]/255,data[1]/255,data[2]/255],data[3]/255)},setPixel:function(){var point=Point.read(arguments),color=Color.read(arguments),components=color._convert("rgb"),alpha=color._alpha,ctx=this.getContext(!0),imageData=ctx.createImageData(1,1),data=imageData.data;data[0]=255*components[0],data[1]=255*components[1],data[2]=255*components[2],data[3]=null==alpha?255:255*alpha,ctx.putImageData(imageData,point.x,point.y)},createImageData:function(){var size=Size.read(arguments);return this.getContext().createImageData(size.width,size.height)},getImageData:function(rect){var rect=Rectangle.read(arguments);return rect.isEmpty()&&(rect=new Rectangle(this._size)),this.getContext().getImageData(rect.x,rect.y,rect.width,rect.height)},setImageData:function(data){var point=Point.read(arguments,1);this.getContext(!0).putImageData(data,point.x,point.y)},_getBounds:function(getter,matrix){var rect=new Rectangle(this._size).setCenter(0,0);return matrix?matrix._transformBounds(rect):rect},_hitTest:function(point,options){if(this._contains(point)){var that=this;return new HitResult("pixel",that,{offset:point.add(that._size.divide(2)).round(),color:{get:function(){return that.getPixel(this.offset)}}})}},_draw:function(ctx){var element=this.getElement();element&&this._size.width&&this._size.height&&(ctx.globalAlpha=this._opacity,ctx.drawImage(element,-this._size.width/2,-this._size.height/2))},_canComposite:function(){return!0}}),Sprite=function(a,b,c){return new Raster(a,b,c)},PlacedSymbol=Item.extend({_class:"PlacedSymbol",_transformContent:!1,_boundsGetter:{getBounds:"getStrokeBounds"},_boundsSelected:!0,_serializeFields:{symbol:null},initialize:function PlacedSymbol(arg0,arg1){this._initialize(arg0,void 0!==arg1&&Point.read(arguments,1))||this.setSymbol(arg0 instanceof Symbol?arg0:new Symbol(arg0))},_equals:function(item){return this._symbol===item._symbol},getSymbol:function(){return this._symbol},setSymbol:function(symbol){this._symbol=symbol,this._changed(5)},clone:function(insert){return this._clone(new PlacedSymbol({symbol:this.symbol,insert:!1}),insert)},isEmpty:function(){return this._symbol._definition.isEmpty()},_getBounds:function(getter,matrix,cacheItem){return this.symbol._definition._getCachedBounds(getter,matrix,cacheItem)},_hitTest:function(point,options,matrix){var res=this._symbol._definition._hitTest(point,options,matrix);return res&&(res.item=this),res},_draw:function(ctx,param){this.symbol._definition.draw(ctx,param)}}),HitResult=Base.extend({_class:"HitResult",initialize:function HitResult(type,item,values){this.type=type,this.item=item,values&&(values.enumerable=!0,this.inject(values))},statics:{getOptions:function(options){return options&&options._merged?options:new Base({type:null,tolerance:paper.project.options.hitTolerance||2,fill:!options,stroke:!options,segments:!options,handles:!1,ends:!1,center:!1,bounds:!1,guides:!1,selected:!1,_merged:!0},options)}}}),Segment=Base.extend({_class:"Segment",initialize:function Segment(arg0,arg1,arg2,arg3,arg4,arg5){var count=arguments.length,point,handleIn,handleOut;0===count||(1===count?arg0.point?(point=arg0.point,handleIn=arg0.handleIn,handleOut=arg0.handleOut):point=arg0:2===count&&"number"==typeof arg0?point=arguments:3>=count?(point=arg0,handleIn=arg1,handleOut=arg2):(point=void 0===arg0?null:[arg0,arg1],handleIn=void 0===arg2?null:[arg2,arg3],handleOut=void 0===arg4?null:[arg4,arg5])),new SegmentPoint(point,this,"_point"),new SegmentPoint(handleIn,this,"_handleIn"),new SegmentPoint(handleOut,this,"_handleOut")},_serialize:function(options){return Base.serialize(this.isLinear()?this._point:[this._point,this._handleIn,this._handleOut],options,!0)},_changed:function(point){if(this._path){var curve=this._path._curves&&this.getCurve(),other;curve&&(curve._changed(),(other=curve[point==this._point||point==this._handleIn&&curve._segment1==this?"getPrevious":"getNext"]())&&other._changed()),this._path._changed(5)}},getPoint:function(){return this._point},setPoint:function(){var point=Point.read(arguments);this._point.set(point.x,point.y)},getHandleIn:function(){return this._handleIn},setHandleIn:function(){var point=Point.read(arguments);this._handleIn.set(point.x,point.y)},getHandleOut:function(){return this._handleOut},setHandleOut:function(){var point=Point.read(arguments);this._handleOut.set(point.x,point.y)},isLinear:function(){return this._handleIn.isZero()&&this._handleOut.isZero()},setLinear:function(){this._handleIn.set(0,0),this._handleOut.set(0,0)},isColinear:function(segment){var next1=this.getNext(),next2=segment.getNext();return this._handleOut.isZero()&&next1._handleIn.isZero()&&segment._handleOut.isZero()&&next2._handleIn.isZero()&&next1._point.subtract(this._point).isColinear(next2._point.subtract(segment._point))},isOrthogonal:function(){var prev=this.getPrevious(),next=this.getNext();return prev._handleOut.isZero()&&this._handleIn.isZero()&&this._handleOut.isZero()&&next._handleIn.isZero()&&this._point.subtract(prev._point).isOrthogonal(next._point.subtract(this._point))},isArc:function(){var next=this.getNext(),handle1=this._handleOut,handle2=next._handleIn,kappa=Numerical.KAPPA;if(handle1.isOrthogonal(handle2)){var from=this._point,to=next._point,corner=new Line(from,handle1,!0).intersect(new Line(to,handle2,!0),!0);return corner&&Numerical.isZero(handle1.getLength()/corner.subtract(from).getLength()-kappa)&&Numerical.isZero(handle2.getLength()/corner.subtract(to).getLength()-kappa)}return!1},_selectionState:0,isSelected:function(_point){var state=this._selectionState;return _point?_point===this._point?!!(4&state):_point===this._handleIn?!!(1&state):_point===this._handleOut&&!!(2&state):!!(7&state)},setSelected:function(selected,_point){var path=this._path,selected=!!selected,state=this._selectionState,oldState=state,flag=_point?_point===this._point?4:_point===this._handleIn?1:_point===this._handleOut?2:0:7;selected?state|=flag:state&=~flag,this._selectionState=state,path&&state!==oldState&&(path._updateSelection(this,oldState,state),path._changed(33))},getIndex:function(){return void 0===this._index?null:this._index},getPath:function(){return this._path||null},getCurve:function(){var path=this._path,index=this._index;return path?(0<index&&!path._closed&&index===path._segments.length-1&&index--,path.getCurves()[index]||null):null},getLocation:function(){var curve=this.getCurve();return curve?new CurveLocation(curve,curve.getNext()?0:1):null},getNext:function(){var segments=this._path&&this._path._segments;return segments&&(segments[this._index+1]||this._path._closed&&segments[0])||null},getPrevious:function(){var segments=this._path&&this._path._segments;return segments&&(segments[this._index-1]||this._path._closed&&segments[segments.length-1])||null},reverse:function(){return new Segment(this._point,this._handleOut,this._handleIn)},remove:function(){return!!this._path&&!!this._path.removeSegment(this._index)},clone:function(){return new Segment(this._point,this._handleIn,this._handleOut)},equals:function(segment){return segment===this||segment&&this._class===segment._class&&this._point.equals(segment._point)&&this._handleIn.equals(segment._handleIn)&&this._handleOut.equals(segment._handleOut)||!1},toString:function(){var parts=["point: "+this._point];return this._handleIn.isZero()||parts.push("handleIn: "+this._handleIn),this._handleOut.isZero()||parts.push("handleOut: "+this._handleOut),"{ "+parts.join(", ")+" }"},_transformCoordinates:function(matrix,coords,change){var point=this._point,handleIn=change&&this._handleIn.isZero()?null:this._handleIn,handleOut=change&&this._handleOut.isZero()?null:this._handleOut,x=point._x,y=point._y,i=2;return coords[0]=x,coords[1]=y,handleIn&&(coords[i++]=handleIn._x+x,coords[i++]=handleIn._y+y),handleOut&&(coords[i++]=handleOut._x+x,coords[i++]=handleOut._y+y),matrix&&(matrix._transformCoordinates(coords,0,coords,0,i/2),x=coords[0],y=coords[1],change?(point._x=x,point._y=y,i=2,handleIn&&(handleIn._x=coords[i++]-x,handleIn._y=coords[i++]-y),handleOut&&(handleOut._x=coords[i++]-x,handleOut._y=coords[i++]-y)):(!handleIn&&(coords[i++]=x,coords[i++]=y),!handleOut&&(coords[i++]=x,coords[i++]=y))),coords}}),SegmentPoint=Point.extend({initialize:function SegmentPoint(point,owner,key){var x,y,selected;if(!point)x=y=0;else if(void 0!==(x=point[0]))y=point[1];else{var pt=point;void 0===(x=pt.x)&&(pt=Point.read(arguments),x=pt.x),y=pt.y,selected=pt.selected}this._x=x,this._y=y,this._owner=owner,owner[key]=this,selected&&this.setSelected(!0)},set:function(x,y){return this._x=x,this._y=y,this._owner._changed(this),this},_serialize:function(options){var f=options.formatter,x=f.number(this._x),y=f.number(this._y);return this.isSelected()?{x:x,y:y,selected:!0}:[x,y]},getX:function(){return this._x},setX:function(x){this._x=x,this._owner._changed(this)},getY:function(){return this._y},setY:function(y){this._y=y,this._owner._changed(this)},isZero:function(){return Numerical.isZero(this._x)&&Numerical.isZero(this._y)},setSelected:function(selected){this._owner.setSelected(selected,this)},isSelected:function(){return this._owner.isSelected(this)}}),Curve=Base.extend({_class:"Curve",initialize:function Curve(arg0,arg1,arg2,arg3,arg4,arg5,arg6,arg7){var count=arguments.length;if(3===count)this._path=arg0,this._segment1=arg1,this._segment2=arg2;else if(0===count)this._segment1=new Segment,this._segment2=new Segment;else if(1===count)this._segment1=new Segment(arg0.segment1),this._segment2=new Segment(arg0.segment2);else if(2===count)this._segment1=new Segment(arg0),this._segment2=new Segment(arg1);else{var point1,handle1,handle2,point2;4===count?(point1=arg0,handle1=arg1,handle2=arg2,point2=arg3):8===count&&(point1=[arg0,arg1],point2=[arg6,arg7],handle1=[arg2-arg0,arg3-arg1],handle2=[arg4-arg6,arg5-arg7]),this._segment1=new Segment(point1,null,handle1),this._segment2=new Segment(point2,handle2,null)}},_changed:function(){this._length=this._bounds=void 0},getPoint1:function(){return this._segment1._point},setPoint1:function(){var point=Point.read(arguments);this._segment1._point.set(point.x,point.y)},getPoint2:function(){return this._segment2._point},setPoint2:function(){var point=Point.read(arguments);this._segment2._point.set(point.x,point.y)},getHandle1:function(){return this._segment1._handleOut},setHandle1:function(){var point=Point.read(arguments);this._segment1._handleOut.set(point.x,point.y)},getHandle2:function(){return this._segment2._handleIn},setHandle2:function(){var point=Point.read(arguments);this._segment2._handleIn.set(point.x,point.y)},getSegment1:function(){return this._segment1},getSegment2:function(){return this._segment2},getPath:function(){return this._path},getIndex:function(){return this._segment1._index},getNext:function(){var curves=this._path&&this._path._curves;return curves&&(curves[this._segment1._index+1]||this._path._closed&&curves[0])||null},getPrevious:function(){var curves=this._path&&this._path._curves;return curves&&(curves[this._segment1._index-1]||this._path._closed&&curves[curves.length-1])||null},isSelected:function(){return this.getPoint1().isSelected()&&this.getHandle2().isSelected()&&this.getHandle2().isSelected()&&this.getPoint2().isSelected()},setSelected:function(selected){this.getPoint1().setSelected(selected),this.getHandle1().setSelected(selected),this.getHandle2().setSelected(selected),this.getPoint2().setSelected(selected)},getValues:function(matrix){return Curve.getValues(this._segment1,this._segment2,matrix)},getPoints:function(){for(var coords=this.getValues(),points=[],i=0;8>i;i+=2)points.push(new Point(coords[i],coords[i+1]));return points},getLength:function(){return null==this._length&&(this._length=Curve.getLength(this.getValues(),0,1)),this._length},getArea:function(){return Curve.getArea(this.getValues())},getPart:function(from,to){return new Curve(Curve.getPart(this.getValues(),from,to))},getPartLength:function(from,to){return Curve.getLength(this.getValues(),from,to)},isLinear:function(){return this._segment1._handleOut.isZero()&&this._segment2._handleIn.isZero()},getIntersections:function(curve){return Curve.getIntersections(this.getValues(),curve.getValues(),this,curve,[])},reverse:function(){return new Curve(this._segment2.reverse(),this._segment1.reverse())},_getParameter:function(offset,isParameter){return isParameter?offset:offset&&offset.curve===this?offset.parameter:void 0===offset&&void 0===isParameter?0.5:this.getParameterAt(offset,0)},divide:function(offset,isParameter){var parameter=this._getParameter(offset,isParameter),tolerance=0.00001,res=null;if(parameter>tolerance&&parameter<1-tolerance){var parts=Curve.subdivide(this.getValues(),parameter),isLinear=this.isLinear(),left=parts[0],right=parts[1];isLinear||(this._segment1._handleOut.set(left[2]-left[0],left[3]-left[1]),this._segment2._handleIn.set(right[4]-right[6],right[5]-right[7]));var x=left[6],y=left[7],segment=new Segment(new Point(x,y),!isLinear&&new Point(left[4]-x,left[5]-y),!isLinear&&new Point(right[2]-x,right[3]-y));if(this._path)0<this._segment1._index&&0===this._segment2._index?this._path.add(segment):this._path.insert(this._segment2._index,segment),res=this;else{var end=this._segment2;this._segment2=segment,res=new Curve(segment,end)}}return res},split:function(offset,isParameter){return this._path?this._path.split(this._segment1._index,this._getParameter(offset,isParameter)):null},clone:function(){return new Curve(this._segment1,this._segment2)},toString:function(){var parts=["point1: "+this._segment1._point];return this._segment1._handleOut.isZero()||parts.push("handle1: "+this._segment1._handleOut),this._segment2._handleIn.isZero()||parts.push("handle2: "+this._segment2._handleIn),parts.push("point2: "+this._segment2._point),"{ "+parts.join(", ")+" }"},statics:{getValues:function(segment1,segment2,matrix){var p1=segment1._point,h1=segment1._handleOut,h2=segment2._handleIn,p2=segment2._point,values=[p1._x,p1._y,p1._x+h1._x,p1._y+h1._y,p2._x+h2._x,p2._y+h2._y,p2._x,p2._y];return matrix&&matrix._transformCoordinates(values,0,values,0,6),values},evaluate:function(v,t,type){var p1x=v[0],p1y=v[1],c1x=v[2],c1y=v[3],c2x=v[4],c2y=v[5],p2x=v[6],p2y=v[7],x,y;if(0===type&&(0===t||1===t))x=0===t?p1x:p2x,y=0===t?p1y:p2y;else{var cx=3*(c1x-p1x),bx=3*(c2x-c1x)-cx,ax=p2x-p1x-cx-bx,cy=3*(c1y-p1y),by=3*(c2y-c1y)-cy,ay=p2y-p1y-cy-by;if(0===type)x=((ax*t+bx)*t+cx)*t+p1x,y=((ay*t+by)*t+cy)*t+p1y;else{var tolerance=0.00001;if(t<tolerance&&c1x===p1x&&c1y===p1y||t>1-tolerance&&c2x===p2x&&c2y===p2y?(x=p2x-p1x,y=p2y-p1y):(x=(3*ax*t+2*bx)*t+cx,y=(3*ay*t+2*by)*t+cy),3===type){var x2=6*ax*t+2*bx,y2=6*ay*t+2*by;return(x*y2-y*x2)/Math.pow(x*x+y*y,3/2)}}}return 2==type?new Point(y,-x):new Point(x,y)},subdivide:function(v,t){var p1x=v[0],p1y=v[1],c1x=v[2],c1y=v[3],c2x=v[4],c2y=v[5],p2x=v[6],p2y=v[7];void 0===t&&(t=0.5);var u=1-t,p3x=u*p1x+t*c1x,p3y=u*p1y+t*c1y,p4x=u*c1x+t*c2x,p4y=u*c1y+t*c2y,p5x=u*c2x+t*p2x,p5y=u*c2y+t*p2y,p6x=u*p3x+t*p4x,p6y=u*p3y+t*p4y,p7x=u*p4x+t*p5x,p7y=u*p4y+t*p5y,p8x=u*p6x+t*p7x,p8y=u*p6y+t*p7y;return[[p1x,p1y,p3x,p3y,p6x,p6y,p8x,p8y],[p8x,p8y,p7x,p7y,p5x,p5y,p2x,p2y]]},solveCubic:function(v,coord,val,roots,min,max){var p1=v[coord],c1=v[coord+2],c2=v[coord+4],p2=v[coord+6],c=3*(c1-p1),b=3*(c2-c1)-c,a=p2-p1-c-b;return Numerical.solveCubic(a,b,c,p1-val,roots,min,max)},getParameterOf:function(v,x,y){var tolerance=0.00001;if(Math.abs(v[0]-x)<tolerance&&Math.abs(v[1]-y)<tolerance)return 0;if(Math.abs(v[6]-x)<tolerance&&Math.abs(v[7]-y)<tolerance)return 1;for(var txs=[],tys=[],sx=Curve.solveCubic(v,0,x,txs),sy=Curve.solveCubic(v,1,y,tys),cx=0,tx,ty;-1==sx||cx<sx;)if(-1==sx||0<=(tx=txs[cx++])&&1>=tx){for(var cy=0;-1==sy||cy<sy;)if((-1==sy||0<=(ty=tys[cy++])&&1>=ty)&&(-1==sx?tx=ty:-1==sy&&(ty=tx),Math.abs(tx-ty)<tolerance))return 0.5*(tx+ty);if(-1==sx)break}return null},getPart:function(v,from,to){return 0<from&&(v=Curve.subdivide(v,from)[1]),1>to&&(v=Curve.subdivide(v,(to-from)/(1-from))[0]),v},isLinear:function(v){var isZero=Numerical.isZero;return isZero(v[0]-v[2])&&isZero(v[1]-v[3])&&isZero(v[4]-v[6])&&isZero(v[5]-v[7])},isFlatEnough:function(v,tolerance){var p1x=v[0],p1y=v[1],c1x=v[2],c1y=v[3],c2x=v[4],c2y=v[5],p2x=v[6],p2y=v[7],ux=3*c1x-2*p1x-p2x,uy=3*c1y-2*p1y-p2y,vx=3*c2x-2*p2x-p1x,vy=3*c2y-2*p2y-p1y;return Math.max(ux*ux,vx*vx)+Math.max(uy*uy,vy*vy)<10*tolerance*tolerance},getArea:function(v){var p1x=v[0],p1y=v[1],c1x=v[2],c1y=v[3],c2x=v[4],c2y=v[5],p2x=v[6],p2y=v[7];return(3*c1y*p1x-1.5*c1y*c2x-1.5*c1y*p2x-3*p1y*c1x-1.5*p1y*c2x-0.5*p1y*p2x+1.5*c2y*p1x+1.5*c2y*c1x-3*c2y*p2x+0.5*p2y*p1x+1.5*p2y*c1x+3*p2y*c2x)/10},getBounds:function(v){for(var min=v.slice(0,2),max=min.slice(),roots=[0,0],i=0;2>i;i++)Curve._addBounds(v[i],v[i+2],v[i+4],v[i+6],i,0,min,max,roots);return new Rectangle(min[0],min[1],max[0]-min[0],max[1]-min[1])},_addBounds:function(v0,v1,v2,v3,coord,padding,min,max,roots){function add(value,padding){var left=value-padding,right=value+padding;left<min[coord]&&(min[coord]=left),right>max[coord]&&(max[coord]=right)}var a=3*(v1-v2)-v0+v3,b=2*(v0+v2)-4*v1,c=v1-v0,count=Numerical.solveQuadratic(a,b,c,roots),tMin=0.00001,tMax=1-tMin;add(v3,0);for(var i=0;i<count;i++){var t=roots[i],u=1-t;tMin<t&&t<tMax&&add(u*u*u*v0+3*u*u*t*v1+3*u*t*t*v2+t*t*t*v3,padding)}},_getWinding:function(v,prev,x,y,roots1,roots2){function getDirection(v){var y0=v[1],y1=v[7],dir=y0>y1?-1:1;return 1==dir&&(y<y0||y>y1)||-1==dir&&(y<y1||y>y0)?0:dir}var tolerance=0.00001,abs=Math.abs;if(Curve.isLinear(v)){var dir=getDirection(v);if(!dir)return 0;var cross=(v[6]-v[0])*(y-v[1])-(v[7]-v[1])*(x-v[0]);return(cross<-tolerance?-1:1)==dir?0:dir}for(var y0=v[1],y1=v[3],y2=v[5],y3=v[7],a=3*(y1-y2)-y0+y3,b=2*(y0+y2)-4*y1,c=y1-y0,count=Numerical.solveQuadratic(a,b,c,roots1,tolerance,1-tolerance),rest=v,t1=roots1[0],winding=0,i=0,part;i<=count;i++){if(i===count)part=rest;else{var curves=Curve.subdivide(rest,t1);part=curves[0],rest=curves[1],t1=roots1[i],t1=(roots1[i+1]-t1)/(1-t1)}0<i&&(part[3]=part[1]),i<count&&(part[5]=rest[1]);var dir=getDirection(part);if(dir){var t2,px;if(1===Curve.solveCubic(part,1,y,roots2,-tolerance,1+-tolerance))t2=roots2[0],px=Curve.evaluate(part,t2,0).x;else{var mid=(part[1]+part[7])/2;if(t2=y<mid&&0<dir?0:1,1===t2&&y==part[7])continue;px=0===t2?part[0]:part[6]}var slope=Curve.evaluate(part,t2,1).y,stationary=abs(slope)<tolerance||t2<tolerance&&0>Curve.evaluate(prev,1,1).y*slope;x>=px+(stationary?-tolerance:tolerance*dir)&&!(stationary&&(abs(t2)<tolerance&&abs(x-part[0])>tolerance||abs(t2-1)<tolerance&&abs(x-part[6])>tolerance))&&(winding+=stationary&&abs(t2-(0<dir?1:0))<tolerance?-dir:dir),prev=part}}return winding}}},Base.each(["getBounds","getStrokeBounds","getHandleBounds","getRoughBounds"],function(name){this[name]=function(){this._bounds||(this._bounds={});var bounds=this._bounds[name];return bounds||(bounds=this._bounds[name]=Path[name]([this._segment1,this._segment2],!1,this._path.getStyle())),bounds.clone()}},{}),Base.each(["getPoint","getTangent","getNormal","getCurvature"],function(name,index){this[name+"At"]=function(offset,isParameter){var values=this.getValues();return Curve.evaluate(values,isParameter?offset:Curve.getParameterAt(values,offset,0),index)},this[name]=function(parameter){return Curve.evaluate(this.getValues(),parameter,index)}},{getParameterAt:function(offset,start){return Curve.getParameterAt(this.getValues(),offset,void 0===start?0>offset?1:0:start)},getParameterOf:function(point){var point=Point.read(arguments);return Curve.getParameterOf(this.getValues(),point.x,point.y)},getLocationAt:function(offset,isParameter){return isParameter||(offset=this.getParameterAt(offset)),new CurveLocation(this,offset)},getLocationOf:function(point){var point=Point.read(arguments),t=this.getParameterOf(point);return null==t?null:new CurveLocation(this,t)},getNearestLocation:function(point){function refine(t){if(0<=t&&1>=t){var dist=point.getDistance(Curve.evaluate(values,t,0),!0);if(dist<minDist)return minDist=dist,minT=t,!0}}for(var point=Point.read(arguments),values=this.getValues(),count=100,minDist=Infinity,minT=0,i=0;i<=count;i++)refine(i/count);for(var step=1/(2*count);0.00001<step;)refine(minT-step)||refine(minT+step)||(step/=2);var pt=Curve.evaluate(values,minT,0);return new CurveLocation(this,minT,pt,null,null,null,point.getDistance(pt))},getNearestPoint:function(point){var point=Point.read(arguments);return this.getNearestLocation(point).getPoint()}}),new function(){function getLengthIntegrand(v){var p1x=v[0],p1y=v[1],c1x=v[2],c1y=v[3],c2x=v[4],c2y=v[5],p2x=v[6],p2y=v[7],ax=9*(c1x-c2x)+3*(p2x-p1x),bx=6*(p1x+c2x)-12*c1x,cx=3*(c1x-p1x),ay=9*(c1y-c2y)+3*(p2y-p1y),by=6*(p1y+c2y)-12*c1y,cy=3*(c1y-p1y);return function(t){var dx=(ax*t+bx)*t+cx,dy=(ay*t+by)*t+cy;return Math.sqrt(dx*dx+dy*dy)}}function getIterations(a,b){return Math.max(2,Math.min(16,Math.ceil(32*Math.abs(b-a))))}return{statics:!0,getLength:function(v,a,b){void 0===a&&(a=0),void 0===b&&(b=1);var isZero=Numerical.isZero;if(0===a&&1===b&&isZero(v[0]-v[2])&&isZero(v[1]-v[3])&&isZero(v[6]-v[4])&&isZero(v[7]-v[5])){var dx=v[6]-v[0],dy=v[7]-v[1];return Math.sqrt(dx*dx+dy*dy)}var ds=getLengthIntegrand(v);return Numerical.integrate(ds,a,b,getIterations(a,b))},getParameterAt:function(v,offset,start){function f(t){var count=getIterations(start,t);return length+=start<t?Numerical.integrate(ds,start,t,count):-Numerical.integrate(ds,t,start,count),start=t,length-offset}if(0===offset)return start;var forward=0<offset,a=forward?start:0,b=forward?1:start,offset=Math.abs(offset),ds=getLengthIntegrand(v),rangeLength=Numerical.integrate(ds,a,b,getIterations(a,b));if(offset>=rangeLength)return forward?b:a;var guess=offset/rangeLength,length=0;return Numerical.findRoot(f,ds,forward?a+guess:b-guess,a,b,16,0.00001)}}},new function(){function addLocation(locations,curve1,t1,point1,curve2,t2,point2){var first=locations[0],last=locations[locations.length-1],epsilon=1e-11;first&&point1.isClose(first._point,epsilon)||last&&point1.isClose(last._point,epsilon)||locations.push(new CurveLocation(curve1,t1,point1,curve2,t2,point2))}function addCurveIntersections(v1,v2,curve1,curve2,locations,tMin,tMax,uMin,uMax,oldTDiff,reverse,recursion){if(!(20<recursion)){var q0x=v2[0],q0y=v2[1],q3x=v2[6],q3y=v2[7],tolerance=0.00001,getSignedDistance=Line.getSignedDistance,d1=getSignedDistance(q0x,q0y,q3x,q3y,v2[2],v2[3])||0,d2=getSignedDistance(q0x,q0y,q3x,q3y,v2[4],v2[5])||0,factor=0<d1*d2?3/4:4/9,dMin=factor*Math.min(0,d1,d2),dMax=factor*Math.max(0,d1,d2),dp0=getSignedDistance(q0x,q0y,q3x,q3y,v1[0],v1[1]),dp1=getSignedDistance(q0x,q0y,q3x,q3y,v1[2],v1[3]),dp2=getSignedDistance(q0x,q0y,q3x,q3y,v1[4],v1[5]),dp3=getSignedDistance(q0x,q0y,q3x,q3y,v1[6],v1[7]),tMinNew,tMaxNew,tDiff;if(q0x===q3x&&uMax-uMin<=Numerical.EPSILON&&3<recursion)tMinNew=(tMax+tMin)/2,tMaxNew=tMinNew,tDiff=0;else{var hull=getConvexHull(dp0,dp1,dp2,dp3),top=hull[0],bottom=hull[1],tMinClip,tMaxClip;if(tMinClip=clipConvexHull(top,bottom,dMin,dMax),top.reverse(),bottom.reverse(),tMaxClip=clipConvexHull(top,bottom,dMin,dMax),null==tMinClip||null==tMaxClip)return!1;v1=Curve.getPart(v1,tMinClip,tMaxClip),tDiff=tMaxClip-tMinClip,tMinNew=tMax*tMinClip+tMin*(1-tMinClip),tMaxNew=tMax*tMaxClip+tMin*(1-tMaxClip)}if(0.8<oldTDiff&&0.8<tDiff){if(tMaxNew-tMinNew>uMax-uMin){var parts=Curve.subdivide(v1,0.5),t=tMinNew+(tMaxNew-tMinNew)/2;addCurveIntersections(v2,parts[0],curve2,curve1,locations,uMin,uMax,tMinNew,t,tDiff,!reverse,++recursion),addCurveIntersections(v2,parts[1],curve2,curve1,locations,uMin,uMax,t,tMaxNew,tDiff,!reverse,recursion)}else{var parts=Curve.subdivide(v2,0.5),t=uMin+(uMax-uMin)/2;addCurveIntersections(parts[0],v1,curve2,curve1,locations,uMin,t,tMinNew,tMaxNew,tDiff,!reverse,++recursion),addCurveIntersections(parts[1],v1,curve2,curve1,locations,t,uMax,tMinNew,tMaxNew,tDiff,!reverse,recursion)}}else if(Math.max(uMax-uMin,tMaxNew-tMinNew)<tolerance){var t1=tMinNew+(tMaxNew-tMinNew)/2,t2=uMin+(uMax-uMin)/2;reverse?addLocation(locations,curve2,t2,Curve.evaluate(v2,t2,0),curve1,t1,Curve.evaluate(v1,t1,0)):addLocation(locations,curve1,t1,Curve.evaluate(v1,t1,0),curve2,t2,Curve.evaluate(v2,t2,0))}else addCurveIntersections(v2,v1,curve2,curve1,locations,uMin,uMax,tMinNew,tMaxNew,tDiff,!reverse,++recursion)}}function getConvexHull(dq0,dq1,dq2,dq3){var p0=[0,dq0],p1=[1/3,dq1],p2=[2/3,dq2],p3=[1,dq3],getSignedDistance=Line.getSignedDistance,dist1=getSignedDistance(0,dq0,1,dq3,1/3,dq1),dist2=getSignedDistance(0,dq0,1,dq3,2/3,dq2),flip=!1,hull;if(0>dist1*dist2)hull=[[p0,p1,p3],[p0,p2,p3]],flip=0>dist1;else{var cross=0,distZero=0===dist1||0===dist2,pmax;Math.abs(dist1)>Math.abs(dist2)?(pmax=p1,cross=(dq3-dq2-(dq3-dq0)/3)*(2*(dq3-dq2)-dq3+dq1)/3):(pmax=p2,cross=(dq1-dq0+(dq0-dq3)/3)*(-2*(dq0-dq1)+dq0-dq2)/3),hull=0>cross||distZero?[[p0,pmax,p3],[p0,p3]]:[[p0,p1,p2,p3],[p0,p3]],flip=dist1?0>dist1:0>dist2}return flip?hull.reverse():hull}function clipConvexHull(hullTop,hullBottom,dMin,dMax){for(var tVal=null,i=0,l=hullBottom.length-1,tProxy,px,py,qx,qy;i<l;i++){if(py=hullBottom[i][1],qy=hullBottom[i+1][1],py<qy)tProxy=null;else if(qy<=dMax)px=hullBottom[i][0],qx=hullBottom[i+1][0],tProxy=px+(dMax-py)*(qx-px)/(qy-py);else continue;break}hullTop[0][1]<=dMax&&(tProxy=hullTop[0][0]);for(var i=0,l=hullTop.length-1;i<l;i++){if(py=hullTop[i][1],qy=hullTop[i+1][1],py>=dMin)tVal=tProxy;else if(py>qy)tVal=null;else if(qy>=dMin)px=hullTop[i][0],qx=hullTop[i+1][0],tVal=px+(dMin-py)*(qx-px)/(qy-py);else continue;break}return tVal}function addCurveLineIntersections(v1,v2,curve1,curve2,locations){for(var flip=Curve.isLinear(v1),vc=flip?v2:v1,vl=flip?v1:v2,lx1=vl[0],ly1=vl[1],lx2=vl[6],ly2=vl[7],ldx=lx2-lx1,ldy=ly2-ly1,angle=Math.atan2(-ldy,ldx),sin=Math.sin(angle),cos=Math.cos(angle),rlx2=ldx*cos-ldy*sin,rvl=[0,0,0,0,rlx2,0,rlx2,0],rvc=[],i=0;8>i;i+=2){var x=vc[i]-lx1,y=vc[i+1]-ly1;rvc.push(x*cos-y*sin,y*cos+x*sin)}for(var roots=[],count=Curve.solveCubic(rvc,1,0,roots,0,1),i=0;i<count;i++){var tc=roots[i],x=Curve.evaluate(rvc,tc,0).x;if(0<=x&&x<=rlx2){var tl=Curve.getParameterOf(rvl,x,0),t1=flip?tl:tc,t2=flip?tc:tl;addLocation(locations,curve1,t1,Curve.evaluate(v1,t1,0),curve2,t2,Curve.evaluate(v2,t2,0))}}}function addLineIntersection(v1,v2,curve1,curve2,locations){var point=Line.intersect(v1[0],v1[1],v1[6],v1[7],v2[0],v2[1],v2[6],v2[7]);point&&addLocation(locations,curve1,null,point,curve2)}return{statics:{getIntersections:function(v1,v2,curve1,curve2,locations){var linear1=Curve.isLinear(v1),linear2=Curve.isLinear(v2);return(linear1&&linear2?addLineIntersection:linear1||linear2?addCurveLineIntersections:addCurveIntersections)(v1,v2,curve1,curve2,locations,0,1,0,1,1,!1,0),locations}}}}),CurveLocation=Base.extend({_class:"CurveLocation",initialize:function CurveLocation(curve,parameter,point,_curve2,_parameter2,_point2,_distance){this._id=CurveLocation._id=(CurveLocation._id||0)+1,this._curve=curve,this._segment1=curve._segment1,this._segment2=curve._segment2,this._parameter=parameter,this._point=point,this._curve2=_curve2,this._parameter2=_parameter2,this._point2=_point2,this._distance=_distance},getSegment:function(_preferFirst){if(!this._segment){var curve=this.getCurve(),parameter=this.getParameter();if(1===parameter)this._segment=curve._segment2;else if(0===parameter||_preferFirst)this._segment=curve._segment1;else{if(null==parameter)return null;this._segment=curve.getLength(0,parameter)<curve.getLength(parameter,1)?curve._segment1:curve._segment2}}return this._segment},setSegment:function(segment){this._segment=segment},getCurve:function(_uncached){return(!this._curve||_uncached)&&(this._curve=this._segment1.getCurve(),null==this._curve.getParameterOf(this._point)&&(this._curve=this._segment2.getPrevious().getCurve())),this._curve},setCurve:function(curve){this._curve=curve},getIntersection:function(){var intersection=this._intersection;if(!intersection&&this._curve2){var param=this._parameter2;this._intersection=intersection=new CurveLocation(this._curve2,param,this._point2||this._point,this),intersection._intersection=this}return intersection},getPath:function(){var curve=this.getCurve();return curve&&curve._path},getIndex:function(){var curve=this.getCurve();return curve&&curve.getIndex()},getOffset:function(){var path=this.getPath();return path&&path._getOffset(this)},getCurveOffset:function(){var curve=this.getCurve(),parameter=this.getParameter();return null!=parameter&&curve&&curve.getLength(0,parameter)},getParameter:function(_uncached){if((null==this._parameter||_uncached)&&this._point){var curve=this.getCurve(_uncached&&this._point);this._parameter=curve&&curve.getParameterOf(this._point)}return this._parameter},setParameter:function(parameter){this._parameter=parameter},getPoint:function(_uncached){if((!this._point||_uncached)&&null!=this._parameter){var curve=this.getCurve();this._point=curve&&curve.getPointAt(this._parameter,!0)}return this._point},setPoint:function(point){this._point=point},getTangent:function(){var parameter=this.getParameter(),curve=this.getCurve();return null!=parameter&&curve&&curve.getTangentAt(parameter,!0)},getNormal:function(){var parameter=this.getParameter(),curve=this.getCurve();return null!=parameter&&curve&&curve.getNormalAt(parameter,!0)},getDistance:function(){return this._distance},divide:function(){var curve=this.getCurve(!0);return curve&&curve.divide(this.getParameter(!0),!0)},split:function(){var curve=this.getCurve(!0);return curve&&curve.split(this.getParameter(!0),!0)},toString:function(){var parts=[],point=this.getPoint(),f=Formatter.instance;point&&parts.push("point: "+point);var index=this.getIndex();null!=index&&parts.push("index: "+index);var parameter=this.getParameter();return null!=parameter&&parts.push("parameter: "+f.number(parameter)),null!=this._distance&&parts.push("distance: "+f.number(this._distance)),"{ "+parts.join(", ")+" }"}}),PathItem=Item.extend({_class:"PathItem",initialize:function PathItem(){},getIntersections:function(path,sorted){if(!this.getBounds().touches(path.getBounds()))return[];for(var locations=[],curves1=this.getCurves(),curves2=path.getCurves(),matrix1=this._matrix.orNullIfIdentity(),matrix2=path._matrix.orNullIfIdentity(),length1=curves1.length,length2=curves2.length,values2=[],i=0;i<length2;i++)values2[i]=curves2[i].getValues(matrix2);for(var i=0;i<length1;i++)for(var curve1=curves1[i],values1=curve1.getValues(matrix1),j=0;j<length2;j++)Curve.getIntersections(values1,values2[j],curve1,curves2[j],locations);return(sorted||void 0===sorted)&&locations.sort(function(loc1,loc2){var path1=loc1.getPath(),path2=loc2.getPath();return path1===path2?loc1.getIndex()+loc1.getParameter()-(loc2.getIndex()+loc2.getParameter()):path1._index-path2._index}),locations},setPathData:function(data){function getCoord(index,coord,isCurrent){var val=parseFloat(coords[index]);return relative&&(val+=current[coord]),isCurrent&&(current[coord]=val),val}function getPoint(index,isCurrent){return new Point(getCoord(index,"x",isCurrent),getCoord(index+1,"y",isCurrent))}var parts=data.match(/[mlhvcsqtaz][^mlhvcsqtaz]*/ig),relative=!1,current=new Point,coords,control;this.clear();for(var i=0,l=parts.length;i<l;i++){var part=parts[i],cmd=part[0],lower=cmd.toLowerCase();coords=part.match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g);var length=coords&&coords.length;switch(relative=cmd===lower,lower){case"m":case"l":for(var j=0;j<length;j+=2)this[0===j&&"m"===lower?"moveTo":"lineTo"](getPoint(j,!0));control=current;break;case"h":case"v":for(var coord="h"==lower?"x":"y",j=0;j<length;j++)getCoord(j,coord,!0),this.lineTo(current);control=current;break;case"c":for(var j=0;j<length;j+=6)this.cubicCurveTo(getPoint(j),control=getPoint(j+2),getPoint(j+4,!0));break;case"s":for(var j=0;j<length;j+=4)this.cubicCurveTo(current.multiply(2).subtract(control),control=getPoint(j),getPoint(j+2,!0));break;case"q":for(var j=0;j<length;j+=4)this.quadraticCurveTo(control=getPoint(j),getPoint(j+2,!0));break;case"t":for(var j=0;j<length;j+=2)this.quadraticCurveTo(control=current.multiply(2).subtract(control),getPoint(j,!0));break;case"a":break;case"z":this.closePath();}}},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_contains:function(point){var winding=this._getWinding(point);return"evenodd"===this.getWindingRule()?!!(1&winding):!!winding}}),Path=PathItem.extend({_class:"Path",_serializeFields:{segments:[],closed:!1},initialize:function Path(arg){this._closed=!1,this._segments=[];var segments=Array.isArray(arg)?"object"==typeof arg[0]?arg:arguments:arg&&void 0===arg.size&&(void 0!==arg.x||void 0!==arg.point)?arguments:null;this.setSegments(segments||[]),segments||"string"!=typeof arg||(this.setPathData(arg),arg=null),this._initialize(!segments&&arg)},_equals:function(item){return Base.equals(this._segments,item._segments)},clone:function(insert){var copy=this._clone(new Path({segments:this._segments,insert:!1}),insert);return copy._closed=this._closed,void 0!==this._clockwise&&(copy._clockwise=this._clockwise),copy},_changed:function _changed(flags){if(_changed.base.call(this,flags),!(4&flags))8&flags&&(this._bounds=void 0);else if((this._compound?this._parent:this)._currentPath=void 0,this._length=this._clockwise=void 0,this._curves)for(var i=0,l=this._curves.length;i<l;i++)this._curves[i]._changed(5)},getStyle:function(){var parent=this._parent;return(parent instanceof CompoundPath?parent:this)._style},getSegments:function(){return this._segments},setSegments:function(segments){var fullySelected=this.isFullySelected();this._segments.length=0,this._selectedSegmentState=0,this._curves=void 0,this._add(Segment.readAll(segments)),fullySelected&&this.setFullySelected(!0)},getFirstSegment:function(){return this._segments[0]},getLastSegment:function(){return this._segments[this._segments.length-1]},getCurves:function(){var curves=this._curves,segments=this._segments;if(!curves){var length=this._countCurves();curves=this._curves=Array(length);for(var i=0;i<length;i++)curves[i]=new Curve(this,segments[i],segments[i+1]||segments[0])}return curves},getFirstCurve:function(){return this.getCurves()[0]},getLastCurve:function(){var curves=this.getCurves();return curves[curves.length-1]},getPathData:function(precision){function addCurve(seg1,seg2,skipLine){var point1=seg1._point,point2=seg2._point,handle1=seg1._handleOut,handle2=seg2._handleIn;if(handle1.isZero()&&handle2.isZero())skipLine||parts.push("L"+f.point(point2,precision));else{var end=point2.subtract(point1);parts.push("c"+f.point(handle1,precision)+" "+f.point(end.add(handle2),precision)+" "+f.point(end,precision))}}var segments=this._segments,f=Formatter.instance,parts=[];if(0===segments.length)return"";parts.push("M"+f.point(segments[0]._point));for(var i=0,l=segments.length-1;i<l;i++)addCurve(segments[i],segments[i+1],!1);return this._closed&&(addCurve(segments[segments.length-1],segments[0],!0),parts.push("z")),parts.join("")},isClosed:function(){return this._closed},setClosed:function(closed){if(this._closed!=(closed=!!closed)){if(this._closed=closed,this._curves){var length=this._curves.length=this._countCurves();closed&&(this._curves[length-1]=new Curve(this,this._segments[length-1],this._segments[0]))}this._changed(5)}},isEmpty:function(){return 0===this._segments.length},isPolygon:function(){for(var i=0,l=this._segments.length;i<l;i++)if(!this._segments[i].isLinear())return!1;return!0},_applyMatrix:function(matrix){for(var coords=[,,,,,,],i=0,l=this._segments.length;i<l;i++)this._segments[i]._transformCoordinates(matrix,coords,!0);return!0},_add:function(segs,index){for(var segments=this._segments,curves=this._curves,amount=segs.length,append=null==index,index=append?segments.length:index,i=0,segment;i<amount;i++)segment=segs[i],segment._path&&(segment=segs[i]=segment.clone()),segment._path=this,segment._index=index+i,segment._selectionState&&this._updateSelection(segment,0,segment._selectionState);if(append)segments.push.apply(segments,segs);else{segments.splice.apply(segments,[index,0].concat(segs));for(var i=index+amount,l=segments.length;i<l;i++)segments[i]._index=i}if(curves||segs._curves){curves||(curves=this._curves=[]);var from=0<index?index-1:index,start=from,to=Math.min(from+amount,this._countCurves());segs._curves&&(curves.splice.apply(curves,[from,0].concat(segs._curves)),start+=segs._curves.length);for(var i=start;i<to;i++)curves.splice(i,0,new Curve(this,null,null));this._adjustCurves(from,to)}return this._changed(5),segs},_adjustCurves:function(from,to){for(var segments=this._segments,curves=this._curves,i=from,curve;i<to;i++)curve=curves[i],curve._path=this,curve._segment1=segments[i],curve._segment2=segments[i+1]||segments[0];(curve=curves[this._closed&&0===from?segments.length-1:from-1])&&(curve._segment2=segments[from]||segments[0]),(curve=curves[to])&&(curve._segment1=segments[to])},_countCurves:function(){var length=this._segments.length;return!this._closed&&0<length?length-1:length},add:function(segment1){return 1<arguments.length&&"number"!=typeof segment1?this._add(Segment.readAll(arguments)):this._add([Segment.read(arguments)])[0]},insert:function(index,segment1){return 2<arguments.length&&"number"!=typeof segment1?this._add(Segment.readAll(arguments,1),index):this._add([Segment.read(arguments,1)],index)[0]},addSegment:function(){return this._add([Segment.read(arguments)])[0]},insertSegment:function(index){return this._add([Segment.read(arguments,1)],index)[0]},addSegments:function(segments){return this._add(Segment.readAll(segments))},insertSegments:function(index,segments){return this._add(Segment.readAll(segments),index)},removeSegment:function(index){return this.removeSegments(index,index+1)[0]||null},removeSegments:function(from,to,_includeCurves){from=from||0,to=Base.pick(to,this._segments.length);var segments=this._segments,curves=this._curves,count=segments.length,removed=segments.splice(from,to-from),amount=removed.length;if(!amount)return removed;for(var i=0,segment;i<amount;i++)segment=removed[i],segment._selectionState&&this._updateSelection(segment,segment._selectionState,0),segment._index=segment._path=null;for(var i=from,l=segments.length;i<l;i++)segments[i]._index=i;if(curves){var index=0<from&&to===count+(this._closed?1:0)?from-1:from,curves=curves.splice(index,amount);_includeCurves&&(removed._curves=curves.slice(1)),this._adjustCurves(index,index)}return this._changed(5),removed},clear:"#removeSegments",isFullySelected:function(){var length=this._segments.length;return this._selected&&0<length&&this._selectedSegmentState===7*length},setFullySelected:function(selected){selected&&this._selectSegments(!0),this.setSelected(selected)},setSelected:function setSelected(selected){selected||this._selectSegments(!1),setSelected.base.call(this,selected)},_selectSegments:function(selected){var length=this._segments.length;this._selectedSegmentState=selected?7*length:0;for(var i=0;i<length;i++)this._segments[i]._selectionState=selected?7:0},_updateSelection:function(segment,oldState,newState){segment._selectionState=newState;var total=this._selectedSegmentState+=newState-oldState;0<total&&this.setSelected(!0)},flatten:function(maxDistance){for(var flattener=new PathFlattener(this),pos=0,step=flattener.length/Math.ceil(flattener.length/maxDistance),end=flattener.length+(this._closed?-step:step)/2,segments=[];pos<=end;)segments.push(new Segment(flattener.evaluate(pos,0))),pos+=step;this.setSegments(segments)},simplify:function(tolerance){if(2<this._segments.length){var fitter=new PathFitter(this,tolerance||2.5);this.setSegments(fitter.fit())}},split:function(index,parameter){if(null!==parameter){if(1===arguments.length){var arg=index;"number"==typeof arg&&(arg=this.getLocationAt(arg)),index=arg.index,parameter=arg.parameter}1<=parameter&&(index++,parameter--);var curves=this.getCurves();if(0<=index&&index<curves.length){0<parameter&&curves[index++].divide(parameter,!0);var segs=this.removeSegments(index,this._segments.length,!0),path;return this._closed?(this.setClosed(!1),path=this):0<index&&(path=this._clone(new Path().insertAbove(this,!0))),path._add(segs,0),this.addSegment(segs[0]),path}return null}},isClockwise:function(){return void 0===this._clockwise?Path.isClockwise(this._segments):this._clockwise},setClockwise:function(clockwise){this.isClockwise()!=(clockwise=!!clockwise)&&this.reverse(),this._clockwise=clockwise},reverse:function(){this._segments.reverse();for(var i=0,l=this._segments.length;i<l;i++){var segment=this._segments[i],handleIn=segment._handleIn;segment._handleIn=segment._handleOut,segment._handleOut=handleIn,segment._index=i}this._curves=null,void 0!==this._clockwise&&(this._clockwise=!this._clockwise)},join:function(path){if(path){var segments=path._segments,last1=this.getLastSegment(),last2=path.getLastSegment();last1._point.equals(last2._point)&&path.reverse();var first2=path.getFirstSegment(),first1;return last1._point.equals(first2._point)?(last1.setHandleOut(first2._handleOut),this._add(segments.slice(1))):(first1=this.getFirstSegment(),first1._point.equals(first2._point)&&path.reverse(),last2=path.getLastSegment(),first1._point.equals(last2._point)?(first1.setHandleIn(last2._handleIn),this._add(segments.slice(0,segments.length-1),0)):this._add(segments.slice())),path.closed&&this._add([segments[0]]),path.remove(),first1=this.getFirstSegment(),last1=this.getLastSegment(),last1._point.equals(first1._point)&&(first1.setHandleIn(last1._handleIn),last1.remove(),this.setClosed(!0)),this._changed(5),!0}return!1},getLength:function(){if(null==this._length){var curves=this.getCurves();this._length=0;for(var i=0,l=curves.length;i<l;i++)this._length+=curves[i].getLength()}return this._length},getArea:function(){for(var curves=this.getCurves(),area=0,i=0,l=curves.length;i<l;i++)area+=curves[i].getArea();return area},_getOffset:function(location){var index=location&&location.getIndex();if(null!=index){for(var curves=this.getCurves(),offset=0,i=0;i<index;i++)offset+=curves[i].getLength();var curve=curves[index];return offset+curve.getLength(0,location.getParameter())}return null},getLocationOf:function(point){for(var point=Point.read(arguments),curves=this.getCurves(),i=0,l=curves.length,loc;i<l;i++)if(loc=curves[i].getLocationOf(point),loc)return loc;return null},getLocationAt:function(offset,isParameter){var curves=this.getCurves(),length=0;if(isParameter){var index=~~offset;return curves[index].getLocationAt(offset-index,!0)}for(var i=0,l=curves.length;i<l;i++){var start=length,curve=curves[i];if(length+=curve.getLength(),length>=offset)return curve.getLocationAt(offset-start)}return offset<=this.getLength()?new CurveLocation(curves[curves.length-1],1):null},getPointAt:function(offset,isParameter){var loc=this.getLocationAt(offset,isParameter);return loc&&loc.getPoint()},getTangentAt:function(offset,isParameter){var loc=this.getLocationAt(offset,isParameter);return loc&&loc.getTangent()},getNormalAt:function(offset,isParameter){var loc=this.getLocationAt(offset,isParameter);return loc&&loc.getNormal()},getNearestLocation:function(point){for(var point=Point.read(arguments),curves=this.getCurves(),minDist=Infinity,minLoc=null,i=0,l=curves.length,loc;i<l;i++)loc=curves[i].getNearestLocation(point),loc._distance<minDist&&(minDist=loc._distance,minLoc=loc);return minLoc},getNearestPoint:function(point){var point=Point.read(arguments);return this.getNearestLocation(point).getPoint()},toShape:function(insert){function isColinear(i,j){return segments[i].isColinear(segments[j])}function isOrthogonal(i){return segments[i].isOrthogonal()}function isArc(i){return segments[i].isArc()}function getDistance(i,j){return segments[i]._point.getDistance(segments[j]._point)}if(!this._closed)return null;var segments=this._segments,type,size,radius,topCenter;if(this.isPolygon()&&4===segments.length&&isColinear(0,2)&&isColinear(1,3)&&isOrthogonal(1)?(type=Shape.Rectangle,size=new Size(getDistance(0,3),getDistance(0,1)),topCenter=segments[1]._point.add(segments[2]._point).divide(2)):8===segments.length&&isArc(0)&&isArc(2)&&isArc(4)&&isArc(6)&&isColinear(1,5)&&isColinear(3,7)?(type=Shape.Rectangle,size=new Size(getDistance(1,6),getDistance(0,3)),radius=size.subtract(new Size(getDistance(0,7),getDistance(1,2))).divide(2),topCenter=segments[3]._point.add(segments[4]._point).divide(2)):4===segments.length&&isArc(0)&&isArc(1)&&isArc(2)&&isArc(3)&&(Numerical.isZero(getDistance(0,2)-getDistance(1,3))?(type=Shape.Circle,radius=getDistance(0,2)/2):(type=Shape.Ellipse,radius=new Size(getDistance(2,0)/2,getDistance(3,1)/2)),topCenter=segments[1]._point),type){var center=this.getPosition(!0),shape=new type({center:center,size:size,radius:radius,insert:!1});return shape.rotate(topCenter.subtract(center).getAngle()+90),shape.setStyle(this._style),(insert||void 0===insert)&&shape.insertAbove(this),shape}return null},_getWinding:function(point){var closed=this._closed;if(!closed&&!this.hasFill()||!this.getInternalRoughBounds()._containsPoint(point))return 0;for(var curves=this.getCurves(),segments=this._segments,winding=0,roots1=[],roots2=[],last=(closed?curves[curves.length-1]:new Curve(segments[segments.length-1]._point,segments[0]._point)).getValues(),previous=last,i=0,l=curves.length;i<l;i++){var curve=curves[i].getValues(),x=curve[0],y=curve[1];x===curve[2]&&y===curve[3]&&x===curve[4]&&y===curve[5]&&x===curve[6]&&y===curve[7]||(winding+=Curve._getWinding(curve,previous,point.x,point.y,roots1,roots2),previous=curve)}return closed||(winding+=Curve._getWinding(last,previous,point.x,point.y,roots1,roots2)),winding},_hitTest:function(point,options){function isCloseEnough(pt,padding){return 1>=point.subtract(pt).divide(padding).length}function checkSegmentPoint(seg,pt,name){if(!options.selected||pt.isSelected()){var anchor=seg._point;if(pt!==anchor&&(pt=pt.add(anchor)),isCloseEnough(pt,strokePadding))return new HitResult(name,that,{segment:seg,point:pt})}}function checkSegmentPoints(seg,ends){return(ends||options.segments)&&checkSegmentPoint(seg,seg._point,"segment")||!ends&&options.handles&&(checkSegmentPoint(seg,seg._handleIn,"handle-in")||checkSegmentPoint(seg,seg._handleOut,"handle-out"))}function addAreaPoint(point){area.add(point)}function checkSegmentStroke(segment){if(("round"!==join||"round"!==cap)&&(area=new Path({internal:!0,closed:!0}),closed||0<segment._index&&segment._index<numSegments-1?"round"!==join&&(segment._handleIn.isZero()||segment._handleOut.isZero())&&Path._addSquareJoin(segment,join,radius,miterLimit,addAreaPoint,!0):"round"!==cap&&Path._addSquareCap(segment,cap,radius,addAreaPoint,!0),!area.isEmpty())){var loc;return area.contains(point)||(loc=area.getNearestLocation(point))&&isCloseEnough(loc.getPoint(),tolerancePadding)}return isCloseEnough(segment._point,strokePadding)}var that=this,style=this.getStyle(),segments=this._segments,numSegments=segments.length,closed=this._closed,tolerancePadding=options._tolerancePadding,strokePadding=tolerancePadding,hasStroke=options.stroke&&style.hasStroke(),hasFill=options.fill&&style.hasFill(),radius=hasStroke?style.getStrokeWidth()/2:hasFill?0:null,join,cap,miterLimit,area,loc,res;if(null!=radius&&(0<radius?(join=style.getStrokeJoin(),cap=style.getStrokeCap(),miterLimit=radius*style.getMiterLimit(),strokePadding=tolerancePadding.add(new Point(radius,radius))):join=cap="round"),options.ends&&!options.segments&&!closed){if(res=checkSegmentPoints(segments[0],!0)||checkSegmentPoints(segments[numSegments-1],!0))return res;}else if(options.segments||options.handles)for(var i=0;i<numSegments;i++)if(res=checkSegmentPoints(segments[i]))return res;if(null!=radius){if(loc=this.getNearestLocation(point),loc){var parameter=loc.getParameter();0===parameter||1===parameter&&1<numSegments?!checkSegmentStroke(loc.getSegment())&&(loc=null):!isCloseEnough(loc.getPoint(),strokePadding)&&(loc=null)}if(!loc&&"miter"===join&&1<numSegments)for(var i=0,segment;i<numSegments;i++)if(segment=segments[i],point.getDistance(segment._point)<=miterLimit&&checkSegmentStroke(segment)){loc=segment.getLocation();break}}return!loc&&hasFill&&this._contains(point)||loc&&!hasStroke?new HitResult("fill",this):loc?new HitResult("stroke",this,{segment:loc.getSegment(),location:loc,point:loc.getPoint()}):null}},new function(){function drawHandles(ctx,segments,matrix,size){function drawHandle(index){var hX=coords[index],hY=coords[index+1];(pX!=hX||pY!=hY)&&(ctx.beginPath(),ctx.moveTo(pX,pY),ctx.lineTo(hX,hY),ctx.stroke(),ctx.beginPath(),ctx.arc(hX,hY,half,0,2*Math.PI,!0),ctx.fill())}for(var half=size/2,coords=[,,,,,,],i=0,l=segments.length,segment;i<l;i++){segment=segments[i],segment._transformCoordinates(matrix,coords,!1);var state=segment._selectionState,pX=coords[0],pY=coords[1];1&state&&drawHandle(2),2&state&&drawHandle(4),ctx.save(),ctx.beginPath(),ctx.rect(pX-half,pY-half,size,size),ctx.fill(),4&state||(ctx.beginPath(),ctx.rect(pX-half+1,pY-half+1,size-2,size-2),ctx.fillStyle="#ffffff",ctx.fill()),ctx.restore()}}function drawSegments(ctx,path,matrix){function drawSegment(i){var segment=segments[i];if(matrix)segment._transformCoordinates(matrix,coords,!1),curX=coords[0],curY=coords[1];else{var point=segment._point;curX=point._x,curY=point._y}if(first)ctx.moveTo(curX,curY),first=!1;else{if(matrix)inX=coords[2],inY=coords[3];else{var handle=segment._handleIn;inX=curX+handle._x,inY=curY+handle._y}inX==curX&&inY==curY&&outX==prevX&&outY==prevY?ctx.lineTo(curX,curY):ctx.bezierCurveTo(outX,outY,inX,inY,curX,curY)}if(prevX=curX,prevY=curY,matrix)outX=coords[4],outY=coords[5];else{var handle=segment._handleOut;outX=prevX+handle._x,outY=prevY+handle._y}}for(var segments=path._segments,length=segments.length,coords=[,,,,,,],first=!0,i=0,curX,curY,prevX,prevY,inX,inY,outX,outY;i<length;i++)drawSegment(i);path._closed&&0<length&&drawSegment(0)}return{_draw:function(ctx,param){function getOffset(i){return dashArray[(i%dashLength+dashLength)%dashLength]}var clip=param.clip,compound=this._compound=param.compound;compound||ctx.beginPath();var style=this.getStyle(),hasFill=style.hasFill(),hasStroke=style.hasStroke(),dashArray=style.getDashArray(),dashLength=!paper.support.nativeDash&&hasStroke&&dashArray&&dashArray.length;if(this._currentPath?ctx.currentPath=this._currentPath:(hasFill||hasStroke&&!dashLength||compound||clip)&&(drawSegments(ctx,this),this._closed&&ctx.closePath(),!compound&&(this._currentPath=ctx.currentPath)),!clip&&!compound&&(hasFill||hasStroke)&&(this._setStyles(ctx),hasFill&&(ctx.fill(style.getWindingRule()),ctx.shadowColor="rgba(0,0,0,0)"),hasStroke)){if(dashLength){ctx.beginPath();var flattener=new PathFlattener(this),length=flattener.length,from=-style.getDashOffset(),i=0,to;for(from%=length;0<from;)from-=getOffset(i--)+getOffset(i--);for(;from<length;)to=from+getOffset(i++),(0<from||0<to)&&flattener.drawPart(ctx,Math.max(from,0),Math.max(to,0)),from=to+getOffset(i++)}ctx.stroke()}},_drawSelected:function(ctx,matrix){ctx.beginPath(),drawSegments(ctx,this,matrix),ctx.stroke(),drawHandles(ctx,this._segments,matrix,this._project.options.handleSize||4)}}},new function(){function getFirstControlPoints(rhs){var n=rhs.length,x=[],tmp=[],b=2;x[0]=rhs[0]/b;for(var i=1;i<n;i++)tmp[i]=1/b,b=(i<n-1?4:2)-tmp[i],x[i]=(rhs[i]-x[i-1])/b;for(var i=1;i<n;i++)x[n-i-1]-=tmp[n-i]*x[n-i];return x}return{smooth:function(){var segments=this._segments,size=segments.length,closed=this._closed,n=size,overlap=0;if(!(2>=size)){closed&&(overlap=Math.min(size,4),n+=2*Math.min(size,overlap));for(var knots=[],i=0;i<size;i++)knots[i+overlap]=segments[i]._point;if(closed)for(var i=0;i<overlap;i++)knots[i]=segments[i+size-overlap]._point,knots[i+size+overlap]=segments[i]._point;else n--;for(var rhs=[],i=1;i<n-1;i++)rhs[i]=4*knots[i]._x+2*knots[i+1]._x;rhs[0]=knots[0]._x+2*knots[1]._x,rhs[n-1]=3*knots[n-1]._x;for(var x=getFirstControlPoints(rhs),i=1;i<n-1;i++)rhs[i]=4*knots[i]._y+2*knots[i+1]._y;rhs[0]=knots[0]._y+2*knots[1]._y,rhs[n-1]=3*knots[n-1]._y;var y=getFirstControlPoints(rhs);if(closed){for(var i=0,j=size;i<overlap;i++,j++){var f1=i/overlap,f2=1-f1,ie=i+overlap,je=j+overlap;x[j]=x[i]*f1+x[j]*f2,y[j]=y[i]*f1+y[j]*f2,x[je]=x[ie]*f2+x[je]*f1,y[je]=y[ie]*f2+y[je]*f1}n--}for(var handleIn=null,i=overlap,segment;i<=n-overlap;i++)segment=segments[i-overlap],handleIn&&segment.setHandleIn(handleIn.subtract(segment._point)),i<n&&(segment.setHandleOut(new Point(x[i],y[i]).subtract(segment._point)),handleIn=i<n-1?new Point(2*knots[i+1]._x-x[i+1],2*knots[i+1]._y-y[i+1]):new Point((knots[n]._x+x[n-1])/2,(knots[n]._y+y[n-1])/2));if(closed&&handleIn){var segment=this._segments[0];segment.setHandleIn(handleIn.subtract(segment._point))}}}}},new function(){function getCurrentSegment(that){var segments=that._segments;if(0==segments.length)throw new Error("Use a moveTo() command first");return segments[segments.length-1]}return{moveTo:function(){1===this._segments.length&&this.removeSegment(0),this._segments.length||this._add([new Segment(Point.read(arguments))])},moveBy:function(){throw new Error("moveBy() is unsupported on Path items.")},lineTo:function(){this._add([new Segment(Point.read(arguments))])},cubicCurveTo:function(){var handle1=Point.read(arguments),handle2=Point.read(arguments),to=Point.read(arguments),current=getCurrentSegment(this);current.setHandleOut(handle1.subtract(current._point)),this._add([new Segment(to,handle2.subtract(to))])},quadraticCurveTo:function(){var handle=Point.read(arguments),to=Point.read(arguments),current=getCurrentSegment(this)._point;this.cubicCurveTo(handle.add(current.subtract(handle).multiply(1/3)),handle.add(to.subtract(handle).multiply(1/3)),to)},curveTo:function(){var through=Point.read(arguments),to=Point.read(arguments),t=Base.pick(Base.read(arguments),0.5),t1=1-t,current=getCurrentSegment(this)._point,handle=through.subtract(current.multiply(t1*t1)).subtract(to.multiply(t*t)).divide(2*t*t1);if(handle.isNaN())throw new Error("Cannot put a curve through points with parameter = "+t);this.quadraticCurveTo(handle,to)},arcTo:function(){var current=getCurrentSegment(this),from=current._point,to=Point.read(arguments),clockwise=Base.pick(Base.peek(arguments),!0),through;if("boolean"==typeof clockwise)var middle=from.add(to).divide(2),through=middle.add(middle.subtract(from).rotate(clockwise?-90:90));else through=to,to=Point.read(arguments);var l1=new Line(from.add(through).divide(2),through.subtract(from).rotate(90),!0),l2=new Line(through.add(to).divide(2),to.subtract(through).rotate(90),!0),center=l1.intersect(l2,!0),line=new Line(from,to),throughSide=line.getSide(through);if(!center){if(!throughSide)return this.lineTo(to);throw new Error("Cannot put an arc through the given points: "+[from,through,to])}var vector=from.subtract(center),extent=vector.getDirectedAngle(to.subtract(center)),centerSide=line.getSide(center);0==centerSide?extent=throughSide*Math.abs(extent):throughSide==centerSide&&(extent-=360*(0>extent?-1:1));for(var ext=Math.abs(extent),count=360<=ext?4:Math.ceil(ext/90),inc=extent/count,half=inc*Math.PI/360,z=4/3*Math.sin(half)/(1+Math.cos(half)),segments=[],i=0;i<=count;i++){var pt=i<count?center.add(vector):to,out=i<count?vector.rotate(90).multiply(z):null;0==i?current.setHandleOut(out):segments.push(new Segment(pt,vector.rotate(-90).multiply(z),out)),vector=vector.rotate(inc)}this._add(segments)},lineBy:function(){var to=Point.read(arguments),current=getCurrentSegment(this)._point;this.lineTo(current.add(to))},curveBy:function(){var through=Point.read(arguments),to=Point.read(arguments),parameter=Base.read(arguments),current=getCurrentSegment(this)._point;this.curveTo(current.add(through),current.add(to),parameter)},cubicCurveBy:function(){var handle1=Point.read(arguments),handle2=Point.read(arguments),to=Point.read(arguments),current=getCurrentSegment(this)._point;this.cubicCurveTo(current.add(handle1),current.add(handle2),current.add(to))},quadraticCurveBy:function(){var handle=Point.read(arguments),to=Point.read(arguments),current=getCurrentSegment(this)._point;this.quadraticCurveTo(current.add(handle),current.add(to))},arcBy:function(){var current=getCurrentSegment(this)._point,point=current.add(Point.read(arguments)),clockwise=Base.pick(Base.peek(arguments),!0);"boolean"==typeof clockwise?this.arcTo(point,clockwise):this.arcTo(point,current.add(Point.read(arguments)))},closePath:function(){var first=this.getFirstSegment(),last=this.getLastSegment();first._point.equals(last._point)&&(first.setHandleIn(last._handleIn),last.remove()),this.setClosed(!0)}}},{_getBounds:function(getter,matrix){return Path[getter](this._segments,this._closed,this.getStyle(),matrix)},statics:{isClockwise:function(segments){for(var sum=0,i=0,l=segments.length,v;i<l;i++){v=Curve.getValues(segments[i],segments[i+1<l?i+1:0]);for(var j=2;8>j;j+=2)sum+=(v[j-2]-v[j])*(v[j+1]+v[j-1])}return 0<sum},getBounds:function(segments,closed,style,matrix,strokePadding){function processSegment(segment){segment._transformCoordinates(matrix,coords,!1);for(var i=0;2>i;i++)Curve._addBounds(prevCoords[i],prevCoords[i+4],coords[i+2],coords[i],i,strokePadding?strokePadding[i]:0,min,max,roots);var tmp=prevCoords;prevCoords=coords,coords=tmp}var first=segments[0];if(!first)return new Rectangle;for(var coords=[,,,,,,],prevCoords=first._transformCoordinates(matrix,[,,,,,,],!1),min=prevCoords.slice(0,2),max=min.slice(),roots=[,,],i=1,l=segments.length;i<l;i++)processSegment(segments[i]);return closed&&processSegment(first),new Rectangle(min[0],min[1],max[0]-min[0],max[1]-min[1])},getStrokeBounds:function(segments,closed,style,matrix){function add(point){bounds=bounds.include(matrix?matrix._transformPoint(point,point):point)}function addJoin(segment,join){"round"!==join&&(segment._handleIn.isZero()||segment._handleOut.isZero())?Path._addSquareJoin(segment,join,radius,miterLimit,add):bounds=bounds.unite(joinBounds.setCenter(matrix?matrix._transformPoint(segment._point):segment._point))}function addCap(segment,cap){"round"===cap?addJoin(segment,cap):Path._addSquareCap(segment,cap,radius,add)}if(!style.hasStroke())return Path.getBounds(segments,closed,style,matrix);for(var length=segments.length-(closed?0:1),radius=style.getStrokeWidth()/2,padding=Path._getPenPadding(radius,matrix),bounds=Path.getBounds(segments,closed,style,matrix,padding),join=style.getStrokeJoin(),cap=style.getStrokeCap(),miterLimit=radius*style.getMiterLimit(),joinBounds=new Rectangle(new Size(padding).multiply(2)),i=1;i<length;i++)addJoin(segments[i],join);return closed?addJoin(segments[0],join):0<length&&(addCap(segments[0],cap),addCap(segments[segments.length-1],cap)),bounds},_getPenPadding:function(radius,matrix){if(!matrix)return[radius,radius];var mx=matrix.shiftless(),hor=mx.transform(new Point(radius,0)),ver=mx.transform(new Point(0,radius)),phi=hor.getAngleInRadians(),a=hor.getLength(),b=ver.getLength(),sin=Math.sin(phi),cos=Math.cos(phi),tan=Math.tan(phi),tx=-Math.atan(b*tan/a),ty=Math.atan(b/(tan*a));return[Math.abs(a*Math.cos(tx)*cos-b*Math.sin(tx)*sin),Math.abs(b*Math.sin(ty)*cos+a*Math.cos(ty)*sin)]},_addSquareJoin:function(segment,join,radius,miterLimit,addPoint,area){var curve2=segment.getCurve(),curve1=curve2.getPrevious(),point=curve2.getPointAt(0,!0),normal1=curve1.getNormalAt(1,!0),normal2=curve2.getNormalAt(0,!0),step=0>normal1.getDirectedAngle(normal2)?-radius:radius;if(normal1.setLength(step),normal2.setLength(step),area&&(addPoint(point),addPoint(point.add(normal1))),"miter"===join){var corner=new Line(point.add(normal1),new Point(-normal1.y,normal1.x),!0).intersect(new Line(point.add(normal2),new Point(-normal2.y,normal2.x),!0),!0);if(corner&&point.getDistance(corner)<=miterLimit&&(addPoint(corner),!area))return}area||addPoint(point.add(normal1)),addPoint(point.add(normal2))},_addSquareCap:function(segment,cap,radius,addPoint,area){var point=segment._point,loc=segment.getLocation(),normal=loc.getNormal().normalize(radius);area&&(addPoint(point.subtract(normal)),addPoint(point.add(normal))),"square"===cap&&(point=point.add(normal.rotate(0==loc.getParameter()?-90:90))),addPoint(point.add(normal)),addPoint(point.subtract(normal))},getHandleBounds:function(segments,closed,style,matrix,strokePadding,joinPadding){for(var coords=[,,,,,,],x1=Infinity,x2=-x1,y1=x1,y2=x2,i=0,l=segments.length,segment;i<l;i++){segment=segments[i],segment._transformCoordinates(matrix,coords,!1);for(var j=0;6>j;j+=2){var padding=0==j?joinPadding:strokePadding,paddingX=padding?padding[0]:0,paddingY=padding?padding[1]:0,x=coords[j],y=coords[j+1],xn=x-paddingX,xx=x+paddingX,yn=y-paddingY,yx=y+paddingY;xn<x1&&(x1=xn),xx>x2&&(x2=xx),yn<y1&&(y1=yn),yx>y2&&(y2=yx)}}return new Rectangle(x1,y1,x2-x1,y2-y1)},getRoughBounds:function(segments,closed,style,matrix){var strokeRadius=style.hasStroke()?style.getStrokeWidth()/2:0,joinRadius=strokeRadius;return 0<strokeRadius&&("miter"===style.getStrokeJoin()&&(joinRadius=strokeRadius*style.getMiterLimit()),"square"===style.getStrokeCap()&&(joinRadius=Math.max(joinRadius,strokeRadius*Math.sqrt(2)))),Path.getHandleBounds(segments,closed,style,matrix,Path._getPenPadding(strokeRadius,matrix),Path._getPenPadding(joinRadius,matrix))}}});Path.inject({statics:new function(){function createEllipse(center,radius,args){for(var path=new Path,segments=[,,,,],i=0,segment;4>i;i++)segment=ellipseSegments[i],segments[i]=new Segment(segment._point.multiply(radius).add(center),segment._handleIn.multiply(radius),segment._handleOut.multiply(radius));return path._add(segments),path._closed=!0,path.set(Base.getNamed(args))}var kappa=Numerical.KAPPA,ellipseSegments=[new Segment([-1,0],[0,kappa],[0,-kappa]),new Segment([0,-1],[-kappa,0],[kappa,0]),new Segment([1,0],[0,-kappa],[0,kappa]),new Segment([0,1],[kappa,0],[-kappa,0])];return{Line:function(){return new Path(Point.readNamed(arguments,"from"),Point.readNamed(arguments,"to")).set(Base.getNamed(arguments))},Circle:function(){var center=Point.readNamed(arguments,"center"),radius=Base.readNamed(arguments,"radius");return createEllipse(center,new Size(radius),arguments)},Rectangle:function(){var rect=Rectangle.readNamed(arguments,"rectangle"),radius=Size.readNamed(arguments,"radius",0,{readNull:!0}),bl=rect.getBottomLeft(!0),tl=rect.getTopLeft(!0),tr=rect.getTopRight(!0),br=rect.getBottomRight(!0);if(path=new Path,!radius||radius.isZero())path._add([new Segment(bl),new Segment(tl),new Segment(tr),new Segment(br)]);else{radius=Size.min(radius,rect.getSize(!0).divide(2));var rx=radius.width,ry=radius.height,hx=rx*kappa,hy=ry*kappa;path._add([new Segment(bl.add(rx,0),null,[-hx,0]),new Segment(bl.subtract(0,ry),[0,hy]),new Segment(tl.add(0,ry),null,[0,-hy]),new Segment(tl.add(rx,0),[-hx,0],null),new Segment(tr.subtract(rx,0),null,[hx,0]),new Segment(tr.add(0,ry),[0,-hy],null),new Segment(br.subtract(0,ry),null,[0,hy]),new Segment(br.subtract(rx,0),[hx,0])])}return path._closed=!0,path.set(Base.getNamed(arguments))},RoundRectangle:"#Rectangle",Ellipse:function(){var ellipse=Shape._readEllipse(arguments);return createEllipse(ellipse.center,ellipse.radius,arguments)},Oval:"#Ellipse",Arc:function(){var from=Point.readNamed(arguments,"from"),through=Point.readNamed(arguments,"through"),to=Point.readNamed(arguments,"to"),path=new Path;return path.moveTo(from),path.arcTo(through,to),path.set(Base.getNamed(arguments))},RegularPolygon:function(){for(var center=Point.readNamed(arguments,"center"),sides=Base.readNamed(arguments,"sides"),radius=Base.readNamed(arguments,"radius"),path=new Path,step=360/sides,three=!(sides%3),vector=new Point(0,three?-radius:radius),offset=three?-1:0.5,segments=Array(sides),i=0;i<sides;i++)segments[i]=new Segment(center.add(vector.rotate((i+offset)*step)));return path._add(segments),path._closed=!0,path.set(Base.getNamed(arguments))},Star:function(){for(var center=Point.readNamed(arguments,"center"),points=2*Base.readNamed(arguments,"points"),radius1=Base.readNamed(arguments,"radius1"),radius2=Base.readNamed(arguments,"radius2"),path=new Path,step=360/points,vector=new Point(0,-1),segments=Array(points),i=0;i<points;i++)segments[i]=new Segment(center.add(vector.rotate(step*i).multiply(i%2?radius2:radius1)));return path._add(segments),path._closed=!0,path.set(Base.getNamed(arguments))}}}});var CompoundPath=PathItem.extend({_class:"CompoundPath",_serializeFields:{children:[]},initialize:function CompoundPath(arg){this._children=[],this._namedChildren={},this._initialize(arg)||("string"==typeof arg?this.setPathData(arg):this.addChildren(Array.isArray(arg)?arg:arguments))},_changed:function _changed(flags){_changed.base.call(this,flags),6&flags&&(this._currentPath=void 0)},insertChildren:function insertChildren(index,items,_preserve){items=insertChildren.base.call(this,index,items,_preserve,"path");for(var i=0,l=!_preserve&&items&&items.length,item;i<l;i++)item=items[i],void 0===item._clockwise&&item.setClockwise(0===item._index);return items},reverse:function(){for(var children=this._children,i=0,l=children.length;i<l;i++)children[i].reverse()},smooth:function(){for(var i=0,l=this._children.length;i<l;i++)this._children[i].smooth()},isClockwise:function(){var child=this.getFirstChild();return child&&child.isClockwise()},setClockwise:function(clockwise){this.isClockwise()!=!!clockwise&&this.reverse()},getFirstSegment:function(){var first=this.getFirstChild();return first&&first.getFirstSegment()},getLastSegment:function(){var last=this.getLastChild();return last&&last.getLastSegment()},getCurves:function(){for(var children=this._children,curves=[],i=0,l=children.length;i<l;i++)curves=curves.concat(children[i].getCurves());return curves},getFirstCurve:function(){var first=this.getFirstChild();return first&&first.getFirstCurve()},getLastCurve:function(){var last=this.getLastChild();return last&&last.getFirstCurve()},getArea:function(){for(var children=this._children,area=0,i=0,l=children.length;i<l;i++)area+=children[i].getArea();return area},getPathData:function(precision){for(var children=this._children,paths=[],i=0,l=children.length;i<l;i++)paths.push(children[i].getPathData(precision));return paths.join(" ")},_getWinding:function(point){for(var children=this._children,winding=0,i=0,l=children.length;i<l;i++)winding+=children[i]._getWinding(point);return winding},_getChildHitTestOptions:function(options){return"path"===options.type?options:new Base(options,{fill:!1})},_draw:function(ctx,param){var children=this._children;if(0!==children.length){if(this._currentPath)ctx.currentPath=this._currentPath;else{ctx.beginPath(),param=param.extend({compound:!0});for(var i=0,l=children.length;i<l;i++)children[i].draw(ctx,param);this._currentPath=ctx.currentPath}if(!param.clip){this._setStyles(ctx);var style=this._style;style.hasFill()&&(ctx.fill(style.getWindingRule()),ctx.shadowColor="rgba(0,0,0,0)"),style.hasStroke()&&ctx.stroke()}}}},new function(){function getCurrentPath(that){if(!that._children.length)throw new Error("Use a moveTo() command first");return that._children[that._children.length-1]}var fields={moveTo:function(){var path=new Path;this.addChild(path),path.moveTo.apply(path,arguments)},moveBy:function(){this.moveTo(getCurrentPath(this).getLastSegment()._point.add(Point.read(arguments)))},closePath:function(){getCurrentPath(this).closePath()}};return Base.each(["lineTo","cubicCurveTo","quadraticCurveTo","curveTo","arcTo","lineBy","cubicCurveBy","quadraticCurveBy","curveBy","arcBy"],function(key){fields[key]=function(){var path=getCurrentPath(this);path[key].apply(path,arguments)}}),fields}),PathFlattener=Base.extend({initialize:function(path){function addCurve(segment1,segment2){var curve=Curve.getValues(segment1,segment2);that.curves.push(curve),that._computeParts(curve,segment1._index,0,1)}this.curves=[],this.parts=[],this.length=0,this.index=0;for(var segments=path._segments,segment1=segments[0],that=this,i=1,l=segments.length,segment2;i<l;i++)segment2=segments[i],addCurve(segment1,segment2),segment1=segment2;path._closed&&addCurve(segment2,segments[0])},_computeParts:function(curve,index,minT,maxT){if(maxT-minT>1/32&&!Curve.isFlatEnough(curve,0.25)){var curves=Curve.subdivide(curve),halfT=(minT+maxT)/2;this._computeParts(curves[0],index,minT,halfT),this._computeParts(curves[1],index,halfT,maxT)}else{var x=curve[6]-curve[0],y=curve[7]-curve[1],dist=Math.sqrt(x*x+y*y);0.00001<dist&&(this.length+=dist,this.parts.push({offset:this.length,value:maxT,index:index}))}},getParameterAt:function(offset){for(var j=this.index,i;;)if(i=j,0==j||this.parts[--j].offset<offset)break;for(var l=this.parts.length,part;i<l;i++)if(part=this.parts[i],part.offset>=offset){this.index=i;var prev=this.parts[i-1],prevVal=prev&&prev.index==part.index?prev.value:0,prevLen=prev?prev.offset:0;return{value:prevVal+(part.value-prevVal)*(offset-prevLen)/(part.offset-prevLen),index:part.index}}var part=this.parts[this.parts.length-1];return{value:1,index:part.index}},evaluate:function(offset,type){var param=this.getParameterAt(offset);return Curve.evaluate(this.curves[param.index],param.value,type)},drawPart:function(ctx,from,to){from=this.getParameterAt(from),to=this.getParameterAt(to);for(var i=from.index,curve;i<=to.index;i++)curve=Curve.getPart(this.curves[i],i==from.index?from.value:0,i==to.index?to.value:1),i==from.index&&ctx.moveTo(curve[0],curve[1]),ctx.bezierCurveTo.apply(ctx,curve.slice(2))}}),PathFitter=Base.extend({initialize:function(path,error){this.points=[];for(var segments=path._segments,i=0,l=segments.length,prev,point;i<l;i++)point=segments[i].point.clone(),prev&&prev.equals(point)||(this.points.push(point),prev=point);this.error=error},fit:function(){var points=this.points,length=points.length;return this.segments=0<length?[new Segment(points[0])]:[],1<length&&this.fitCubic(0,length-1,points[1].subtract(points[0]).normalize(),points[length-2].subtract(points[length-1]).normalize()),this.segments},fitCubic:function(first,last,tan1,tan2){if(1==last-first){var pt1=this.points[first],pt2=this.points[last],dist=pt1.getDistance(pt2)/3;return void this.addCurve([pt1,pt1.add(tan1.normalize(dist)),pt2.add(tan2.normalize(dist)),pt2])}for(var uPrime=this.chordLengthParameterize(first,last),maxError=Math.max(this.error,this.error*this.error),i=0,split;4>=i;i++){var curve=this.generateBezier(first,last,uPrime,tan1,tan2),max=this.findMaxError(first,last,curve,uPrime);if(max.error<this.error)return void this.addCurve(curve);if(split=max.index,max.error>=maxError)break;this.reparameterize(first,last,uPrime,curve),maxError=max.error}var V1=this.points[split-1].subtract(this.points[split]),V2=this.points[split].subtract(this.points[split+1]),tanCenter=V1.add(V2).divide(2).normalize();this.fitCubic(first,split,tan1,tanCenter),this.fitCubic(split,last,tanCenter.negate(),tan2)},addCurve:function(curve){var prev=this.segments[this.segments.length-1];prev.setHandleOut(curve[1].subtract(curve[0])),this.segments.push(new Segment(curve[3],curve[2].subtract(curve[3])))},generateBezier:function(first,last,uPrime,tan1,tan2){for(var epsilon=1e-11,pt1=this.points[first],pt2=this.points[last],C=[[0,0],[0,0]],X=[0,0],i=0,l=last-first+1;i<l;i++){var u=uPrime[i],t=1-u,b=3*u*t,b0=t*t*t,b1=b*t,b2=b*u,b3=u*u*u,a1=tan1.normalize(b1),a2=tan2.normalize(b2),tmp=this.points[first+i].subtract(pt1.multiply(b0+b1)).subtract(pt2.multiply(b2+b3));C[0][0]+=a1.dot(a1),C[0][1]+=a1.dot(a2),C[1][0]=C[0][1],C[1][1]+=a2.dot(a2),X[0]+=a1.dot(tmp),X[1]+=a2.dot(tmp)}var detC0C1=C[0][0]*C[1][1]-C[1][0]*C[0][1],alpha1,alpha2;if(Math.abs(detC0C1)>epsilon){var detC0X=C[0][0]*X[1]-C[1][0]*X[0],detXC1=X[0]*C[1][1]-X[1]*C[0][1];alpha1=detXC1/detC0C1,alpha2=detC0X/detC0C1}else{var c0=C[0][0]+C[0][1],c1=C[1][0]+C[1][1];alpha1=Math.abs(c0)>epsilon?alpha2=X[0]/c0:Math.abs(c1)>epsilon?alpha2=X[1]/c1:alpha2=0}var segLength=pt2.getDistance(pt1);return epsilon*=segLength,(alpha1<epsilon||alpha2<epsilon)&&(alpha1=alpha2=segLength/3),[pt1,pt1.add(tan1.normalize(alpha1)),pt2.add(tan2.normalize(alpha2)),pt2]},reparameterize:function(first,last,u,curve){for(var i=first;i<=last;i++)u[i-first]=this.findRoot(curve,this.points[i],u[i-first])},findRoot:function(curve,point,u){for(var curve1=[],curve2=[],i=0;2>=i;i++)curve1[i]=curve[i+1].subtract(curve[i]).multiply(3);for(var i=0;1>=i;i++)curve2[i]=curve1[i+1].subtract(curve1[i]).multiply(2);var pt=this.evaluate(3,curve,u),pt1=this.evaluate(2,curve1,u),pt2=this.evaluate(1,curve2,u),diff=pt.subtract(point),df=pt1.dot(pt1)+diff.dot(pt2);return 0.00001>Math.abs(df)?u:u-diff.dot(pt1)/df},evaluate:function(degree,curve,t){for(var tmp=curve.slice(),i=1;i<=degree;i++)for(var j=0;j<=degree-i;j++)tmp[j]=tmp[j].multiply(1-t).add(tmp[j+1].multiply(t));return tmp[0]},chordLengthParameterize:function(first,last){for(var u=[0],i=first+1;i<=last;i++)u[i-first]=u[i-first-1]+this.points[i].getDistance(this.points[i-1]);for(var i=1,m=last-first;i<=m;i++)u[i]/=u[m];return u},findMaxError:function(first,last,curve,u){for(var index=Math.floor((last-first+1)/2),maxDist=0,i=first+1;i<last;i++){var P=this.evaluate(3,curve,u[i-first]),v=P.subtract(this.points[i]),dist=v.x*v.x+v.y*v.y;dist>=maxDist&&(maxDist=dist,index=i)}return{error:maxDist,index:index}}});PathItem.inject(new function(){function splitPath(intersections,collectOthers){intersections.sort(function(loc1,loc2){var path1=loc1.getPath(),path2=loc2.getPath();return path1===path2?loc1.getIndex()+loc1.getParameter()-(loc2.getIndex()+loc2.getParameter()):path1._index-path2._index});for(var others=collectOthers&&[],i=intersections.length-1;0<=i;i--){var loc=intersections[i],other=loc.getIntersection(),curve=loc.divide(),segment=curve&&curve.getSegment1()||loc.getSegment();others&&others.push(other),segment._intersection=other,loc._segment=segment}return others}function reorientPath(path){if(path instanceof CompoundPath){var children=path.removeChildren(),length=children.length,bounds=Array(length),counters=Array(length),clockwise;children.sort(function(a,b){return b.getBounds().getArea()-a.getBounds().getArea()}),path.addChildren(children),clockwise=children[0].isClockwise();for(var i=0;i<length;i++)bounds[i]=children[i].getBounds(),counters[i]=0;for(var i=0;i<length;i++){for(var j=1;j<length;j++)i!==j&&bounds[i].contains(bounds[j])&&counters[j]++;0<i&&0==counters[i]%2&&children[i].setClockwise(clockwise)}}return path}function computeBoolean(path1,path2,operator,subtract){path1=reorientPath(path1.clone(!1).applyMatrix()),path2=reorientPath(path2.clone(!1).applyMatrix());var path1Clockwise=path1.isClockwise(),path2Clockwise=path2.isClockwise(),intersections=path1.getIntersections(path2);splitPath(splitPath(intersections,!0)),path1Clockwise||path1.reverse(),subtract^path2Clockwise||path2.reverse(),path1Clockwise=!0,path2Clockwise=!subtract;for(var paths=[].concat(path1._children||[path1]).concat(path2._children||[path2]),segments=[],result=new CompoundPath,i=0,l=paths.length;i<l;i++){var path=paths[i],parent=path._parent,clockwise=path.isClockwise(),segs=path._segments;path=parent instanceof CompoundPath?parent:path;for(var j=segs.length-1;0<=j;j--){var segment=segs[j],midPoint=segment.getCurve().getPoint(0.5),insidePath1=path!==path1&&path1.contains(midPoint)&&(clockwise===path1Clockwise||subtract||!testOnCurve(path1,midPoint)),insidePath2=path!==path2&&path2.contains(midPoint)&&(clockwise===path2Clockwise||!testOnCurve(path2,midPoint));operator(path===path1,insidePath1,insidePath2)?segment._invalid=!0:segments.push(segment)}}for(var i=0,l=segments.length,segment;i<l;i++)if(segment=segments[i],!segment._visited){var path=new Path,loc=segment._intersection,intersection=loc&&loc.getSegment(!0);segment.getPrevious()._invalid&&segment.setHandleIn(intersection?intersection._handleIn:new Point(0,0));do{if(segment._visited=!0,segment._invalid&&segment._intersection){var inter=segment._intersection.getSegment(!0);path.add(new Segment(segment._point,segment._handleIn,inter._handleOut)),inter._visited=!0,segment=inter}else path.add(segment.clone());segment=segment.getNext()}while(segment&&!segment._visited&&segment!==intersection);var amount=path._segments.length;1<amount&&(2<amount||!path.isPolygon())?(path.setClosed(!0),result.addChild(path,!0)):path.remove()}return path1.remove(),path2.remove(),result.reduce()}function testOnCurve(path,point){var curves=path.getCurves(),bounds=path.getBounds();if(bounds.contains(point))for(var i=0,l=curves.length,curve;i<l;i++)if(curve=curves[i],curve.getBounds().contains(point)&&curve.getParameterOf(point))return!0;return!1}return{unite:function(path){return computeBoolean(this,path,function(isPath1,isInPath1,isInPath2){return isInPath1||isInPath2})},intersect:function(path){return computeBoolean(this,path,function(isPath1,isInPath1,isInPath2){return!(isInPath1||isInPath2)})},subtract:function(path){return computeBoolean(this,path,function(isPath1,isInPath1,isInPath2){return isPath1&&isInPath2||!isPath1&&!isInPath1},!0)},exclude:function(path){return new Group([this.subtract(path),path.subtract(this)])},divide:function(path){return new Group([this.subtract(path),this.intersect(path)])}}});var TextItem=Item.extend({_class:"TextItem",_boundsSelected:!0,_serializeFields:{content:null},_boundsGetter:"getBounds",initialize:function TextItem(arg){this._content="",this._lines=[];var hasProps=arg&&Base.isPlainObject(arg)&&void 0===arg.x&&void 0===arg.y;this._initialize(hasProps&&arg,!hasProps&&Point.read(arguments))},_equals:function(item){return this._content===item._content},_clone:function _clone(copy){return copy.setContent(this._content),_clone.base.call(this,copy)},getContent:function(){return this._content},setContent:function(content){this._content=""+content,this._lines=this._content.split(/\r\n|\n|\r/mg),this._changed(69)},isEmpty:function(){return!this._content},getCharacterStyle:"#getStyle",setCharacterStyle:"#setStyle",getParagraphStyle:"#getStyle",setParagraphStyle:"#setStyle"}),PointText=TextItem.extend({_class:"PointText",initialize:function PointText(){TextItem.apply(this,arguments)},clone:function(insert){return this._clone(new PointText({insert:!1}),insert)},getPoint:function(){var point=this._matrix.getTranslation();return new LinkedPoint(point.x,point.y,this,"setPoint")},setPoint:function(){var point=Point.read(arguments);this.translate(point.subtract(this._matrix.getTranslation()))},_draw:function(ctx){if(this._content){this._setStyles(ctx);var style=this._style,lines=this._lines,leading=style.getLeading(),shadowColor=ctx.shadowColor;ctx.font=style.getFontStyle(),ctx.textAlign=style.getJustification();for(var i=0,l=lines.length;i<l;i++){ctx.shadowColor=shadowColor;var line=lines[i];style.hasFill()&&(ctx.fillText(line,0,0),ctx.shadowColor="rgba(0,0,0,0)"),style.hasStroke()&&ctx.strokeText(line,0,0),ctx.translate(0,leading)}}}},new function(){var measureCtx=null;return{_getBounds:function(getter,matrix){measureCtx||(measureCtx=CanvasProvider.getContext(1,1));var style=this._style,lines=this._lines,count=lines.length,justification=style.getJustification(),leading=style.getLeading(),x=0;measureCtx.font=style.getFontStyle();for(var width=0,i=0;i<count;i++)width=Math.max(width,measureCtx.measureText(lines[i]).width);"left"!==justification&&(x-=width/("center"===justification?2:1));var bounds=new Rectangle(x,count?-0.75*leading:0,width,count*leading);return matrix?matrix._transformBounds(bounds,bounds):bounds}}}),Color=Base.extend(new function(){function fromCSS(string){var match=string.match(/^#(\w{1,2})(\w{1,2})(\w{1,2})$/),components;if(match){components=[0,0,0];for(var i=0,value;3>i;i++)value=match[i+1],components[i]=parseInt(1==value.length?value+value:value,16)/255}else if(match=string.match(/^rgba?\((.*)\)$/)){components=match[1].split(",");for(var i=0,l=components.length,value;i<l;i++)value=parseFloat(components[i]),components[i]=3>i?value/255:value}else{var cached=colorCache[string];if(!cached){colorCtx||(colorCtx=CanvasProvider.getContext(1,1),colorCtx.globalCompositeOperation="copy"),colorCtx.fillStyle="rgba(0,0,0,0)",colorCtx.fillStyle=string,colorCtx.fillRect(0,0,1,1);var data=colorCtx.getImageData(0,0,1,1).data;cached=colorCache[string]=[data[0]/255,data[1]/255,data[2]/255]}components=cached.slice()}return components}var types={gray:["gray"],rgb:["red","green","blue"],hsb:["hue","saturation","brightness"],hsl:["hue","saturation","lightness"],gradient:["gradient","origin","destination","highlight"]},componentParsers={},colorCache={},hsbIndices=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]],converters={"rgb-hsb":function(r,g,b){var max=Math.max(r,g,b),min=Math.min(r,g,b),delta=max-min,h=0==delta?0:60*(max==r?(g-b)/delta+(g<b?6:0):max==g?(b-r)/delta+2:(r-g)/delta+4);return[h,0===max?0:delta/max,max]},"hsb-rgb":function(h,s,b){h=(h/60%6+6)%6;var i=Math.floor(h),f=h-i,i=hsbIndices[i],v=[b,b*(1-s),b*(1-s*f),b*(1-s*(1-f))];return[v[i[0]],v[i[1]],v[i[2]]]},"rgb-hsl":function(r,g,b){var max=Math.max(r,g,b),min=Math.min(r,g,b),delta=max-min,achromatic=0==delta,h=achromatic?0:60*(max==r?(g-b)/delta+(g<b?6:0):max==g?(b-r)/delta+2:(r-g)/delta+4),l=(max+min)/2,s=achromatic?0:0.5>l?delta/(max+min):delta/(2-max-min);return[h,s,l]},"hsl-rgb":function(h,s,l){if(h=(h/360%1+1)%1,0===s)return[l,l,l];for(var t3s=[h+1/3,h,h-1/3],t2=0.5>l?l*(1+s):l+s-l*s,t1=2*l-t2,c=[],i=0,t3;3>i;i++)t3=t3s[i],0>t3&&(t3+=1),1<t3&&(t3-=1),c[i]=1>6*t3?t1+6*(t2-t1)*t3:1>2*t3?t2:2>3*t3?t1+6*((t2-t1)*(2/3-t3)):t1;return c},"rgb-gray":function(r,g,b){return[0.2989*r+0.587*g+0.114*b]},"gray-rgb":function(g){return[g,g,g]},"gray-hsb":function(g){return[0,0,g]},"gray-hsl":function(g){return[0,0,g]},"gradient-rgb":function(){return[]},"rgb-gradient":function(){return[]}},colorCtx;return Base.each(types,function(properties,type){componentParsers[type]=[],Base.each(properties,function(name,index){var part=Base.capitalize(name),hasOverlap=/^(hue|saturation)$/.test(name),parser=componentParsers[type][index]="gradient"===name?function(value){var current=this._components[0];return value=Gradient.read(Array.isArray(value)?value:arguments,0,{readNull:!0}),current!==value&&(current&&current._removeOwner(this),value&&value._addOwner(this)),value}:"gradient"===type?function(){return Point.read(arguments,0,{readNull:"highlight"==name,clone:!0})}:function(value){return null==value||isNaN(value)?0:value};this["get"+part]=function(){return this._type===type||hasOverlap&&/^hs[bl]$/.test(this._type)?this._components[index]:this._convert(type)[index]},this["set"+part]=function(value){this._type===type||hasOverlap&&/^hs[bl]$/.test(this._type)||(this._components=this._convert(type),this._properties=types[type],this._type=type),value=parser.call(this,value),null!=value&&(this._components[index]=value,this._changed())}},this)},{_class:"Color",_readIndex:!0,initialize:function Color(arg){var slice=Array.prototype.slice,args=arguments,read=0,type,components,alpha,values;Array.isArray(arg)&&(args=arg,arg=args[0]);var argType=null!=arg&&typeof arg;if("string"===argType&&arg in types&&(type=arg,arg=args[1],Array.isArray(arg)?(components=arg,alpha=args[2]):(this.__read&&(read=1),args=slice.call(args,1),argType=typeof arg)),!components){if(values="number"===argType?args:"object"===argType&&null!=arg.length?arg:null,values){type||(type=3<=values.length?"rgb":"gray");var length=types[type].length;alpha=values[length],this.__read&&(read+=values===arguments?length+(null==alpha?0:1):1),values.length>length&&(values=slice.call(values,0,length))}else if("string"===argType)type="rgb",components=fromCSS(arg),4===components.length&&(alpha=components[3],components.length--);else if("object"===argType)if(arg.constructor===Color){if(type=arg._type,components=arg._components.slice(),alpha=arg._alpha,"gradient"===type)for(var i=1,l=components.length,point;i<l;i++)point=components[i],point&&(components[i]=point.clone());}else if(arg.constructor===Gradient)type="gradient",values=args;else{type="hue"in arg?"lightness"in arg?"hsl":"hsb":"gradient"in arg||"stops"in arg||"radial"in arg?"gradient":"gray"in arg?"gray":"rgb";var properties=types[type];parsers=componentParsers[type],this._components=components=[];for(var i=0,l=properties.length,value;i<l;i++)value=arg[properties[i]],null==value&&0===i&&"gradient"===type&&"stops"in arg&&(value={stops:arg.stops,radial:arg.radial}),value=parsers[i].call(this,value),null!=value&&(components[i]=value);alpha=arg.alpha}this.__read&&type&&(read=1)}if(this._type=type||"rgb","gradient"===type&&(this._id=Color._id=(Color._id||0)+1),!components){this._components=components=[];for(var parsers=componentParsers[this._type],i=0,l=parsers.length,value;i<l;i++)value=parsers[i].call(this,values&&values[i]),null!=value&&(components[i]=value)}this._components=components,this._properties=types[this._type],this._alpha=alpha,this.__read&&(this.__read=read)},_serialize:function(options,dictionary){var components=this.getComponents();return Base.serialize(/^(gray|rgb)$/.test(this._type)?components:[this._type].concat(components),options,!0,dictionary)},_changed:function(){this._canvasStyle=null,this._owner&&this._owner._changed(17)},_convert:function(type){var converter;return this._type===type?this._components.slice():(converter=converters[this._type+"-"+type])?converter.apply(this,this._components):converters["rgb-"+type].apply(this,converters[this._type+"-rgb"].apply(this,this._components))},convert:function(type){return new Color(type,this._convert(type),this._alpha)},getType:function(){return this._type},setType:function(type){this._components=this._convert(type),this._properties=types[type],this._type=type},getComponents:function(){var components=this._components.slice();return null!=this._alpha&&components.push(this._alpha),components},getAlpha:function(){return null==this._alpha?1:this._alpha},setAlpha:function(alpha){this._alpha=null==alpha?null:Math.min(Math.max(alpha,0),1),this._changed()},hasAlpha:function(){return null!=this._alpha},equals:function(color){var col=Base.isPlainValue(color)?Color.read(arguments):color;return col===this||col&&this._class===col._class&&this._type===col._type&&this._alpha===col._alpha&&Base.equals(this._components,col._components)||!1},toString:function(){for(var properties=this._properties,parts=[],isGradient="gradient"===this._type,f=Formatter.instance,i=0,l=properties.length,value;i<l;i++)value=this._components[i],null!=value&&parts.push(properties[i]+": "+(isGradient?value:f.number(value)));return null!=this._alpha&&parts.push("alpha: "+f.number(this._alpha)),"{ "+parts.join(", ")+" }"},toCSS:function(hex){function convert(val){return Math.round(255*(0>val?0:1<val?1:val))}var components=this._convert("rgb"),alpha=hex||null==this._alpha?1:this._alpha;return components=[convert(components[0]),convert(components[1]),convert(components[2])],1>alpha&&components.push(0>alpha?0:alpha),hex?"#"+(16777216+(components[0]<<16)+(components[1]<<8)+components[2]).toString(16).slice(1):(4==components.length?"rgba(":"rgb(")+components.join(",")+")"},toCanvasStyle:function(ctx){if(this._canvasStyle)return this._canvasStyle;if("gradient"!==this._type)return this._canvasStyle=this.toCSS();var components=this._components,gradient=components[0],stops=gradient._stops,origin=components[1],destination=components[2],canvasGradient;if(gradient._radial){var radius=destination.getDistance(origin),highlight=components[3];if(highlight){var vector=highlight.subtract(origin);vector.getLength()>radius&&(highlight=origin.add(vector.normalize(radius-0.1)))}var start=highlight||origin;canvasGradient=ctx.createRadialGradient(start.x,start.y,0,origin.x,origin.y,radius)}else canvasGradient=ctx.createLinearGradient(origin.x,origin.y,destination.x,destination.y);for(var i=0,l=stops.length,stop;i<l;i++)stop=stops[i],canvasGradient.addColorStop(stop._rampPoint,stop._color.toCanvasStyle());return this._canvasStyle=canvasGradient},transform:function(matrix){if("gradient"===this._type){for(var components=this._components,i=1,l=components.length,point;i<l;i++)point=components[i],matrix._transformPoint(point,point,!0);this._changed()}},statics:{_types:types,random:function(){var random=Math.random;return new Color(random(),random(),random())}}})},new function(){var operators={add:function(a,b){return a+b},subtract:function(a,b){return a-b},multiply:function(a,b){return a*b},divide:function(a,b){return a/b}};return Base.each(operators,function(operator,name){this[name]=function(color){color=Color.read(arguments);for(var type=this._type,components1=this._components,components2=color._convert(type),i=0,l=components1.length;i<l;i++)components2[i]=operator(components1[i],components2[i]);return new Color(type,components2,null==this._alpha?null:operator(this._alpha,color.getAlpha()))}},{})});Base.each(Color._types,function(properties,type){var ctor=this[Base.capitalize(type)+"Color"]=function(arg){var argType=null!=arg&&typeof arg,components="object"===argType&&null!=arg.length?arg:"string"===argType?null:arguments;return components?new Color(type,components):new Color(arg)};if(3==type.length){var acronym=type.toUpperCase();Color[acronym]=this[acronym+"Color"]=ctor}},Base.exports);var Gradient=Base.extend({_class:"Gradient",initialize:function Gradient(stops,radial){this._id=Gradient._id=(Gradient._id||0)+1,stops&&this._set(stops)&&(stops=radial=null),this._stops||this.setStops(stops||["white","black"]),null==this._radial&&this.setRadial("string"==typeof radial&&"radial"===radial||radial||!1)},_serialize:function(options,dictionary){return dictionary.add(this,function(){return Base.serialize([this._stops,this._radial],options,!0,dictionary)})},_changed:function(){for(var i=0,l=this._owners&&this._owners.length;i<l;i++)this._owners[i]._changed()},_addOwner:function(color){this._owners||(this._owners=[]),this._owners.push(color)},_removeOwner:function(color){var index=this._owners?this._owners.indexOf(color):-1;-1!=index&&(this._owners.splice(index,1),0===this._owners.length&&(this._owners=void 0))},clone:function(){for(var stops=[],i=0,l=this._stops.length;i<l;i++)stops[i]=this._stops[i].clone();return new Gradient(stops)},getStops:function(){return this._stops},setStops:function(stops){if(this.stops)for(var i=0,l=this._stops.length;i<l;i++)this._stops[i]._owner=void 0;if(2>stops.length)throw new Error("Gradient stop list needs to contain at least two stops.");this._stops=GradientStop.readAll(stops,0,!1,!0);for(var i=0,l=this._stops.length,stop;i<l;i++)stop=this._stops[i],stop._owner=this,stop._defaultRamp&&stop.setRampPoint(i/(l-1));this._changed()},getRadial:function(){return this._radial},setRadial:function(radial){this._radial=radial,this._changed()},equals:function(gradient){if(gradient===this)return!0;if(gradient&&this._class===gradient._class&&this._stops.length===gradient._stops.length){for(var i=0,l=this._stops.length;i<l;i++)if(!this._stops[i].equals(gradient._stops[i]))return!1;return!0}return!1}}),GradientStop=Base.extend({_class:"GradientStop",initialize:function GradientStop(arg0,arg1){if(arg0){var color,rampPoint;void 0===arg1&&Array.isArray(arg0)?(color=arg0[0],rampPoint=arg0[1]):arg0.color?(color=arg0.color,rampPoint=arg0.rampPoint):(color=arg0,rampPoint=arg1),this.setColor(color),this.setRampPoint(rampPoint)}},clone:function(){return new GradientStop(this._color.clone(),this._rampPoint)},_serialize:function(options,dictionary){return Base.serialize([this._color,this._rampPoint],options,!0,dictionary)},_changed:function(){this._owner&&this._owner._changed(17)},getRampPoint:function(){return this._rampPoint},setRampPoint:function(rampPoint){this._defaultRamp=null==rampPoint,this._rampPoint=rampPoint||0,this._changed()},getColor:function(){return this._color},setColor:function(color){this._color=Color.read(arguments),this._color===color&&(this._color=color.clone()),this._color._owner=this,this._changed()},equals:function(stop){return stop===this||stop&&this._class===stop._class&&this._color.equals(stop._color)&&this._rampPoint==stop._rampPoint||!1}}),Style=Base.extend(new function(){var defaults={fillColor:void 0,strokeColor:void 0,strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",miterLimit:10,dashOffset:0,dashArray:[],windingRule:"nonzero",shadowColor:void 0,shadowBlur:0,shadowOffset:new Point,selectedColor:void 0,fontFamily:"sans-serif",fontWeight:"normal",fontSize:12,font:"sans-serif",leading:null,justification:"left"},flags={strokeWidth:25,strokeCap:25,strokeJoin:25,miterLimit:25,fontFamily:5,fontWeight:5,fontSize:5,font:5,leading:5,justification:5},item={},fields={_defaults:defaults,_textDefaults:new Base(defaults,{fillColor:new Color})};return Base.each(defaults,function(value,key){var isColor=/Color$/.test(key),part=Base.capitalize(key),flag=flags[key],set="set"+part,get="get"+part;fields[set]=function(value){var children=this._item&&this._item._children;if(children&&0<children.length&&"compound-path"!==this._item._type)for(var i=0,l=children.length;i<l;i++)children[i]._style[set](value);else{var old=this._values[key];old!=value&&(isColor&&(old&&(old._owner=void 0),value&&value.constructor===Color&&(value._owner&&(value=value.clone()),value._owner=this._item)),this._values[key]=value,this._item&&this._item._changed(flag||17))}},fields[get]=function(_dontMerge){var children=this._item&&this._item._children,value;if(!children||0===children.length||_dontMerge||this._item instanceof CompoundPath){var value=this._values[key];return void 0===value?(value=this._defaults[key],value&&value.clone&&(value=value.clone()),this._values[key]=value):isColor&&!(value&&value.constructor===Color)&&(this._values[key]=value=Color.read([value],0,{readNull:!0,clone:!0}),value&&(value._owner=this._item)),value}for(var i=0,l=children.length,childValue;i<l;i++)if(childValue=children[i]._style[get](),0===i)value=childValue;else if(!Base.equals(value,childValue))return void 0;return value},item[get]=function(){return this._style[get]()},item[set]=function(value){this._style[set](value)}}),Item.inject(item),fields},{_class:"Style",initialize:function Style(style,_item){this._values={},this._item=_item,_item instanceof TextItem&&(this._defaults=this._textDefaults),style&&this.set(style)},set:function(style){var isStyle=style instanceof Style,values=isStyle?style._values:style;if(values)for(var key in values)if(key in this._defaults){var value=values[key];this[key]=value&&isStyle&&value.clone?value.clone():value}},equals:function(style){return style===this||style&&this._class===style._class&&Base.equals(this._values,style._values)||!1},hasFill:function(){return!!this.getFillColor()},hasStroke:function(){return!!this.getStrokeColor()&&0<this.getStrokeWidth()},hasShadow:function(){return!!this.getShadowColor()&&0<this.getShadowBlur()},getFontStyle:function(){var size=this.getFontSize();return this.getFontWeight()+" "+size+(/[a-z]/i.test(size+"")?" ":"px ")+this.getFontFamily()},getFont:"#getFontFamily",setFont:"#setFontFamily",getLeading:function getLeading(){var leading=getLeading.base.call(this);return null==leading?1.2*this.getFontSize():leading}}),DomElement=new function(){function create(nodes,parent){for(var res=[],i=0,l=nodes&&nodes.length,el;i<l;){if(el=nodes[i++],"string"==typeof el)el=document.createElement(el);else if(!el||!el.nodeType)continue;Base.isPlainObject(nodes[i])&&DomElement.set(el,nodes[i++]),Array.isArray(nodes[i])&&create(nodes[i++],el),parent&&parent.appendChild(el),res.push(el)}return res}var special=/^(checked|value|selected|disabled)$/i,translated={text:"textContent",html:"innerHTML"},unitless={lineHeight:1,zoom:1,zIndex:1,opacity:1};return{create:function(nodes,parent){var isArray=Array.isArray(nodes),res=create(isArray?nodes:arguments,isArray?parent:null);return 1==res.length?res[0]:res},find:function(selector,root){return(root||document).querySelector(selector)},findAll:function(selector,root){return(root||document).querySelectorAll(selector)},get:function(el,key){return el?special.test(key)?"value"===key||"string"!=typeof el[key]?el[key]:!0:key in translated?el[translated[key]]:el.getAttribute(key):null},set:function(el,key,value){if("string"!=typeof key)for(var name in key)key.hasOwnProperty(name)&&this.set(el,name,key[name]);else{if(!el||void 0===value)return el;special.test(key)?el[key]=value:key in translated?el[translated[key]]=value:"style"===key?this.setStyle(el,value):"events"===key?DomEvent.add(el,value):el.setAttribute(key,value)}return el},getStyles:function(el){var doc=el&&9!==el.nodeType?el.ownerDocument:el,view=doc&&doc.defaultView;return view&&view.getComputedStyle(el,"")},getStyle:function(el,key){return el&&el.style[key]||this.getStyles(el)[key]||null},setStyle:function(el,key,value){if("string"!=typeof key)for(var name in key)key.hasOwnProperty(name)&&this.setStyle(el,name,key[name]);else /^-?[\d\.]+$/.test(value)&&!(key in unitless)&&(value+="px"),el.style[key]=value;return el},hasClass:function(el,cls){return new RegExp("\\s*"+cls+"\\s*").test(el.className)},addClass:function(el,cls){el.className=(el.className+" "+cls).trim()},removeClass:function(el,cls){el.className=el.className.replace(new RegExp("\\s*"+cls+"\\s*")," ").trim()},remove:function(el){el.parentNode&&el.parentNode.removeChild(el)},removeChildren:function(el){for(;el.firstChild;)el.removeChild(el.firstChild)},getBounds:function(el,viewport){if(!el){try{el.ownerDocument}catch(e){console.error(e.message)}return}var doc=el.ownerDocument,body=doc.body,html=doc.documentElement,rect;try{rect=el.getBoundingClientRect()}catch(e){rect={left:0,top:0,width:0,height:0}}var x=rect.left-(html.clientLeft||body.clientLeft||0),y=rect.top-(html.clientTop||body.clientTop||0);if(!viewport){var view=doc.defaultView;x+=view.pageXOffset||html.scrollLeft||body.scrollLeft,y+=view.pageYOffset||html.scrollTop||body.scrollTop}return new Rectangle(x,y,rect.width,rect.height)},getViewportBounds:function(el){var doc=el.ownerDocument,view=doc.defaultView,html=doc.documentElement;return new Rectangle(0,0,view.innerWidth||html.clientWidth,view.innerHeight||html.clientHeight)},getOffset:function(el,viewport){return this.getBounds(el,viewport).getPoint()},getSize:function(el){return this.getBounds(el,!0).getSize()},isInvisible:function(el){return this.getSize(el).equals(new Size(0,0))},isInView:function(el){return!this.isInvisible(el)&&this.getViewportBounds(el).intersects(this.getBounds(el,!0))},getPrefixValue:function(el,name){for(var value=el[name],prefixes=["webkit","moz","ms","o"],suffix=name[0].toUpperCase()+name.substring(1),i=0;4>i&&null==value;i++)value=el[prefixes[i]+suffix];return value}}},DomEvent={add:function(el,events){for(var type in events)el.addEventListener(type,events[type],!1)},remove:function(el,events){for(var type in events)el.removeEventListener(type,events[type],!1)},getPoint:function(event){var pos=event.targetTouches?event.targetTouches.length?event.targetTouches[0]:event.changedTouches[0]:event;return new Point(pos.pageX||pos.clientX+document.documentElement.scrollLeft,pos.pageY||pos.clientY+document.documentElement.scrollTop)},getTarget:function(event){return event.target||event.srcElement},getRelatedTarget:function(event){return event.relatedTarget||event.toElement},getOffset:function(event,target){return DomEvent.getPoint(event).subtract(DomElement.getOffset(target||DomEvent.getTarget(event)))},stop:function(event){event.stopPropagation(),event.preventDefault()}};DomEvent.requestAnimationFrame=new function(){function handleCallbacks(){for(var i=callbacks.length-1;0<=i;i--){var entry=callbacks[i],func=entry[0],el=entry[1];(!el||("true"==PaperScope.getAttribute(el,"keepalive")||focused)&&DomElement.isInView(el))&&(callbacks.splice(i,1),func())}nativeRequest&&(callbacks.length?nativeRequest(handleCallbacks):requested=!1)}var nativeRequest=DomElement.getPrefixValue(window,"requestAnimationFrame"),requested=!1,callbacks=[],focused=!0,timer;return DomEvent.add(window,{focus:function(){focused=!0},blur:function(){focused=!1}}),function(callback,element){callbacks.push([callback,element]),nativeRequest?!requested&&(nativeRequest(handleCallbacks),requested=!0):!timer&&(timer=setInterval(handleCallbacks,1000/60))}};var View=Base.extend(Callback,{_class:"View",initialize:function View(element){this._scope=paper,this._project=paper.project,this._element=element;var size;if(this._id=element.getAttribute("id"),null==this._id&&element.setAttribute("id",this._id="view-"+View._id++),DomEvent.add(element,this._viewHandlers),PaperScope.hasAttribute(element,"resize")){var offset=DomElement.getOffset(element,!0),that=this;size=DomElement.getViewportBounds(element).getSize().subtract(offset),this._windowHandlers={resize:function(){DomElement.isInvisible(element)||(offset=DomElement.getOffset(element,!0)),that.setViewSize(DomElement.getViewportBounds(element).getSize().subtract(offset))}},DomEvent.add(window,this._windowHandlers)}else size=DomElement.getSize(element),(size.isNaN()||size.isZero())&&(size=new Size(parseInt(element.getAttribute("width"),10),parseInt(element.getAttribute("height"),10)));if(this._setViewSize(size),PaperScope.hasAttribute(element,"stats")&&"undefined"!=typeof Stats){this._stats=new Stats;var stats=this._stats.domElement,style=stats.style,offset=DomElement.getOffset(element);style.position="absolute",style.left=offset.x+"px",style.top=offset.y+"px",document.body.appendChild(stats)}View._views.push(this),View._viewsById[this._id]=this,this._viewSize=size,(this._matrix=new Matrix)._owner=this,this._zoom=1,View._focused||(View._focused=this),this._frameItems={},this._frameItemCount=0},remove:function(){return!!this._project&&(View._focused===this&&(View._focused=null),View._views.splice(View._views.indexOf(this),1),delete View._viewsById[this._id],this._project.view==this&&(this._project.view=null),DomEvent.remove(this._element,this._viewHandlers),DomEvent.remove(window,this._windowHandlers),this._element=this._project=null,this.detach("frame"),this._animate=!1,this._frameItems={},!0)},_events:{onFrame:{install:function(){this.play()},uninstall:function(){this.pause()}},onResize:{}},_animate:!1,_time:0,_count:0,_requestFrame:function(){var that=this;DomEvent.requestAnimationFrame(function(){that._requested=!1,that._animate&&(that._requestFrame(),that._handleFrame())},this._element),this._requested=!0},_handleFrame:function(){paper=this._scope;var now=Date.now()/1000,delta=this._before?now-this._before:0;this._before=now,this._handlingFrame=!0,this.fire("frame",new Base({delta:delta,time:this._time+=delta,count:this._count++})),this._stats&&this._stats.update(),this._handlingFrame=!1,this.update()},_animateItem:function(item,animate){var items=this._frameItems;animate?(items[item._id]={item:item,time:0,count:0},1==++this._frameItemCount&&this.attach("frame",this._handleFrameItems)):(delete items[item._id],0==--this._frameItemCount&&this.detach("frame",this._handleFrameItems))},_handleFrameItems:function(event){for(var i in this._frameItems){var entry=this._frameItems[i];entry.item.fire("frame",new Base(event,{time:entry.time+=event.delta,count:entry.count++}))}},_update:function(){this._project._needsUpdate=!0,this._handlingFrame||(this._animate?this._handleFrame():this.update())},_changed:function(flags){1&flags&&(this._project._needsUpdate=!0)},_transform:function(matrix){this._matrix.concatenate(matrix),this._bounds=null,this._update()},getElement:function(){return this._element},getViewSize:function(){var size=this._viewSize;return new LinkedSize(size.width,size.height,this,"setViewSize")},setViewSize:function(){var size=Size.read(arguments),delta=size.subtract(this._viewSize);delta.isZero()||(this._viewSize.set(size.width,size.height),this._setViewSize(size),this._bounds=null,this.fire("resize",{size:size,delta:delta}),this._update())},_setViewSize:function(size){var element=this._element;element.width=size.width,element.height=size.height},getBounds:function(){return this._bounds||(this._bounds=this._matrix.inverted()._transformBounds(new Rectangle(new Point(),this._viewSize))),this._bounds},getSize:function(){return this.getBounds().getSize()},getCenter:function(){return this.getBounds().getCenter()},setCenter:function(center){center=Point.read(arguments),this.scrollBy(center.subtract(this.getCenter()))},getZoom:function(){return this._zoom},setZoom:function(zoom){this._transform(new Matrix().scale(zoom/this._zoom,this.getCenter())),this._zoom=zoom},isVisible:function(){return DomElement.isInView(this._element)},scrollBy:function(){this._transform(new Matrix().translate(Point.read(arguments).negate()))},play:function(){this._animate=!0,this._requested||this._requestFrame()},pause:function(){this._animate=!1},draw:function(){this.update()},projectToView:function(){return this._matrix._transformPoint(Point.read(arguments))},viewToProject:function(){return this._matrix._inverseTransform(Point.read(arguments))}},{statics:{_views:[],_viewsById:{},_id:0,create:function(element){return"string"==typeof element&&(element=document.getElementById(element)),new CanvasView(element)}}},new function(){function getView(event){var target=DomEvent.getTarget(event);return target.getAttribute&&View._viewsById[target.getAttribute("id")]}function viewToProject(view,event){return view.viewToProject(DomEvent.getOffset(event,view._element))}function updateFocus(){if(!View._focused||!View._focused.isVisible())for(var i=0,l=View._views.length,view;i<l;i++)if(view=View._views[i],view&&view.isVisible()){View._focused=tempFocus=view;break}}function mousedown(event){var view=View._focused=getView(event),point=viewToProject(view,event);dragging=!0,view._handleEvent("mousedown",point,event),(tool=view._scope.tool)&&tool._handleEvent("mousedown",point,event),view.update()}function handleMouseMove(view,point,event){view._handleEvent("mousemove",point,event);var tool=view._scope.tool;return tool&&tool._handleEvent(dragging&&tool.responds("mousedrag")?"mousedrag":"mousemove",point,event),view.update(),tool}function mousemove(event){var view=View._focused;if(!dragging){var target=getView(event);target?(view!==target&&handleMouseMove(view,viewToProject(view,event),event),prevFocus=view,view=View._focused=tempFocus=target):tempFocus&&tempFocus===view&&(view=View._focused=prevFocus,updateFocus())}if(view){var point=viewToProject(view,event);(dragging||view.getBounds().contains(point))&&(tool=handleMouseMove(view,point,event))}}function mouseout(event){var view=View._focused,target=DomEvent.getRelatedTarget(event);view&&(!target||"HTML"===target.nodeName)&&handleMouseMove(view,viewToProject(view,event),event)}function mouseup(event){var view=View._focused;if(view&&dragging){var point=viewToProject(view,event);curPoint=null,dragging=!1,view._handleEvent("mouseup",point,event),tool&&tool._handleEvent("mouseup",point,event),view.update()}}function selectstart(event){dragging&&event.preventDefault()}var dragging=!1,tool,prevFocus,tempFocus;return DomEvent.add(document,{mousemove:mousemove,mouseout:mouseout,mouseup:mouseup,touchmove:mousemove,touchend:mouseup,selectstart:selectstart,scroll:updateFocus}),DomEvent.add(window,{load:updateFocus}),{_viewHandlers:{mousedown:mousedown,touchstart:mousedown,selectstart:selectstart},_handleEvent:function(){},statics:{updateFocus:updateFocus}}}),CanvasView=View.extend({_class:"CanvasView",initialize:function CanvasView(canvas){if(!(canvas instanceof HTMLCanvasElement)){var size=Size.read(arguments);if(size.isZero())throw new Error("Cannot create CanvasView with the provided argument: "+canvas);canvas=CanvasProvider.getCanvas(size)}if(this._context=canvas.getContext("2d"),this._eventCounters={},this._ratio=1,"off"!==PaperScope.getAttribute(canvas,"hidpi")){var deviceRatio=window.devicePixelRatio||1,backingStoreRatio=DomElement.getPrefixValue(this._context,"backingStorePixelRatio")||1;this._ratio=deviceRatio/backingStoreRatio}View.call(this,canvas)},_setViewSize:function(size){var width=size.width,height=size.height,ratio=this._ratio,element=this._element,style=element.style;element.width=width*ratio,element.height=height*ratio,1!==ratio&&(style.width=width+"px",style.height=height+"px",this._context.scale(ratio,ratio))},update:function(){if(!this._project._needsUpdate)return!1;var ctx=this._context,size=this._viewSize;return ctx.clearRect(0,0,size.width+1,size.height+1),this._project.draw(ctx,this._matrix,this._ratio),this._project._needsUpdate=!1,!0}},new function(){function callEvent(view,type,event,point,target,lastPoint,lastItem){function call(obj){if(obj.responds(type)&&(mouseEvent||(mouseEvent=new MouseEvent(type,event,point,target,lastPoint?point.subtract(lastPoint):null,lastItem)),obj.fire(type,mouseEvent)&&mouseEvent.isStopped))return event.preventDefault(),!0}for(var item=target,mouseEvent;item;){if(call(item))return!0;item=item.getParent()}return!!call(view)}var downPoint,lastPoint,overPoint,downItem,lastItem,overItem,dragItem,dblClick,clickTime;return{_handleEvent:function(type,point,event){if(this._eventCounters[type]){var project=this._project,hit=project.hitTest(point,{tolerance:project.options.hitTolerance||0,fill:!0,stroke:!0}),item=hit&&hit.item,stopped=!1;switch(type){case"mousedown":for(stopped=callEvent(this,type,event,point,item),dblClick=lastItem==item&&300>Date.now()-clickTime,downItem=lastItem=item,downPoint=lastPoint=overPoint=point,dragItem=!stopped&&item;dragItem&&!dragItem.responds("mousedrag");)dragItem=dragItem._parent;break;case"mouseup":stopped=callEvent(this,type,event,point,item,downPoint),dragItem&&(lastPoint&&!lastPoint.equals(point)&&callEvent(this,"mousedrag",event,point,dragItem,lastPoint),item!==dragItem&&(overPoint=point,callEvent(this,"mousemove",event,point,item,overPoint))),!stopped&&item&&item===downItem&&(clickTime=Date.now(),callEvent(this,dblClick&&downItem.responds("doubleclick")?"doubleclick":"click",event,downPoint,item),dblClick=!1),downItem=dragItem=null;break;case"mousemove":dragItem&&(stopped=callEvent(this,"mousedrag",event,point,dragItem,lastPoint)),stopped||(item!==overItem&&(overPoint=point),stopped=callEvent(this,type,event,point,item,overPoint)),lastPoint=overPoint=point,item!==overItem&&(callEvent(this,"mouseleave",event,point,overItem,null,item),callEvent(this,"mouseenter",event,point,item,null,overItem),overItem=item);}return stopped}}}}),Event=Base.extend({_class:"Event",initialize:function Event(event){this.event=event},isPrevented:!1,isStopped:!1,preventDefault:function(){this.isPrevented=!0,this.event.preventDefault()},stopPropagation:function(){this.isStopped=!0,this.event.stopPropagation()},stop:function(){this.stopPropagation(),this.preventDefault()},getModifiers:function(){return Key.modifiers}}),KeyEvent=Event.extend({_class:"KeyEvent",initialize:function KeyEvent(down,key,character,event){Event.call(this,event),this.type=down?"keydown":"keyup",this.key=key,this.character=character},toString:function(){return"{ type: '"+this.type+"', key: '"+this.key+"', character: '"+this.character+"', modifiers: "+this.getModifiers()+" }"}}),Key=new function(){function handleKey(down,keyCode,charCode,event){var character=charCode?String.fromCharCode(charCode):"",specialKey=specialKeys[keyCode],key=specialKey||character.toLowerCase(),type=down?"keydown":"keyup",view=View._focused,scope=view&&view.isVisible()&&view._scope,tool=scope&&scope.tool,name;keyMap[key]=down,specialKey&&(name=Base.camelize(specialKey))in modifiers&&(modifiers[name]=down),down?charCodeMap[keyCode]=charCode:delete charCodeMap[keyCode],tool&&tool.responds(type)&&(paper=scope,tool.fire(type,new KeyEvent(down,key,character,event)),view&&view.update())}function doHandleKey(event){return"CANVAS"===event.target.tagName&&(event.preventDefault(),!0)}var specialKeys={8:"backspace",9:"tab",13:"enter",16:"shift",17:"control",18:"option",19:"pause",20:"caps-lock",27:"escape",32:"space",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",46:"delete",91:"command",93:"command",224:"command"},specialChars={9:!0,13:!0,32:!0},modifiers=new Base({shift:!1,control:!1,option:!1,command:!1,capsLock:!1,space:!1}),charCodeMap={},keyMap={},downCode;return DomEvent.add(document,{keydown:function(event){var code=event.which||event.keyCode;if(code in specialKeys){if(!doHandleKey(event))return!0;handleKey(!0,code,code in specialChars?code:0,event)}else downCode=code},keypress:function(event){return!doHandleKey(event)||void(null!=downCode&&(handleKey(!0,downCode,event.which||event.keyCode,event),downCode=null))},keyup:function(event){if(!doHandleKey(event))return!0;var code=event.which||event.keyCode;code in charCodeMap&&handleKey(!1,code,charCodeMap[code],event)}}),DomEvent.add(window,{blur:function(event){for(var code in charCodeMap)handleKey(!1,code,charCodeMap[code],event)}}),{modifiers:modifiers,isDown:function(key){return!!keyMap[key]}}},MouseEvent=Event.extend({_class:"MouseEvent",initialize:function MouseEvent(type,event,point,target,delta,relatedTarget){Event.call(this,event),this.type=type,this.point=point,this.target=target,this.delta=delta,this.relatedTarget=relatedTarget},toString:function(){return"{ type: '"+this.type+"', point: "+this.point+", target: "+this.target+(this.delta?", delta: "+this.delta:"")+(this.relatedTarget?", relatedTarget: "+this.relatedTarget:"")+", modifiers: "+this.getModifiers()+" }"}});Base.extend(Callback,{_class:"Palette",_events:["onChange"],initialize:function Palette(title,components,values){var parent=DomElement.find(".palettejs-panel")||DomElement.find("body").appendChild(DomElement.create("div",{class:"palettejs-panel"}));for(var name in this._element=parent.appendChild(DomElement.create("table",{class:"palettejs-pane"})),this._title=title,values||(values={}),this.components=components){var component=components[name];component instanceof Component||(null==component.value&&(component.value=values[name]),component.name=name,component=components[name]=new Component(component)),this._element.appendChild(component._element),component._palette=this,void 0===values[name]&&(values[name]=component.value)}this.values=Base.each(values,function(value,name){var component=components[name];component&&Base.define(values,name,{enumerable:!0,configurable:!0,get:function(){return component._value},set:function(val){component.setValue(val)}})}),window.paper&&paper.palettes.push(this)},reset:function(){for(var i in this.components)this.components[i].reset()},remove:function(){DomElement.remove(this._element)}});var Component=Base.extend(Callback,{_class:"Component",_events:["onChange","onClick"],_types:{boolean:{type:"checkbox",value:"checked"},string:{type:"text"},number:{type:"number",number:!0},button:{type:"button"},text:{tag:"div",value:"text"},slider:{type:"range",number:!0},list:{tag:"select",setOptions:function(){DomElement.removeChildren(this._input),DomElement.create(Base.each(this._options,function(option){this.push("option",{value:option,text:option})},[]),this._input)}},color:{type:"color",getValue:function(value){return new Color(value)},setValue:function(value){return new Color(value).toCSS("color"===DomElement.get(this._input,"type"))}}},initialize:function Component(obj){this._id=Component._id=(Component._id||0)+1,this._type=obj.type in this._types?obj.type:"options"in obj?"list":"onClick"in obj?"button":typeof obj.value,this._meta=this._types[this._type]||{type:this._type};var that=this,id="component-"+this._id;this._dontFire=!0,this._input=DomElement.create(this._meta.tag||"input",{id:id,type:this._meta.type,events:{change:function(){that.setValue(DomElement.get(this,that._meta.value||"value"))},click:function(){that.fire("click")}}}),this.attach("change",function(value){this._dontFire||this._palette.fire("change",this,this.name,value)}),this._element=DomElement.create("tr",["td",[this._label=DomElement.create("label",{for:id})],"td",[this._input]]),Base.each(obj,function(value,key){this[key]=value},this),this._defaultValue=this._value,this._dontFire=!1},getType:function(){return this._type},getLabel:function(){return this.__label},setLabel:function(label){this.__label=label,DomElement.set(this._label,"text",label+":")},getOptions:function(){return this._options},setOptions:function(options){this._options=options;var setOptions=this._meta.setOptions;setOptions&&setOptions.call(this)},getValue:function(){var value=this._value,getValue=this._meta.getValue;return getValue?getValue.call(this,value):value},setValue:function(value){var key=this._meta.value||"value",setValue=this._meta.setValue;setValue&&(value=setValue.call(this,value)),DomElement.set(this._input,key,value),value=DomElement.get(this._input,key),this._meta.number&&(value=parseFloat(value,10)),this._value!==value&&(this._value=value,!this._dontFire&&this.fire("change",this.getValue()))},getRange:function(){return[parseFloat(DomElement.get(this._input,"min")),parseFloat(DomElement.get(this._input,"max"))]},setRange:function(min,max){var range=Array.isArray(min)?min:[min,max];DomElement.set(this._input,{min:range[0],max:range[1]})},getMin:function(){return this.getRange()[0]},setMin:function(min){this.setRange(min,this.getMax())},getMax:function(){return this.getRange()[1]},setMax:function(max){this.setRange(this.getMin(),max)},getStep:function(){return parseFloat(DomElement.get(this._input,"step"))},setStep:function(step){DomElement.set(this._input,"step",step)},reset:function(){this.setValue(this._defaultValue)}}),ToolEvent=Event.extend({_class:"ToolEvent",_item:null,initialize:function ToolEvent(tool,type,event){this.tool=tool,this.type=type,this.event=event},_choosePoint:function(point,toolPoint){return point?point:toolPoint?toolPoint.clone():null},getPoint:function(){return this._choosePoint(this._point,this.tool._point)},setPoint:function(point){this._point=point},getLastPoint:function(){return this._choosePoint(this._lastPoint,this.tool._lastPoint)},setLastPoint:function(lastPoint){this._lastPoint=lastPoint},getDownPoint:function(){return this._choosePoint(this._downPoint,this.tool._downPoint)},setDownPoint:function(downPoint){this._downPoint=downPoint},getMiddlePoint:function(){return!this._middlePoint&&this.tool._lastPoint?this.tool._point.add(this.tool._lastPoint).divide(2):this._middlePoint},setMiddlePoint:function(middlePoint){this._middlePoint=middlePoint},getDelta:function(){return!this._delta&&this.tool._lastPoint?this.tool._point.subtract(this.tool._lastPoint):this._delta},setDelta:function(delta){this._delta=delta},getCount:function(){return /^mouse(down|up)$/.test(this.type)?this.tool._downCount:this.tool._count},setCount:function(count){this.tool[/^mouse(down|up)$/.test(this.type)?"downCount":"count"]=count},getItem:function(){if(!this._item){var result=this.tool._scope.project.hitTest(this.getPoint());if(result){for(var item=result.item,parent=item._parent;/^(group|compound-path)$/.test(parent._type);)item=parent,parent=parent._parent;this._item=item}}return this._item},setItem:function(item){this._item=item},toString:function(){return"{ type: "+this.type+", point: "+this.getPoint()+", count: "+this.getCount()+", modifiers: "+this.getModifiers()+" }"}}),Tool=PaperScopeItem.extend({_class:"Tool",_list:"tools",_reference:"tool",_events:["onActivate","onDeactivate","onEditOptions","onMouseDown","onMouseUp","onMouseDrag","onMouseMove","onKeyDown","onKeyUp"],initialize:function Tool(props){PaperScopeItem.call(this),this._firstMove=!0,this._count=0,this._downCount=0,this._set(props)},getMinDistance:function(){return this._minDistance},setMinDistance:function(minDistance){this._minDistance=minDistance,null!=this._minDistance&&null!=this._maxDistance&&this._minDistance>this._maxDistance&&(this._maxDistance=this._minDistance)},getMaxDistance:function(){return this._maxDistance},setMaxDistance:function(maxDistance){this._maxDistance=maxDistance,null!=this._minDistance&&null!=this._maxDistance&&this._maxDistance<this._minDistance&&(this._minDistance=maxDistance)},getFixedDistance:function(){return this._minDistance==this._maxDistance?this._minDistance:null},setFixedDistance:function(distance){this._minDistance=distance,this._maxDistance=distance},_updateEvent:function(type,point,minDistance,maxDistance,start,needsChange,matchMaxDistance){if(!start){if(null!=minDistance||null!=maxDistance){var minDist=null==minDistance?0:minDistance,vector=point.subtract(this._point),distance=vector.getLength();if(distance<minDist)return!1;var maxDist=null==maxDistance?0:maxDistance;if(0!=maxDist)if(distance>maxDist)point=this._point.add(vector.normalize(maxDist));else if(matchMaxDistance)return!1}if(needsChange&&point.equals(this._point))return!1}return this._lastPoint=start&&"mousemove"==type?point:this._point,this._point=point,"mousedown"===type?(this._lastPoint=this._downPoint,this._downPoint=this._point,this._downCount++):"mouseup"===type?this._lastPoint=this._downPoint:void 0,(this._count=start?0:this._count+1,!0)},_fireEvent:function(type,event){var sets=paper.project._removeSets;if(sets){"mouseup"===type&&(sets.mousedrag=null);var set=sets[type];if(set){for(var id in set){var item=set[id];for(var key in sets){var other=sets[key];other&&other!=set&&delete other[item._id]}item.remove()}sets[type]=null}}return this.responds(type)&&this.fire(type,new ToolEvent(this,type,event))},_handleEvent:function(type,point,event){paper=this._scope;var called=!1;switch(type){case"mousedown":this._updateEvent(type,point,null,null,!0,!1,!1),called=this._fireEvent(type,event);break;case"mousedrag":for(var needsChange=!1,matchMaxDistance=!1;this._updateEvent(type,point,this.minDistance,this.maxDistance,!1,needsChange,matchMaxDistance);)called=this._fireEvent(type,event)||called,needsChange=!0,matchMaxDistance=!0;break;case"mouseup":!point.equals(this._point)&&this._updateEvent("mousedrag",point,this.minDistance,this.maxDistance,!1,!1,!1)&&(called=this._fireEvent("mousedrag",event)),this._updateEvent(type,point,null,this.maxDistance,!1,!1,!1),called=this._fireEvent(type,event)||called,this._updateEvent(type,point,null,null,!0,!1,!1),this._firstMove=!0;break;case"mousemove":for(;this._updateEvent(type,point,this.minDistance,this.maxDistance,this._firstMove,!0,!1);)called=this._fireEvent(type,event)||called,this._firstMove=!1;}return called&&event.preventDefault(),called}}),Http={request:function(method,url,callback){var xhr=new(window.ActiveXObject||XMLHttpRequest)("Microsoft.XMLHTTP");return xhr.open(method.toUpperCase(),url,!0),"overrideMimeType"in xhr&&xhr.overrideMimeType("text/plain"),xhr.onreadystatechange=function(){if(4===xhr.readyState){var status=xhr.status;if(0===status||200===status)callback.call(xhr,xhr.responseText);else throw new Error("Could not load "+url+" (Error "+status+")")}},xhr.send(null)}},CanvasProvider={canvases:[],getCanvas:function(width,height,ratio){var init=!0,canvas;"object"==typeof width&&(ratio=height,height=width.height,width=width.width),ratio?1!==ratio&&(width*=ratio,height*=ratio):ratio=1,canvas=this.canvases.length?this.canvases.pop():document.createElement("canvas");var ctx=canvas.getContext("2d");return canvas.width===width&&canvas.height===height?ctx.clearRect(0,0,width+1,height+1):(canvas.width=width,canvas.height=height),ctx.save(),1!==ratio&&ctx.scale(ratio,ratio),canvas},getContext:function(width,height){return this.getCanvas(width,height).getContext("2d")},release:function(obj){var canvas=obj.canvas?obj.canvas:obj;canvas.getContext("2d").restore(),this.canvases.push(canvas)}},BlendMode=new function(){function getLum(r,g,b){return 0.2989*r+0.587*g+0.114*b}function setLum(r,g,b,l){var d=l-getLum(r,g,b);dr=r+d,dg=g+d,db=b+d;var l=getLum(dr,dg,db),mn=min(dr,dg,db),mx=max(dr,dg,db);if(0>mn){var lmn=l-mn;dr=l+(dr-l)*l/lmn,dg=l+(dg-l)*l/lmn,db=l+(db-l)*l/lmn}if(255<mx){var ln=255-l,mxl=mx-l;dr=l+(dr-l)*ln/mxl,dg=l+(dg-l)*ln/mxl,db=l+(db-l)*ln/mxl}}function getSat(r,g,b){return max(r,g,b)-min(r,g,b)}function setSat(r,g,b,s){var col=[r,g,b],mx=max(r,g,b),mn=min(r,g,b),md;mn=mn===r?0:mn===g?1:2,mx=mx===r?0:mx===g?1:2,md=0===min(mn,mx)?1===max(mn,mx)?2:1:0,col[mx]>col[mn]?(col[md]=(col[md]-col[mn])*s/(col[mx]-col[mn]),col[mx]=s):col[md]=col[mx]=0,col[mn]=0,dr=col[0],dg=col[1],db=col[2]}var min=Math.min,max=Math.max,abs=Math.abs,modes={multiply:function(){dr=br*sr/255,dg=bg*sg/255,db=bb*sb/255},screen:function(){dr=br+sr-br*sr/255,dg=bg+sg-bg*sg/255,db=bb+sb-bb*sb/255},overlay:function(){dr=128>br?2*br*sr/255:255-2*(255-br)*(255-sr)/255,dg=128>bg?2*bg*sg/255:255-2*(255-bg)*(255-sg)/255,db=128>bb?2*bb*sb/255:255-2*(255-bb)*(255-sb)/255},"soft-light":function(){var t=sr*br/255;dr=t+br*(255-(255-br)*(255-sr)/255-t)/255,t=sg*bg/255,dg=t+bg*(255-(255-bg)*(255-sg)/255-t)/255,t=sb*bb/255,db=t+bb*(255-(255-bb)*(255-sb)/255-t)/255},"hard-light":function(){dr=128>sr?2*sr*br/255:255-2*(255-sr)*(255-br)/255,dg=128>sg?2*sg*bg/255:255-2*(255-sg)*(255-bg)/255,db=128>sb?2*sb*bb/255:255-2*(255-sb)*(255-bb)/255},"color-dodge":function(){dr=0===br?0:255===sr?255:min(255,255*br/(255-sr)),dg=0===bg?0:255===sg?255:min(255,255*bg/(255-sg)),db=0===bb?0:255===sb?255:min(255,255*bb/(255-sb))},"color-burn":function(){dr=255===br?255:0===sr?0:max(0,255-255*(255-br)/sr),dg=255===bg?255:0===sg?0:max(0,255-255*(255-bg)/sg),db=255===bb?255:0===sb?0:max(0,255-255*(255-bb)/sb)},darken:function(){dr=br<sr?br:sr,dg=bg<sg?bg:sg,db=bb<sb?bb:sb},lighten:function(){dr=br>sr?br:sr,dg=bg>sg?bg:sg,db=bb>sb?bb:sb},difference:function(){dr=br-sr,0>dr&&(dr=-dr),dg=bg-sg,0>dg&&(dg=-dg),db=bb-sb,0>db&&(db=-db)},exclusion:function(){dr=br+sr*(255-br-br)/255,dg=bg+sg*(255-bg-bg)/255,db=bb+sb*(255-bb-bb)/255},hue:function(){setSat(sr,sg,sb,getSat(br,bg,bb)),setLum(dr,dg,db,getLum(br,bg,bb))},saturation:function(){setSat(br,bg,bb,getSat(sr,sg,sb)),setLum(dr,dg,db,getLum(br,bg,bb))},luminosity:function(){setLum(br,bg,bb,getLum(sr,sg,sb))},color:function(){setLum(sr,sg,sb,getLum(br,bg,bb))},add:function(){dr=min(br+sr,255),dg=min(bg+sg,255),db=min(bb+sb,255)},subtract:function(){dr=max(br-sr,0),dg=max(bg-sg,0),db=max(bb-sb,0)},average:function(){dr=(br+sr)/2,dg=(bg+sg)/2,db=(bb+sb)/2},negation:function(){dr=255-abs(255-sr-br),dg=255-abs(255-sg-bg),db=255-abs(255-sb-bb)}},nativeModes=this.nativeModes=Base.each(["source-over","source-in","source-out","source-atop","destination-over","destination-in","destination-out","destination-atop","lighter","darker","copy","xor"],function(mode){this[mode]=!0},{}),ctx=CanvasProvider.getContext(1,1),sr,sg,sb,sa,br,bg,bb,ba,dr,dg,db;Base.each(modes,function(func,mode){ctx.save();var darken="darken"===mode,ok=!1;ctx.fillStyle=darken?"#300":"#a00",ctx.fillRect(0,0,1,1),ctx.globalCompositeOperation=mode,ctx.globalCompositeOperation===mode&&(ctx.fillStyle=darken?"#a00":"#300",ctx.fillRect(0,0,1,1),ok=ctx.getImageData(0,0,1,1).data[0]!==(darken?170:51)),nativeModes[mode]=ok,ctx.restore()}),CanvasProvider.release(ctx),this.process=function(mode,srcContext,dstContext,alpha,offset){var srcCanvas=srcContext.canvas,normal="normal"===mode;if(normal||nativeModes[mode])dstContext.save(),dstContext.setTransform(1,0,0,1,0,0),dstContext.globalAlpha=alpha,normal||(dstContext.globalCompositeOperation=mode),dstContext.drawImage(srcCanvas,offset.x,offset.y),dstContext.restore();else{var process=modes[mode];if(!process)return;for(var dstData=dstContext.getImageData(offset.x,offset.y,srcCanvas.width,srcCanvas.height),dst=dstData.data,src=srcContext.getImageData(0,0,srcCanvas.width,srcCanvas.height).data,i=0,l=dst.length;i<l;i+=4){sr=src[i],br=dst[i],sg=src[i+1],bg=dst[i+1],sb=src[i+2],bb=dst[i+2],sa=src[i+3],ba=dst[i+3],process();var a1=sa*alpha/255,a2=1-a1;dst[i]=a1*dr+a2*br,dst[i+1]=a1*dg+a2*bg,dst[i+2]=a1*db+a2*bb,dst[i+3]=sa*alpha+a2*ba}dstContext.putImageData(dstData,offset.x,offset.y)}}},SVGStyles=Base.each({fillColor:["fill","color"],strokeColor:["stroke","color"],strokeWidth:["stroke-width","number"],strokeCap:["stroke-linecap","string"],strokeJoin:["stroke-linejoin","string"],miterLimit:["stroke-miterlimit","number"],dashArray:["stroke-dasharray","array"],dashOffset:["stroke-dashoffset","number"],fontFamily:["font-family","string"],fontWeight:["font-weight","string"],fontSize:["font-size","number"],justification:["text-anchor","lookup",{left:"start",center:"middle",right:"end"}],opacity:["opacity","number"],blendMode:["mix-blend-mode","string"]},function(entry,key){var part=Base.capitalize(key),lookup=entry[2];this[key]={type:entry[1],property:key,attribute:entry[0],toSVG:lookup,fromSVG:lookup&&Base.each(lookup,function(value,name){this[value]=name},{}),get:"get"+part,set:"set"+part}},{}),SVGNamespaces={href:"http://www.w3.org/1999/xlink",xlink:"http://www.w3.org/2000/xmlns"};new function(){function setAttributes(node,attrs){for(var key in attrs){var val=attrs[key],namespace=SVGNamespaces[key];"number"==typeof val&&(val=formatter.number(val)),namespace?node.setAttributeNS(namespace,key,val):node.setAttribute(key,val)}return node}function createElement(tag,attrs){return setAttributes(document.createElementNS("http://www.w3.org/2000/svg",tag),attrs)}function getTransform(item,coordinates,center){var matrix=item._matrix,trans=matrix.getTranslation(),attrs={};if(coordinates){matrix=matrix.shiftless();var point=matrix._inverseTransform(trans);attrs[center?"cx":"x"]=point.x,attrs[center?"cy":"y"]=point.y,trans=null}if(!matrix.isIdentity()){var decomposed=matrix.decompose();if(decomposed&&!decomposed.shearing){var parts=[],angle=decomposed.rotation,scale=decomposed.scaling;trans&&!trans.isZero()&&parts.push("translate("+formatter.point(trans)+")"),angle&&parts.push("rotate("+formatter.number(angle)+")"),Numerical.isZero(scale.x-1)&&Numerical.isZero(scale.y-1)||parts.push("scale("+formatter.point(scale)+")"),attrs.transform=parts.join(" ")}else attrs.transform="matrix("+matrix.getValues().join(",")+")"}return attrs}function exportGroup(item,options){for(var attrs=getTransform(item),children=item._children,node=createElement("g",attrs),i=0,l=children.length;i<l;i++){var child=children[i],childNode=exportSVG(child,options);if(childNode)if(child.isClipMask()){var clip=createElement("clipPath");clip.appendChild(childNode),setDefinition(child,clip,"clip"),setAttributes(node,{"clip-path":"url(#"+clip.id+")"})}else node.appendChild(childNode)}return node}function exportRaster(item){var attrs=getTransform(item,!0),size=item.getSize();return attrs.x-=size.width/2,attrs.y-=size.height/2,attrs.width=size.width,attrs.height=size.height,attrs.href=item.toDataURL(),createElement("image",attrs)}function exportPath(item,options){if(options.matchShapes){var shape=item.toShape(!1);if(shape)return exportShape(shape,options)}var segments=item._segments,type,attrs;if(0===segments.length)return null;if(!item.isPolygon()){type="path";var data=item.getPathData();attrs=data&&{d:data}}else if(3<=segments.length){type=item._closed?"polygon":"polyline";var parts=[];for(i=0,l=segments.length;i<l;i++)parts.push(formatter.point(segments[i]._point));attrs={points:parts.join(" ")}}else{type="line";var first=segments[0]._point,last=segments[segments.length-1]._point;attrs={x1:first.x,y1:first.y,x2:last.x,y2:last.y}}return createElement(type,attrs)}function exportShape(item){var shape=item._shape,radius=item._radius,attrs=getTransform(item,!0,"rectangle"!==shape);if("rectangle"===shape){shape="rect";var size=item._size,width=size.width,height=size.height;attrs.x-=width/2,attrs.y-=height/2,attrs.width=width,attrs.height=height,radius.isZero()&&(radius=null)}return radius&&("circle"===shape?attrs.r=radius:(attrs.rx=radius.width,attrs.ry=radius.height)),createElement(shape,attrs)}function exportCompoundPath(item){var attrs=getTransform(item,!0),data=item.getPathData();return data&&(attrs.d=data),createElement("path",attrs)}function exportPlacedSymbol(item,options){var attrs=getTransform(item,!0),symbol=item.getSymbol(),symbolNode=getDefinition(symbol,"symbol"),definition=symbol.getDefinition(),bounds=definition.getBounds();return symbolNode||(symbolNode=createElement("symbol",{viewBox:formatter.rectangle(bounds)}),symbolNode.appendChild(exportSVG(definition,options)),setDefinition(symbol,symbolNode,"symbol")),attrs.href="#"+symbolNode.id,attrs.x+=bounds.x,attrs.y+=bounds.y,attrs.width=formatter.number(bounds.width),attrs.height=formatter.number(bounds.height),createElement("use",attrs)}function exportGradient(color){var gradientNode=getDefinition(color,"color");if(!gradientNode){var gradient=color.getGradient(),radial=gradient._radial,origin=color.getOrigin().transform(),destination=color.getDestination().transform(),attrs;if(radial){attrs={cx:origin.x,cy:origin.y,r:origin.getDistance(destination)};var highlight=color.getHighlight();highlight&&(highlight=highlight.transform(),attrs.fx=highlight.x,attrs.fy=highlight.y)}else attrs={x1:origin.x,y1:origin.y,x2:destination.x,y2:destination.y};attrs.gradientUnits="userSpaceOnUse",gradientNode=createElement((radial?"radial":"linear")+"Gradient",attrs);for(var stops=gradient._stops,i=0,l=stops.length;i<l;i++){var stop=stops[i],stopColor=stop._color,alpha=stopColor.getAlpha();attrs={offset:stop._rampPoint,"stop-color":stopColor.toCSS(!0)},1>alpha&&(attrs["stop-opacity"]=alpha),gradientNode.appendChild(createElement("stop",attrs))}setDefinition(color,gradientNode,"color")}return"url(#"+gradientNode.id+")"}function exportText(item){var node=createElement("text",getTransform(item,!0));return node.textContent=item._content,node}function applyStyle(item,node){var attrs={},parent=item.getParent();return null!=item._name&&(attrs.id=item._name),Base.each(SVGStyles,function(entry){var get=entry.get,type=entry.type,value=item[get]();if(!parent||!Base.equals(parent[get](),value)){if("color"===type&&null!=value){var alpha=value.getAlpha();1>alpha&&(attrs[entry.attribute+"-opacity"]=alpha)}attrs[entry.attribute]=null==value?"none":"number"===type?formatter.number(value):"color"===type?value.gradient?exportGradient(value,item):value.toCSS(!0):"array"===type?value.join(","):"lookup"===type?entry.toSVG[value]:value}}),1===attrs.opacity&&delete attrs.opacity,null==item._visibility||item._visibility||(attrs.visibility="hidden"),setAttributes(node,attrs)}function getDefinition(item,type){return definitions||(definitions={ids:{},svgs:{}}),item&&definitions.svgs[type+"-"+item._id]}function setDefinition(item,node,type){definitions||getDefinition();var id=definitions.ids[type]=(definitions.ids[type]||0)+1;node.id=type+"-"+id,definitions.svgs[type+"-"+item._id]=node}function exportDefinitions(node,options){var svg=node,defs=null;if(definitions){for(var i in svg="svg"===node.nodeName.toLowerCase()&&node,definitions.svgs)defs||(!svg&&(svg=createElement("svg"),svg.appendChild(node)),defs=svg.insertBefore(createElement("defs"),svg.firstChild)),defs.appendChild(definitions.svgs[i]);definitions=null}return options.asString?new XMLSerializer().serializeToString(svg):svg}function exportSVG(item,options){var exporter=exporters[item._type],node=exporter&&exporter(item,options);return node&&item._data&&node.setAttribute("data-paper-data",JSON.stringify(item._data)),node&&applyStyle(item,node)}function setOptions(options){return options||(options={}),formatter=new Formatter(options.precision),options}var exporters={group:exportGroup,layer:exportGroup,raster:exportRaster,path:exportPath,shape:exportShape,"compound-path":exportCompoundPath,"placed-symbol":exportPlacedSymbol,"point-text":exportText},formatter,definitions;Item.inject({exportSVG:function(options){return options=setOptions(options),exportDefinitions(exportSVG(this,options),options)}}),Project.inject({exportSVG:function(options){options=setOptions(options);for(var layers=this.layers,size=this.view.getSize(),node=createElement("svg",{x:0,y:0,width:size.width,height:size.height,version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}),i=0,l=layers.length;i<l;i++)node.appendChild(exportSVG(layers[i],options));return exportDefinitions(node,options)}})},new function(){function getValue(node,name,isString,allowNull){var namespace=SVGNamespaces[name],value=namespace?node.getAttributeNS(namespace,name):node.getAttribute(name);return"null"===value&&(value=null),null==value?allowNull?null:isString?"":0:isString?value:parseFloat(value)}function getPoint(node,x,y,allowNull){return x=getValue(node,x,!1,allowNull),y=getValue(node,y,!1,allowNull),allowNull&&(null==x||null==y)?null:new Point(x,y)}function getSize(node,w,h,allowNull){return w=getValue(node,w,!1,allowNull),h=getValue(node,h,!1,allowNull),allowNull&&(null==w||null==h)?null:new Size(w,h)}function convertValue(value,type,lookup){return"none"===value?null:"number"===type?parseFloat(value):"array"===type?value?value.split(/[\s,]+/g).map(parseFloat):[]:"color"===type?getDefinition(value)||value:"lookup"===type?lookup[value]:value}function importGroup(node,type,isRoot,options){var nodes=node.childNodes,isClip="clippath"===type,item=new Group,project=item._project,currentStyle=project._currentStyle,children=[];isClip||(item._transformContent=!1,item=applyAttributes(item,node,isRoot),project._currentStyle=item._style.clone());for(var i=0,l=nodes.length;i<l;i++){var childNode=nodes[i],child;1===childNode.nodeType&&(child=importSVG(childNode,!1,options))&&!(child instanceof Symbol)&&children.push(child)}return item.addChildren(children),isClip&&(item=applyAttributes(item.reduce(),node,isRoot)),project._currentStyle=currentStyle,(isClip||"defs"===type)&&(item.remove(),item=null),item}function importPoly(node,type){var path=new Path,points=node.points;path.moveTo(points.getItem(0));for(var i=1,l=points.numberOfItems;i<l;i++)path.lineTo(points.getItem(i));return"polygon"===type&&path.closePath(),path}function importPath(node){var data=node.getAttribute("d"),path=1<data.match(/m/gi).length?new CompoundPath:new Path;return path.setPathData(data),path}function importGradient(node,type){for(var nodes=node.childNodes,stops=[],i=0,l=nodes.length,child;i<l;i++)child=nodes[i],1===child.nodeType&&stops.push(applyAttributes(new GradientStop,child));var isRadial="radialgradient"===type,gradient=new Gradient(stops,isRadial),origin,destination,highlight;return isRadial?(origin=getPoint(node,"cx","cy"),destination=origin.add(getValue(node,"r"),0),highlight=getPoint(node,"fx","fy",!0)):(origin=getPoint(node,"x1","y1"),destination=getPoint(node,"x2","y2")),applyAttributes(new Color(gradient,origin,destination,highlight),node),null}function applyTransform(item,value,name,node){for(var transforms=(node.getAttribute(name)||"").split(/\)\s*/g),matrix=new Matrix,i=0,l=transforms.length,transform;i<l&&(transform=transforms[i],!!transform);i++){for(var parts=transform.split("("),command=parts[0],v=parts[1].split(/[\s,]+/g),j=0,m=v.length;j<m;j++)v[j]=parseFloat(v[j]);"matrix"===command?matrix.concatenate(new Matrix(v[0],v[1],v[2],v[3],v[4],v[5])):"rotate"===command?matrix.rotate(v[0],v[1],v[2]):"translate"===command?matrix.translate(v[0],v[1]):"scale"===command?matrix.scale(v):"skewX"===command?matrix.skew(v[0],0):"skewY"===command?matrix.skew(0,v[0]):void 0}item.transform(matrix)}function applyOpacity(item,value,name){var color=item["fill-opacity"===name?"getFillColor":"getStrokeColor"]();color&&color.setAlpha(parseFloat(value))}function getAttribute(node,name,styles){var attr=node.attributes[name],value=attr&&attr.value;if(!value){var style=Base.camelize(name);value=node.style[style],value||styles.node[style]===styles.parent[style]||(value=styles.node[style])}return value?"none"===value?null:value:void 0}function applyAttributes(item,node,isRoot){var styles={node:DomElement.getStyles(node)||{},parent:!isRoot&&DomElement.getStyles(node.parentNode)||{}};return Base.each(attributes,function(apply,name){var value=getAttribute(node,name,styles);void 0!==value&&(item=Base.pick(apply(item,value,name,node,styles),item))}),item}function getDefinition(value){var match=value&&value.match(/\((?:#|)([^)']+)/);return match&&definitions[match[1]]}function importSVG(source,isRoot,options){function onLoadCallback(svg){paper=scope;var item=importSVG(svg,isRoot,options),onLoad=options.onLoad,view=scope.project&&scope.project.view;onLoad&&onLoad.call(this,item),view.update()}if(!source)return null;options?"function"==typeof options&&(options={onLoad:options}):options={};var node=source,scope=paper;if(isRoot)if("string"==typeof source&&!/^.*</.test(source)){if(node=document.getElementById(source),node)source=null;else return Http.request("get",source,onLoadCallback);}else if("undefined"!=typeof File&&source instanceof File){var reader=new FileReader;return reader.onload=function(){onLoadCallback(reader.result)},reader.readAsText(source)}if("string"==typeof source&&(node=new DOMParser().parseFromString(source,"image/svg+xml")),!node.nodeName)throw new Error("Unsupported SVG source: "+source);var type=node.nodeName.toLowerCase(),importer=importers[type],item=importer&&importer(node,type,isRoot,options)||null,data=node.getAttribute&&node.getAttribute("data-paper-data");return item&&(!(item instanceof Group)&&(item=applyAttributes(item,node,isRoot)),options.expandShapes&&item instanceof Shape&&(item.remove(),item=item.toPath()),data&&(item._data=JSON.parse(data))),isRoot&&(definitions={}),item}var importers={"#document":function(node,type,isRoot,options){for(var nodes=node.childNodes,i=0,l=nodes.length,child;i<l;i++)if(child=nodes[i],1===child.nodeType){var next=child.nextSibling;document.body.appendChild(child);var item=importSVG(child,isRoot,options);return next?node.insertBefore(child,next):node.appendChild(child),item}},g:importGroup,svg:importGroup,clippath:importGroup,polygon:importPoly,polyline:importPoly,path:importPath,lineargradient:importGradient,radialgradient:importGradient,image:function(node){var raster=new Raster(getValue(node,"href",!0));return raster.attach("load",function(){var size=getSize(node,"width","height");this.setSize(size);var center=this._matrix._transformPoint(getPoint(node,"x","y").add(size.divide(2)));this.translate(center)}),raster},symbol:function(node,type,isRoot,options){return new Symbol(importGroup(node,type,isRoot,options),!0)},defs:importGroup,use:function(node){var id=(getValue(node,"href",!0)||"").substring(1),definition=definitions[id],point=getPoint(node,"x","y");return definition?definition instanceof Symbol?definition.place(point):definition.clone().translate(point):null},circle:function(node){return new Shape.Circle(getPoint(node,"cx","cy"),getValue(node,"r"))},ellipse:function(node){return new Shape.Ellipse({center:getPoint(node,"cx","cy"),radius:getSize(node,"rx","ry")})},rect:function(node){var point=getPoint(node,"x","y"),size=getSize(node,"width","height"),radius=getSize(node,"rx","ry");return new Shape.Rectangle(new Rectangle(point,size),radius)},line:function(node){return new Path.Line(getPoint(node,"x1","y1"),getPoint(node,"x2","y2"))},text:function(node){var text=new PointText(getPoint(node,"x","y").add(getPoint(node,"dx","dy")));return text.setContent(node.textContent.trim()||""),text}},attributes=Base.each(SVGStyles,function(entry){this[entry.attribute]=function(item,value){if(item[entry.set](convertValue(value,entry.type,entry.fromSVG)),"color"===entry.type&&item instanceof Shape){var color=item[entry.get]();color&&color.transform(new Matrix().translate(item.getPosition(!0).negate()))}}},{id:function(item,value){definitions[value]=item,item.setName&&item.setName(value)},"clip-path":function(item,value){var clip=getDefinition(value);if(clip)if(clip=clip.clone(),clip.setClipMask(!0),item instanceof Group)item.insertChild(0,clip);else return new Group(clip,item)},gradientTransform:applyTransform,transform:applyTransform,"fill-opacity":applyOpacity,"stroke-opacity":applyOpacity,visibility:function(item,value){item.setVisible("visible"===value)},"stop-color":function(item,value){item.setColor&&item.setColor(value)},"stop-opacity":function(item,value){item._color&&item._color.setAlpha(parseFloat(value))},offset:function(item,value){var percentage=value.match(/(.*)%$/);item.setRampPoint(percentage?percentage[1]/100:parseFloat(value))},viewBox:function(item,value,name,node,styles){var rect=new Rectangle(convertValue(value,"array")),size=getSize(node,"width","height",!0);if(item instanceof Group){var scale=size?rect.getSize().divide(size):1,matrix=new Matrix().translate(rect.getPoint()).scale(scale);item.transform(matrix.inverted())}else if(item instanceof Symbol){size&&rect.setSize(size);var clip="visible"!=getAttribute(node,"overflow",styles),group=item._definition;clip&&!rect.contains(group.getBounds())&&(clip=new Shape.Rectangle(rect).transform(group._matrix),clip.setClipMask(!0),group.addChild(clip))}}}),definitions={};Item.inject({importSVG:function(node,options){return this.addChild(importSVG(node,!0,options))}}),Project.inject({importSVG:function(node,options){return this.activate(),importSVG(node,!0,options)}})},Base.exports.PaperScript=function(){function _$_(left,operator,right){var handler=binaryOperators[operator];if(left&&left[handler]){var res=left[handler](right);return"!="===operator?!res:res}return"+"===operator?left+right:"-"===operator?left-right:"*"===operator?left*right:"/"===operator?left/right:"%"===operator?left%right:"=="===operator?left==right:"!="===operator?left!=right:void 0}function $_(operator,value){var handler=unaryOperators[operator];return handler&&value&&value[handler]?value[handler]():"+"===operator?+value:"-"===operator?-value:void 0}function compile(code){function getOffset(offset){for(var i=0,l=insertions.length,insertion;i<l&&(insertion=insertions[i],!(insertion[0]>=offset));i++)offset+=insertion[1];return offset}function getCode(node){return code.substring(getOffset(node.range[0]),getOffset(node.range[1]))}function replaceCode(node,str){for(var start=getOffset(node.range[0]),end=getOffset(node.range[1]),insert=0,i=insertions.length-1;0<=i;i--)if(start>insertions[i][0]){insert=i+1;break}insertions.splice(insert,0,[start,str.length-end+start]),code=code.substring(0,start)+str+code.substring(end)}function walkAST(node,parent){if(node){for(var key in node)if("range"!=key){var value=node[key];if(Array.isArray(value))for(var i=0,l=value.length;i<l;i++)walkAST(value[i],node);else value&&"object"==typeof value&&walkAST(value,node)}switch(node&&node.type){case"UnaryExpression":if(node.operator in unaryOperators&&"Literal"!==node.argument.type){var arg=getCode(node.argument);replaceCode(node,"$_(\""+node.operator+"\", "+arg+")")}break;case"BinaryExpression":if(node.operator in binaryOperators&&"Literal"!==node.left.type){var left=getCode(node.left),right=getCode(node.right);replaceCode(node,"_$_("+left+", \""+node.operator+"\", "+right+")")}break;case"UpdateExpression":case"AssignmentExpression":if(!(parent&&("ForStatement"===parent.type||"BinaryExpression"===parent.type&&/^[=!<>]/.test(parent.operator)||"MemberExpression"===parent.type&&parent.computed)))if("UpdateExpression"===node.type){if(!node.prefix){var arg=getCode(node.argument);replaceCode(node,arg+" = _$_("+arg+", \""+node.operator[0]+"\", 1)")}}else if(/^.=$/.test(node.operator)&&"Literal"!==node.left.type){var left=getCode(node.left),right=getCode(node.right);replaceCode(node,left+" = _$_("+left+", \""+node.operator[0]+"\", "+right+")")}}}}var insertions=[];return walkAST(scope.acorn.parse(code,{ranges:!0})),code}function execute(code,scope){function expose(scope,hidden){for(var key in scope)(hidden||!/^_/.test(key))&&new RegExp("\\b"+key.replace(/\$/g,"\\$")+"\\b").test(code)&&(params.push(key),args.push(scope[key]))}paper=scope;var view=scope.getView(),tool=/\s+on(?:Key|Mouse)(?:Up|Down|Move|Drag)\b/.test(code)?new Tool:null,toolHandlers=tool?tool._events:[],handlers=["onFrame","onResize"].concat(toolHandlers),params=[],args=[],func;code=compile(code),paper.tool&&tool&&tool.activate(),expose({_$_:_$_,$_:$_,view:view,tool:tool},!0),expose(scope),handlers=Base.each(handlers,function(key){new RegExp("\\s+"+key+"\\b").test(code)&&(params.push(key),this.push(key+": "+key))},[]).join(", "),handlers&&(code+="\nreturn { "+handlers+" };");var firefox=window.InstallTrigger;if(firefox||window.chrome){var script=document.createElement("script"),head=document.head;firefox&&(code="\n"+code),script.appendChild(document.createTextNode("paper._execute = function("+params+") {"+code+"\n}")),head.appendChild(script),func=paper._execute,delete paper._execute,head.removeChild(script)}else func=Function(params,code);var res=func.apply(scope,args)||{};Base.each(toolHandlers,function(key){var value=res[key];value&&(tool[key]=value)}),view&&(res.onResize&&view.setOnResize(res.onResize),view.fire("resize",{size:view.size,delta:new Point}),res.onFrame&&view.setOnFrame(res.onFrame),view.update())}function load(){Base.each(document.getElementsByTagName("script"),function(script){if(/^text\/(?:x-|)paperscript$/.test(script.type)&&!script.getAttribute("data-paper-ignore")){var canvas=PaperScope.getAttribute(script,"canvas"),scope=PaperScope.get(canvas)||new PaperScope(script).setup(canvas),src=script.src;src?Http.request("get",src,function(code){execute(code,scope)}):execute(script.innerHTML,scope),script.setAttribute("data-paper-ignore",!0)}},this)}var scope=this,exports,define;!function(e,r){return"object"==typeof exports&&"object"==typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):(r(e.acorn||(e.acorn={})),void 0)}(this,function(e){"use strict";function r(e){for(var r in fr=e||{},hr)Object.prototype.hasOwnProperty.call(fr,r)||(fr[r]=hr[r]);mr=fr.sourceFile||null}function t(e,r){var t=vr(pr,e);r+=" (line "+t.line+": column "+t.column+")";var n=new SyntaxError(r);throw n.pos=e,n.loc=t,n.raisedAt=br,n}function n(e){function r(e){if(1==e.length)return t+="return str === "+JSON.stringify(e[0])+";";t+="switch(str){";for(var r=0;r<e.length;++r)t+="case "+JSON.stringify(e[r])+":";t+="return true}return false;"}e=e.split(" ");var t="",n=[];e:for(var a=0;a<e.length;++a){for(var o=0;o<n.length;++o)if(n[o][0].length==e[a].length){n[o].push(e[a]);continue e}n.push([e[a]])}if(3<n.length){n.sort(function(e,r){return r.length-e.length}),t+="switch(str.length){";for(var a=0,i;a<n.length;++a)i=n[a],t+="case "+i[0].length+":",r(i);t+="}"}else r(e);return new Function("str",t)}function a(){this.line=Ar,this.column=br-Sr}function o(){Ar=1,br=Sr=0,Er=!0,u()}function i(e,r){gr=br,fr.locations&&(kr=new a),wr=e,u(),Cr=r,Er=e.beforeExpr}function s(){var e=fr.onComment&&fr.locations&&new a,r=br,n=pr.indexOf("*/",br+=2);if(-1===n&&t(br-2,"Unterminated comment"),br=n+2,fr.locations){Kt.lastIndex=r;for(var o;(o=Kt.exec(pr))&&o.index<br;)++Ar,Sr=o.index+o[0].length}fr.onComment&&fr.onComment(!0,pr.slice(r+2,n),r,br,e,fr.locations&&new a)}function c(){for(var e=br,r=fr.onComment&&fr.locations&&new a,t=pr.charCodeAt(br+=2);dr>br&&10!==t&&13!==t&&8232!==t&&8329!==t;)++br,t=pr.charCodeAt(br);fr.onComment&&fr.onComment(!1,pr.slice(e+2,br),e,br,r,fr.locations&&new a)}function u(){for(;dr>br;){var e=pr.charCodeAt(br);if(32===e)++br;else if(13===e){++br;var r=pr.charCodeAt(br);10===r&&++br,fr.locations&&(++Ar,Sr=br)}else if(10===e)++br,++Ar,Sr=br;else if(14>e&&8<e)++br;else if(47===e){var r=pr.charCodeAt(br+1);if(42===r)s();else{if(47!==r)break;c()}}else if(160===e)++br;else{if(!(5760<=e&&Jt.test(String.fromCharCode(e))))break;++br}}}function l(){var e=pr.charCodeAt(br+1);return 48<=e&&57>=e?E(!0):(++br,i(xt))}function f(){var e=pr.charCodeAt(br+1);return Er?(++br,k()):61===e?x(Et,2):x(wt,1)}function p(){var e=pr.charCodeAt(br+1);return 61===e?x(Et,2):x(Ft,1)}function d(e){var r=pr.charCodeAt(br+1);return r===e?x(124===e?Lt:Ut,2):61===r?x(Et,2):x(124===e?Rt:Vt,1)}function m(){var e=pr.charCodeAt(br+1);return 61===e?x(Et,2):x(Tt,1)}function h(e){var r=pr.charCodeAt(br+1);return r===e?x(St,2):61===r?x(Et,2):x(At,1)}function v(e){var r=pr.charCodeAt(br+1),t=1;return r===e?(t=62===e&&62===pr.charCodeAt(br+2)?3:2,61===pr.charCodeAt(br+t)?x(Et,t+1):x(jt,t)):(61===r&&(t=61===pr.charCodeAt(br+2)?3:2),x(Ot,t))}function b(e){var r=pr.charCodeAt(br+1);return 61===r?x(qt,61===pr.charCodeAt(br+2)?3:2):x(61===e?Ct:It,1)}function y(e){switch(e){case 46:return l();case 40:return++br,i(ht);case 41:return++br,i(vt);case 59:return++br,i(yt);case 44:return++br,i(bt);case 91:return++br,i(ft);case 93:return++br,i(pt);case 123:return++br,i(dt);case 125:return++br,i(mt);case 58:return++br,i(gt);case 63:return++br,i(kt);case 48:var r=pr.charCodeAt(br+1);if(120===r||88===r)return C();case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return E(!1);case 34:case 39:return A(e);case 47:return f(e);case 37:case 42:return p();case 124:case 38:return d(e);case 94:return m();case 43:case 45:return h(e);case 60:case 62:return v(e);case 61:case 33:return b(e);case 126:return x(It,1);}return!1}function g(e){if(e?br=yr+1:yr=br,fr.locations&&(xr=new a),e)return k();if(br>=dr)return i(Br);var r=pr.charCodeAt(br);if(Qt(r)||92===r)return L();var n=y(r);if(!1===n){var o=String.fromCharCode(r);if("\\"===o||$t.test(o))return L();t(br,"Unexpected character '"+o+"'")}return n}function x(e,r){var t=pr.slice(br,br+r);br+=r,i(e,t)}function k(){for(var n="",a=br,e,r;;){br>=dr&&t(a,"Unterminated regular expression");var o=pr.charAt(br);if(Gt.test(o)&&t(a,"Unterminated regular expression"),e)e=!1;else{if("["===o)r=!0;else if("]"===o&&r)r=!1;else if("/"===o&&!r)break;e="\\"===o}++br}var n=pr.slice(a,br);++br;var s=I();return s&&!/^[gmsiy]*$/.test(s)&&t(a,"Invalid regexp flag"),i(jr,new RegExp(n,s))}function w(e,r){for(var t=br,n=0,a=0,o=null==r?1/0:r;o>a;++a){var s=pr.charCodeAt(br),i;if(i=97<=s?s-97+10:65<=s?s-65+10:48<=s&&57>=s?s-48:1/0,i>=e)break;++br,n=n*e+i}return br===t||null!=r&&br-t!==r?null:n}function C(){br+=2;var e=w(16);return null==e&&t(yr+2,"Expected hexadecimal number"),Qt(pr.charCodeAt(br))&&t(br,"Identifier directly after number"),i(Or,e)}function E(e){var r=br,n=!1,a=48===pr.charCodeAt(br);e||null!==w(10)||t(r,"Invalid number"),46===pr.charCodeAt(br)&&(++br,w(10),n=!0);var o=pr.charCodeAt(br);(69===o||101===o)&&(o=pr.charCodeAt(++br),(43===o||45===o)&&++br,null===w(10)&&t(r,"Invalid number"),n=!0),Qt(pr.charCodeAt(br))&&t(br,"Identifier directly after number");var c=pr.slice(r,br),s;return n?s=parseFloat(c):a&&1!==c.length?/[89]/.test(c)||Vr?t(r,"Invalid number"):s=parseInt(c,8):s=parseInt(c,10),i(Or,s)}function A(e){br++;for(var r="";;){br>=dr&&t(yr,"Unterminated string constant");var n=pr.charCodeAt(br);if(n===e)return++br,i(Fr,r);if(92===n){n=pr.charCodeAt(++br);var a=/^[0-7]+/.exec(pr.slice(br,br+3));for(a&&(a=a[0]);a&&255<parseInt(a,8);)a=a.slice(0,a.length-1);if("0"===a&&(a=null),++br,a)Vr&&t(br-2,"Octal literal in strict mode"),r+=String.fromCharCode(parseInt(a,8)),br+=a.length-1;else switch(n){case 110:r+="\n";break;case 114:r+="\r";break;case 120:r+=String.fromCharCode(S(2));break;case 117:r+=String.fromCharCode(S(4));break;case 85:r+=String.fromCharCode(S(8));break;case 116:r+="  ";break;case 98:r+="\b";break;case 118:r+="\x0B";break;case 102:r+="\f";break;case 48:r+="\0";break;case 13:10===pr.charCodeAt(br)&&++br;case 10:fr.locations&&(Sr=br,++Ar);break;default:r+=String.fromCharCode(n);}}else(13==n||10==n||8232==n||8329==n)&&t(yr,"Unterminated string constant"),r+=String.fromCharCode(n),++br}}function S(e){var r=w(16,e);return null===r&&t(yr,"Bad character escape sequence"),r}function I(){Bt=!1;for(var r=!0,n=br,e,a;;){if(a=pr.charCodeAt(br),Yt(a))Bt&&(e+=pr.charAt(br)),++br;else{if(92!==a)break;Bt||(e=pr.slice(n,br)),Bt=!0,117!=pr.charCodeAt(++br)&&t(br,"Expecting Unicode escape sequence \\uXXXX"),++br;var o=S(4),i=String.fromCharCode(o);i||t(br-1,"Invalid Unicode escape"),(r?Qt(o):Yt(o))||t(br-4,"Invalid Unicode escape"),e+=i}r=!1}return Bt?e:pr.slice(n,br)}function L(){var e=I(),r=Dr;return Bt||(Wt(e)?r=lt[e]:(fr.forbidReserved&&(3===fr.ecmaVersion?Mt:zt)(e)||Vr&&Xt(e))&&t(yr,"The keyword '"+e+"' is reserved")),i(r,e)}function U(){Ir=yr,Lr=gr,Ur=kr,g()}function R(e){for(Vr=e,br=Lr;Sr>br;)Sr=pr.lastIndexOf("\n",Sr-2)+1,--Ar;u(),g()}function T(){this.type=null,this.start=yr,this.end=null}function V(){this.start=xr,this.end=null,null!==mr&&(this.source=mr)}function q(){var e=new T;return fr.locations&&(e.loc=new V),fr.ranges&&(e.range=[yr,0]),e}function O(e){var r=new T;return r.start=e.start,fr.locations&&(r.loc=new V,r.loc.start=e.loc.start),fr.ranges&&(r.range=[e.range[0],0]),r}function j(e,r){return e.type=r,e.end=Lr,fr.locations&&(e.loc.end=Ur),fr.ranges&&(e.range[1]=Lr),e}function F(e){return 5<=fr.ecmaVersion&&"ExpressionStatement"===e.type&&"Literal"===e.expression.type&&"use strict"===e.expression.value}function D(e){return wr===e?(U(),!0):void 0}function B(){return!fr.strictSemicolons&&(wr===Br||wr===mt||Gt.test(pr.slice(Lr,yr)))}function M(){D(yt)||B()||X()}function z(e){wr===e?U():X()}function X(){t(yr,"Unexpected token")}function N(e){"Identifier"!==e.type&&"MemberExpression"!==e.type&&t(e.start,"Assigning to rvalue"),Vr&&"Identifier"===e.type&&Nt(e.name)&&t(e.start,"Assigning to "+e.name+" in strict mode")}function W(e){Ir=Lr=br,fr.locations&&(Ur=new a),Rr=Vr=null,Tr=[],g();var r=e||q(),t=!0;for(e||(r.body=[]);wr!==Br;){var n=J();r.body.push(n),t&&F(n)&&R(!0),t=!1}return j(r,"Program")}function J(){wr===wt&&g(!0);var e=wr,r=q();switch(e){case Mr:case Nr:U();var n=e===Mr;D(yt)||B()?r.label=null:wr===Dr?(r.label=lr(),M()):X();for(var a=0,o;a<Tr.length;++a)if(o=Tr[a],null==r.label||o.name===r.label.name){if(null!=o.kind&&(n||"loop"===o.kind))break;if(r.label&&n)break}return a===Tr.length&&t(r.start,"Unsyntactic "+e.keyword),j(r,n?"BreakStatement":"ContinueStatement");case Wr:return U(),M(),j(r,"DebuggerStatement");case Pr:return U(),Tr.push(Zt),r.body=J(),Tr.pop(),z(tt),r.test=P(),M(),j(r,"DoWhileStatement");case _r:if(U(),Tr.push(Zt),z(ht),wr===yt)return $(r,null);if(wr===rt){var i=q();return U(),G(i,!0),1===i.declarations.length&&D(ut)?_(r,i):$(r,i)}var i=K(!1,!0);return D(ut)?(N(i),_(r,i)):$(r,i);case Gr:return U(),cr(r,!0);case Kr:return U(),r.test=P(),r.consequent=J(),r.alternate=D(Hr)?J():null,j(r,"IfStatement");case Qr:return Rr||t(yr,"'return' outside of function"),U(),D(yt)||B()?r.argument=null:(r.argument=K(),M()),j(r,"ReturnStatement");case Yr:U(),r.discriminant=P(),r.cases=[],z(dt),Tr.push(en);for(var s,c;wr!=mt;)if(wr===zr||wr===Jr){var u=wr===zr;s&&j(s,"SwitchCase"),r.cases.push(s=q()),s.consequent=[],U(),u?s.test=K():(c&&t(Ir,"Multiple default clauses"),c=!0,s.test=null),z(gt)}else s||X(),s.consequent.push(J());return s&&j(s,"SwitchCase"),U(),Tr.pop(),j(r,"SwitchStatement");case Zr:return U(),Gt.test(pr.slice(Lr,yr))&&t(Lr,"Illegal newline after throw"),r.argument=K(),M(),j(r,"ThrowStatement");case et:if(U(),r.block=H(),r.handler=null,wr===Xr){var l=q();U(),z(ht),l.param=lr(),Vr&&Nt(l.param.name)&&t(l.param.start,"Binding "+l.param.name+" in strict mode"),z(vt),l.guard=null,l.body=H(),r.handler=j(l,"CatchClause")}return r.guardedHandlers=qr,r.finalizer=D($r)?H():null,r.handler||r.finalizer||t(r.start,"Missing catch or finally clause"),j(r,"TryStatement");case rt:return U(),r=G(r),M(),r;case tt:return U(),r.test=P(),Tr.push(Zt),r.body=J(),Tr.pop(),j(r,"WhileStatement");case nt:return Vr&&t(yr,"'with' in strict mode"),U(),r.object=P(),r.body=J(),j(r,"WithStatement");case dt:return H();case yt:return U(),j(r,"EmptyStatement");default:var f=Cr,p=K();if(e===Dr&&"Identifier"===p.type&&D(gt)){for(var a=0;a<Tr.length;++a)Tr[a].name===f&&t(p.start,"Label '"+f+"' is already declared");var d=wr.isLoop?"loop":wr===Yr?"switch":null;return Tr.push({name:f,kind:d}),r.body=J(),Tr.pop(),r.label=p,j(r,"LabeledStatement")}return r.expression=p,M(),j(r,"ExpressionStatement");}}function P(){z(ht);var e=K();return z(vt),e}function H(e){var t=q(),n=!0,a=!1,r;for(t.body=[],z(dt);!D(mt);){var o=J();t.body.push(o),n&&e&&F(o)&&(r=a,R(a=!0)),n=!1}return a&&!r&&R(!1),j(t,"BlockStatement")}function $(e,r){return e.init=r,z(yt),e.test=wr===yt?null:K(),z(yt),e.update=wr===vt?null:K(),z(vt),e.body=J(),Tr.pop(),j(e,"ForStatement")}function _(e,r){return e.left=r,e.right=K(),z(vt),e.body=J(),Tr.pop(),j(e,"ForInStatement")}function G(e,r){for(e.declarations=[],e.kind="var";;){var n=q();if(n.id=lr(),Vr&&Nt(n.id.name)&&t(n.id.start,"Binding "+n.id.name+" in strict mode"),n.init=D(Ct)?K(!0,r):null,e.declarations.push(j(n,"VariableDeclarator")),!D(bt))break}return j(e,"VariableDeclaration")}function K(e,r){var t=Q(r);if(!e&&wr===bt){var n=O(t);for(n.expressions=[t];D(bt);)n.expressions.push(Q(r));return j(n,"SequenceExpression")}return t}function Q(e){var r=Y(e);if(wr.isAssign){var t=O(r);return t.operator=Cr,t.left=r,U(),t.right=Q(e),N(r),j(t,"AssignmentExpression")}return r}function Y(e){var r=Z(e);if(D(kt)){var t=O(r);return t.test=r,t.consequent=K(!0),z(gt),t.alternate=K(!0,e),j(t,"ConditionalExpression")}return r}function Z(e){return er(rr(),-1,e)}function er(e,r,t){var n=wr.binop;if(null!=n&&(!t||wr!==ut)&&n>r){var a=O(e);a.left=e,a.operator=Cr,U(),a.right=er(rr(),n,t);var a=j(a,/&&|\|\|/.test(a.operator)?"LogicalExpression":"BinaryExpression");return er(a,r,t)}return e}function rr(){if(wr.prefix){var e=q(),r=wr.isUpdate;return e.operator=Cr,e.prefix=!0,U(),e.argument=rr(),r?N(e.argument):Vr&&"delete"===e.operator&&"Identifier"===e.argument.type&&t(e.start,"Deleting local variable in strict mode"),j(e,r?"UpdateExpression":"UnaryExpression")}for(var n=tr(),e;wr.postfix&&!B();)e=O(n),e.operator=Cr,e.prefix=!1,e.argument=n,N(n),U(),n=j(e,"UpdateExpression");return n}function tr(){return nr(ar())}function nr(e,r){if(D(xt)){var t=O(e);return t.object=e,t.property=lr(!0),t.computed=!1,nr(j(t,"MemberExpression"),r)}if(D(ft)){var t=O(e);return t.object=e,t.property=K(),t.computed=!0,z(pt),nr(j(t,"MemberExpression"),r)}if(!r&&D(ht)){var t=O(e);return t.callee=e,t.arguments=ur(vt,!1),nr(j(t,"CallExpression"),r)}return e}function ar(){switch(wr){case ot:var e=q();return U(),j(e,"ThisExpression");case Dr:return lr();case Or:case Fr:case jr:var e=q();return e.value=Cr,e.raw=pr.slice(yr,gr),U(),j(e,"Literal");case it:case st:case ct:var e=q();return e.value=wr.atomValue,e.raw=wr.keyword,U(),j(e,"Literal");case ht:var r=xr,t=yr;U();var n=K();return n.start=t,n.end=gr,fr.locations&&(n.loc.start=r,n.loc.end=kr),fr.ranges&&(n.range=[t,gr]),z(vt),n;case ft:var e=q();return U(),e.elements=ur(pt,!0,!0),j(e,"ArrayExpression");case dt:return ir();case Gr:var e=q();return U(),cr(e,!1);case at:return or();default:X();}}function or(){var e=q();return U(),e.callee=nr(ar(),!0),e.arguments=D(ht)?ur(vt,!1):qr,j(e,"NewExpression")}function ir(){var e=q(),r=!0,n=!1;for(e.properties=[],U();!D(mt);){if(r)r=!1;else if(z(bt),fr.allowTrailingCommas&&D(mt))break;var o={key:sr()},i=!1,a;if(D(gt)?(o.value=K(!0),a=o.kind="init"):5<=fr.ecmaVersion&&"Identifier"===o.key.type&&("get"===o.key.name||"set"===o.key.name)?(i=n=!0,a=o.kind=o.key.name,o.key=sr(),wr!==ht&&X(),o.value=cr(q(),!1)):X(),"Identifier"===o.key.type&&(Vr||n))for(var s=0,c;s<e.properties.length;++s)if(c=e.properties[s],c.key.name===o.key.name){var u=a==c.kind||i&&"init"===c.kind||"init"===a&&("get"===c.kind||"set"===c.kind);u&&!Vr&&"init"===a&&"init"===c.kind&&(u=!1),u&&t(o.key.start,"Redefinition of property")}e.properties.push(o)}return j(e,"ObjectExpression")}function sr(){return wr===Or||wr===Fr?ar():lr(!0)}function cr(e,r){wr===Dr?e.id=lr():r?X():e.id=null,e.params=[];var n=!0;for(z(ht);!D(vt);)n?n=!1:z(bt),e.params.push(lr());var a=Rr,o=Tr;if(Rr=!0,Tr=[],e.body=H(!0),Rr=a,Tr=o,Vr||e.body.body.length&&F(e.body.body[0]))for(var i=e.id?-1:0,s;i<e.params.length;++i)if(s=0>i?e.id:e.params[i],(Xt(s.name)||Nt(s.name))&&t(s.start,"Defining '"+s.name+"' in strict mode"),0<=i)for(var c=0;i>c;++c)s.name===e.params[c].name&&t(s.start,"Argument name clash in strict mode");return j(e,r?"FunctionDeclaration":"FunctionExpression")}function ur(e,r,t){for(var n=[],a=!0;!D(e);){if(a)a=!1;else if(z(bt),r&&fr.allowTrailingCommas&&D(e))break;t&&wr===bt?n.push(null):n.push(K(!0))}return n}function lr(e){var r=q();return r.name=wr===Dr?Cr:e&&!fr.forbidReserved&&wr.keyword||X(),U(),j(r,"Identifier")}e.version="0.3.2";var fr,pr,dr,mr;e.parse=function(e,t){return pr=e+"",dr=pr.length,r(t),o(),W(fr.program)};var hr=e.defaultOptions={ecmaVersion:5,strictSemicolons:!1,allowTrailingCommas:!0,forbidReserved:!1,locations:!1,onComment:null,ranges:!1,program:null,sourceFile:null},vr=e.getLineInfo=function(e,r){for(var t=1,n=0;;){Kt.lastIndex=n;var a=Kt.exec(e);if(!(a&&a.index<r))break;++t,n=a.index+a[0].length}return{line:t,column:r-n}};e.tokenize=function(e,t){function n(e){return g(e),a.start=yr,a.end=gr,a.startLoc=xr,a.endLoc=kr,a.type=wr,a.value=Cr,a}pr=e+"",dr=pr.length,r(t),o();var a={};return n.jumpTo=function(e,r){if(br=e,fr.locations){Ar=1,Sr=Kt.lastIndex=0;for(var t;(t=Kt.exec(pr))&&t.index<e;)++Ar,Sr=t.index+t[0].length}Er=r,u()},n};var qr=[],Or={type:"num"},jr={type:"regexp"},Fr={type:"string"},Dr={type:"name"},Br={type:"eof"},Mr={keyword:"break"},zr={keyword:"case",beforeExpr:!0},Xr={keyword:"catch"},Nr={keyword:"continue"},Wr={keyword:"debugger"},Jr={keyword:"default"},Pr={keyword:"do",isLoop:!0},Hr={keyword:"else",beforeExpr:!0},$r={keyword:"finally"},_r={keyword:"for",isLoop:!0},Gr={keyword:"function"},Kr={keyword:"if"},Qr={keyword:"return",beforeExpr:!0},Yr={keyword:"switch"},Zr={keyword:"throw",beforeExpr:!0},et={keyword:"try"},rt={keyword:"var"},tt={keyword:"while",isLoop:!0},nt={keyword:"with"},at={keyword:"new",beforeExpr:!0},ot={keyword:"this"},it={keyword:"null",atomValue:null},st={keyword:"true",atomValue:!0},ct={keyword:"false",atomValue:!1},ut={keyword:"in",binop:7,beforeExpr:!0},lt={break:Mr,case:zr,catch:Xr,continue:Nr,debugger:Wr,default:Jr,do:Pr,else:Hr,finally:$r,for:_r,function:Gr,if:Kr,return:Qr,switch:Yr,throw:Zr,try:et,var:rt,while:tt,with:nt,null:it,true:st,false:ct,new:at,in:ut,instanceof:{keyword:"instanceof",binop:7,beforeExpr:!0},this:ot,typeof:{keyword:"typeof",prefix:!0,beforeExpr:!0},void:{keyword:"void",prefix:!0,beforeExpr:!0},delete:{keyword:"delete",prefix:!0,beforeExpr:!0}},ft={type:"[",beforeExpr:!0},pt={type:"]"},dt={type:"{",beforeExpr:!0},mt={type:"}"},ht={type:"(",beforeExpr:!0},vt={type:")"},bt={type:",",beforeExpr:!0},yt={type:";",beforeExpr:!0},gt={type:":",beforeExpr:!0},xt={type:"."},kt={type:"?",beforeExpr:!0},wt={binop:10,beforeExpr:!0},Ct={isAssign:!0,beforeExpr:!0},Et={isAssign:!0,beforeExpr:!0},At={binop:9,prefix:!0,beforeExpr:!0},St={postfix:!0,prefix:!0,isUpdate:!0},It={prefix:!0,beforeExpr:!0},Lt={binop:1,beforeExpr:!0},Ut={binop:2,beforeExpr:!0},Rt={binop:3,beforeExpr:!0},Tt={binop:4,beforeExpr:!0},Vt={binop:5,beforeExpr:!0},qt={binop:6,beforeExpr:!0},Ot={binop:7,beforeExpr:!0},jt={binop:8,beforeExpr:!0},Ft={binop:10,beforeExpr:!0},br,yr,gr,xr,kr,wr,Cr,Er,Ar,Sr,Ir,Lr,Ur,Rr,Tr,Vr;for(var Dt in e.tokTypes={bracketL:ft,bracketR:pt,braceL:dt,braceR:mt,parenL:ht,parenR:vt,comma:bt,semi:yt,colon:gt,dot:xt,question:kt,slash:wt,eq:Ct,name:Dr,eof:Br,num:Or,regexp:jr,string:Fr},lt)e.tokTypes["_"+Dt]=lt[Dt];var Mt=n("abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile"),zt=n("class enum extends super const export import"),Xt=n("implements interface let package private protected public static yield"),Nt=n("eval arguments"),Wt=n("break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this"),Jt=/[\u1680\u180e\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]/,Pt="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0\u08A2-\u08AC\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097F\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F0\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA697\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA793\uA7A0-\uA7AA\uA7F8-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",Ht="\u0300-\u036F\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u0620-\u0649\u0672-\u06D3\u06E7-\u06E8\u06FB-\u06FC\u0730-\u074A\u0800-\u0814\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0840-\u0857\u08E4-\u08FE\u0900-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962-\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09D7\u09DF-\u09E0\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2-\u0AE3\u0AE6-\u0AEF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5F-\u0B60\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C01-\u0C03\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62-\u0C63\u0C66-\u0C6F\u0C82\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2-\u0CE3\u0CE6-\u0CEF\u0D02\u0D03\u0D46-\u0D48\u0D57\u0D62-\u0D63\u0D66-\u0D6F\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E34-\u0E3A\u0E40-\u0E45\u0E50-\u0E59\u0EB4-\u0EB9\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F41-\u0F47\u0F71-\u0F84\u0F86-\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1029\u1040-\u1049\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u170E-\u1710\u1720-\u1730\u1740-\u1750\u1772\u1773\u1780-\u17B2\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1920-\u192B\u1930-\u193B\u1951-\u196D\u19B0-\u19C0\u19C8-\u19C9\u19D0-\u19D9\u1A00-\u1A15\u1A20-\u1A53\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1B46-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C00-\u1C22\u1C40-\u1C49\u1C5B-\u1C7D\u1CD0-\u1CD2\u1D00-\u1DBE\u1E01-\u1F15\u200C\u200D\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2D81-\u2D96\u2DE0-\u2DFF\u3021-\u3028\u3099\u309A\uA640-\uA66D\uA674-\uA67D\uA69F\uA6F0-\uA6F1\uA7F8-\uA800\uA806\uA80B\uA823-\uA827\uA880-\uA881\uA8B4-\uA8C4\uA8D0-\uA8D9\uA8F3-\uA8F7\uA900-\uA909\uA926-\uA92D\uA930-\uA945\uA980-\uA983\uA9B3-\uA9C0\uAA00-\uAA27\uAA40-\uAA41\uAA4C-\uAA4D\uAA50-\uAA59\uAA7B\uAAE0-\uAAE9\uAAF2-\uAAF3\uABC0-\uABE1\uABEC\uABED\uABF0-\uABF9\uFB20-\uFB28\uFE00-\uFE0F\uFE20-\uFE26\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",$t=new RegExp("["+Pt+"]"),_t=new RegExp("["+Pt+Ht+"]"),Gt=/[\n\r\u2028\u2029]/,Kt=/\r\n|[\n\r\u2028\u2029]/g,Qt=e.isIdentifierStart=function(e){return 65>e?36==e:!!(91>e)||(97>e?95==e:!!(123>e)||170<=e&&$t.test(String.fromCharCode(e)))},Yt=e.isIdentifierChar=function(e){return 48>e?36==e:!!(58>e)||!(65>e)&&(!!(91>e)||(97>e?95==e:!!(123>e)||170<=e&&_t.test(String.fromCharCode(e))))},Zt={kind:"loop"},en={kind:"switch"},Bt}),window.acorn=scope.acorn;var binaryOperators={"+":"__add","-":"__subtract","*":"__multiply","/":"__divide","%":"__modulo","==":"equals","!=":"equals"},unaryOperators={"-":"__negate","+":null},fields=Base.each(["add","subtract","multiply","divide","modulo","negate"],function(name){this["__"+name]="#"+name},{});return Point.inject(fields),Size.inject(fields),Color.inject(fields),"complete"===document.readyState?setTimeout(load):DomEvent.add(window,{load:load}),{compile:compile,execute:execute,load:load,lineNumberBase:0}}.call(this);var UI={},Game={},ai={grid:{},getEditor:function(){return window.ai.editor}},data={m:{},data:{set:function(){}},f:function(){}},source=window.ai||data;for(var d in data)ai[d]=source[d];ai.m.turtleImagePath="/image/activities/turtle.png";var createTextItem=Game.createTextItem=function(x,y,text){var tracker=trackItem("TextItem",{text:text,x:x,y:y}),t=new PointText(new Point(x,y));return t.fillColor="#a5a5a5",t.content=text,t.fontSize=12,t._itemTracker=tracker,t};Game.GRID_MARGIN=40,Game.drawGrid=function(width,height,gap,scale,showMargin,minorGridlines,color,borderColor,hideLabels){var origin=showMargin?Game.GRID_MARGIN:0;gap=gap||50,scale=scale||1;var margin=4,fontSize=12,fontWidth=3*(fontSize/4),start=30;"number"==typeof gap&&(gap={x:gap,y:gap});var startValueX=0===origin?gap.x:0,startValueY=0===origin?gap.y:0,endX=0===origin?width-gap.x/2:width,endY=0===origin?height-gap.y/2:height,totalWidth=width+2*origin,totalHeight=height+2*origin,textX=(0===origin?gap.x-2*margin:origin)-margin-fontWidth,GRID_COLOR=color||"#d0d0d0",GRID_COLOR_2=GRID_COLOR||borderColor;ai.grid.COLOR=GRID_COLOR,ai.grid.xLabels=[],ai.grid.yLabels=[],ai.grid.xLabels2=[],ai.grid.yLabels2=[],ai.grid.xLines=[],ai.grid.yLines=[];for(var borderOffset=1,i=startValueY;i<=endY;i+=gap.y){if((25<gap.y||0==i/gap.y%2)&&!hideLabels){var t=createTextItem(textX,i+margin+origin,i/scale);t.justification="right",ai.grid.yLabels.push(t),t=createTextItem(totalWidth-margin,i+margin+origin,i/scale),t.justification="right",ai.grid.yLabels2.push(t)}var isBorder=i==startValueY||i==endY,gridColor=isBorder?GRID_COLOR_2:GRID_COLOR,y=i+origin;i===startValueY&&(y-=borderOffset),i===endY&&(y+=borderOffset);var p=new Path([start,y],[totalWidth-start,y]);if(p.strokeColor=gridColor,ai.grid.yLines.push(p),i&&minorGridlines){y-=gap.y/2;var p=new Path([start,y],[totalWidth-start,y]);p.strokeColor=gridColor,p.dashArray=[4,6]}}for(var i=startValueX;i<=endX;i+=gap.x){var isBorder=i==startValueX||i==endX,gridColor=isBorder?GRID_COLOR_2:GRID_COLOR;if((25<gap.x||0==i/gap.x%2)&&!hideLabels){var t=createTextItem(i+origin,fontSize+margin,i/scale);t.justification="center",ai.grid.xLabels.push(t),t=createTextItem(i+origin,totalHeight-2*margin,i/scale),t.justification="center",ai.grid.xLabels2.push(t)}var x=i+origin;i===startValueX&&(x-=borderOffset),i===endX&&(x+=borderOffset);var p2=new Path([x,start],[x,totalHeight-start]);if(p2.strokeColor=gridColor,ai.grid.xLines.push(p2),i&&minorGridlines){x-=gap.x/2;var p2=new Path([x,start],[x,totalHeight-start]);p2.strokeColor=gridColor,p2.dashArray=[4,6]}}},Game.Button=function(text,x,y,callback){function addEvent(name,both){Object.defineProperty(that,name,{get:function(){return this._rectangle[name]},set:function(newValue){this._rectangle[name]=newValue?function(e){e.relatedTarget!=that._text&&newValue.call(that,e)}:null,both&&(this._text[name]=this._rectangle[name])}})}function defineProperty(propertyName,componentPropertyName,components){Object.defineProperty(that,propertyName,{get:function(){return this["_"+components[0]][componentPropertyName]},set:function(newValue){for(var i=0;i<components.length;i++)this["_"+components[i]][componentPropertyName]=newValue;this.update()}})}var tracker=trackItem("Button",{text:text,x:x,y:y,callback:callback}),that={},MARGIN=8,FONT_SIZE=20;if("object"==typeof text){var o=text;text=o.content||"",MARGIN=o.margin||MARGIN,x=null==o.x?x:o.x,y=null==o.y?y:o.y,FONT_SIZE=o.fontSize||FONT_SIZE,callback=o.onClick||callback}null==y?(that._center=!0,x=paper.getView().bounds.width/2,y=paper.getView().bounds.height/2):(null==x&&(x=y),x+=2*MARGIN,y+=FONT_SIZE+MARGIN);var t=new PointText(new Point(x,y));t.fontSize=FONT_SIZE,t.content=text,t.fillColor="white",t.onClick=callback,t.justification=that._center?"center":"left",that._margin=MARGIN;var r=Shape.Rectangle(x,y,10,10);r.strokeWidth=0,r.fillColor="lightBlue",r.opacity=.9,r.onClick=callback,t.bringToFront(),that._rectangle=r,that._text=t,that.update=function(){if(this._center){var tl=this._text.bounds.topLeft,br=this._text.bounds.bottomRight;this._rectangle.bounds=new Rectangle(new Point(tl.x-this._margin,tl.y-this._margin),new Point(br.x+this._margin,br.y+this._margin))}else this._rectangle.bounds.width=this._text.bounds.width+4*this._margin,this._rectangle.bounds.height=this._text.bounds.height+2*this._margin,this._rectangle.bounds.center=this._text.bounds.center};var oldTextDraw=that._text._draw,oldRectDraw=that._rectangle._draw,text=that._text,rect=that._rectangle;that.update(),that._rectangle._draw=function(ctx,params){ctx.restore(),ctx.save(),this.bounds.center=text.bounds.center,params.transforms[2].tx=this.bounds.center.x,params.transforms[2].ty=this.bounds.center.y,params.transforms[2].applyToContext(ctx),oldRectDraw.call(this,ctx,params)},that._text._draw=function(ctx,params){oldTextDraw.call(this,ctx,params)},Object.defineProperty(that,"position",{get:function(){return this._text.position},set:function(newValue){this._text.position=newValue,this.update()}}),Object.defineProperty(that,"bounds",{get:function(){return this._rectangle.bounds},set:function(newValue){this._rectangle.bounds=newValue,this.update()}}),Object.defineProperty(that,"margin",{get:function(){return this._margin},set:function(newValue){this._margin=newValue,this.update()}}),addEvent.call(that,"onClick",!0),addEvent.call(that,"onMouseEnter"),addEvent.call(that,"onMouseLeave"),addEvent.call(that,"onMouseDown",!0),addEvent.call(that,"onMouseUp",!0),addEvent.call(that,"onMouseDrag",!0),that.onMouseEnter=function(e){this._rectangle.fillColor.lightness-=.1},that.onMouseLeave=function(e){this._rectangle.fillColor.lightness+=.1};var properties={fillColor:["rectangle"],"textColor|fillColor":["text"],visible:["rectangle","text"],content:["text"],fontSize:["text"],fontFamily:["text"],text:"content"};for(var p in properties){var ps=p.split("|"),propertyName=ps[0],componentPropertyName=ps[1]||ps[0],components=properties[p];"string"==typeof components&&(componentPropertyName=components,components=properties[componentPropertyName]),defineProperty.call(that,propertyName,componentPropertyName,components)}return that.remove=function(){this.visible=!1},that._itemTracker=tracker,that},Game.Message=function(text,x,y,callback){var tracker=trackItem("Message",{text:text,x:x,y:y,callback:callback}),that=Game.Button(text,x,y,callback);return that.fillColor="black",that._rectangle.opacity=0.9,that.onMouseLeave=null,that.onMouseEnter=null,that._itemTracker=tracker,that},Game.FadingLabel=function(text,x,y){checkArgs("FadingLabel",arguments,[["string","number"],["number","undefined"],["number","undefined"]]);var tracker=trackItem("FadingLabel",{x:x,y:y,text:text}),msg;text=text||"+1",x=x||Game.getBounds().width/2,y=y||Game.getBounds().height/2;try{msg=new PointText(x,y),msg.fontSize=30,msg.content=text,msg.fillColor="white",msg.strokeColor="black",msg.fontWeight="bold",msg.justification="center",msg.time=1,msg._gameClass="FadingLabel",msg._gameArgs={x:x,y:y,text:text}}catch(e){throw"Could not create Game.FadingLabel. Correct usage: Game.FadingLabel(text, [x], [y])"}return msg.onFrame=function(e){this.opacity=this.time-e.time,0>=this.opacity&&msg&&(msg.remove(),msg=null)},msg._itemTracker=tracker,msg},Game.Text=function(text,x,y,callback){var tracker=trackItem("Text",{text:text,x:x,y:y,callback:callback}),that=Game.Button({content:text,x:x,y:y,onClick:callback,margin:2});return that.fillColor=null,that.textColor="black",that.onMouseLeave=null,that.onMouseEnter=null,that._itemTracker=tracker,that},Game.randomInt=function(start,end,randomSign){var tracker=trackItem("randomInt",{start:start,end:end,randomSign:randomSign});if(null==start||isNaN(start))return 0;if(null==end||isNaN(end))return Math.floor(Math.random()*start);var result=Math.floor(Math.random()*(end-start+1))+start;return randomSign?0.5>Math.random()?result:-1*result:result},Game.random=function(start,end){var tracker=trackItem("randomInt",{start:start,end:end});return null==start||isNaN(start)?this.random(paper.getView().bounds.width):null==end||isNaN(end)?Math.random()*start:Math.random()*(end-start)+start},Game.reset=function(){if(!window.paper||paper.view){if(!this._initDefaultSounds){var defaultSounds={GoodItem:"itempickup",BadItem:"explosion1",Goal:"click"};for(var p in defaultSounds){var sound=defaultSounds[p];(function(type,sound){Object.defineProperty(Game[type],"hitSound",{get:function(){return this._hitSound||(this.hitSound=sound),this._hitSound},set:function(newSound){newSound&&"string"==typeof newSound&&"/"!=newSound.charAt(0)&&(newSound="/audio/game/"+newSound+".mp3"),"string"==typeof newSound&&(newSound=new Audio(newSound)),this._hitSound=newSound},enumerable:!0})})(p,sound)};Game._initDefaultSounds=!0}for(var type in this.setCursor(""),this.setBackgroundImage(""),this.setBackgroundColor(""),Game.BackgroundSong&&(Game.BackgroundSong.pause(),Game.BackgroundSong.currentTime=0),this.soundOn=!0,defaultSounds)this[type].hitSound=defaultSounds[type];this.scPlayer&&this.scPlayer.pause(),this.enemies=new ItemGroup,this.players=[],this.teleports=[],this.scores=[],this.goodItems=new ItemGroup,this.badItems=new ItemGroup,this.obstacles=new ItemGroup,this.staticItems=new ItemGroup,this.gameOver=!1,this.depthSorted=!1,paper.project.activeLayer.removeChildren(),this.clearTimerEvents(),this.intervals=[],this.timeouts=[],this.itemLoadCount=0,this.runOnFrameFunctions=!1,trackReset()}},Game.nextLevel=Game.loadPage=function(url,autoStart,points){checkArgs("nextLevel",[url],["string"]);var tracker=trackItem("nextLevel",{url:url,autoStart:autoStart,points:points});location.href.match(/(codeavengers\.com|localhost)\/c\//)?location.assign(url):window.open(url)},Game.scores=[],Game.items=new ItemGroup,Game.goodItems=new ItemGroup,Game.badItems=new ItemGroup,Game.obstacles=new ItemGroup,Game.staticItems=new ItemGroup,Game.depthSorted=!1,Game.setInterval=function(callback,time){if(!runAfterPlay("setInterval",arguments)){checkArgs("setInterval",arguments,["function","number"]);var tracker=trackItem("setInterval",{callback:callback,time:time});Game.intervals||(Game.intervals=[]);var interval=setInterval(callback,time);return Game.intervals.push(interval),interval}},Game.setTimeout=function(callback,time){if(!runAfterPlay("setTimeout",arguments)){checkArgs("setTimeout",arguments,["function","number"]);var tracker=trackItem("setTimeout",{callback:callback,time:time});Game.timeouts||(Game.timeouts=[]);var timeout=setTimeout(callback,time);return Game.timeouts.push(timeout),timeout}},Game.clearInterval=function(id,index){if(!runAfterPlay("clearInterval",arguments)){checkArgs("clearInterval",[id],["number"]);var tracker=trackItem("clearInterval",{id:id,index:index});if(Game.intervals)if(index)Game.intervals.splice(index,1),clearInterval(id);else for(var i=0;i<Game.intervals.length;i++)Game.intervals[i]==id&&(Game.intervals.splice(i,1),clearInterval(id))}},Game.clearTimeout=function(id,index){if(!runAfterPlay("clearTimeout",arguments)){checkArgs("clearTimeout",[id],["number"]);var tracker=trackItem("clearTimeout",{id:id,index:index});if(Game.timeouts)if(index)Game.timeouts.splice(index,1),clearTimeout(id);else for(var i=0;i<Game.timeouts.length;i++)Game.timeouts[i]==id&&(Game.timeouts.splice(i,1),clearTimeout(id))}},Game.clearIntervals=function(){if(Game.intervals){for(var i=0;i<Game.intervals.length;i++)clearInterval(Game.intervals[i]);Game.intervals=[]}},Game.clearTimeouts=function(){if(Game.timeouts){for(var i=0;i<Game.timeouts.length;i++)clearTimeout(Game.timeouts[i]);Game.timeouts=[]}},Game.clearTimerEvents=function(){Game.intervals&&Game.clearIntervals(),Game.timeouts&&Game.clearTimeouts()},Game.clearCharacters=function(){this.enemies&&this.enemies.forEach(function(e){e.remove()}),this.players&&this.players.forEach(function(e){e.image.remove()}),this.enemies=new ItemGroup,this.players=[]},Game.clearItems=function(){Game.items.removeAll(),Game.goodItems.removeAll(),Game.badItems.removeAll(),Game.obstacles.removeAll(),Game.items=new ItemGroup,Game.goodItems=new ItemGroup,Game.badItems=new ItemGroup,Game.obstacles=new ItemGroup},Game.soundOn=!0,Game.shuffle=function(o){for(var i=o.length,j,x;i;j=Math.floor(Math.random()*i),x=o[--i],o[i]=o[j],o[j]=x);return o},Game.Status=function(text,position,justify){checkArgs("Status",arguments,[["string","number"],["object","undefined"],["string","undefined"]]);var tracker=trackItem("Status",{text:text,position:position,justify:justify}),that={};return that._background=new Shape.Rectangle(new Point(0,0),new Point(5,5)),that._background.sendToBack(),that._background.fillColor="white",that._background.opacity=.2,that._margin=5,position=position||[Game.getBounds().width-that._margin,20],null!=position.x&&null!=position.y&&(position=[position.x,position.y]),that._text=new PointText({point:[position[0],position[1]],content:text,justification:justify||"right",fillColor:"black",fontFamily:"Courier New",fontWeight:"bold",fontSize:24}),Object.defineProperty(that,"content",{get:function(){return this._text.content},set:function(newValue){this._text.content=newValue;var pos=this._text.bounds.topLeft;this._background.bounds=new Rectangle(new Point(pos.x-this._margin,pos.y-this._margin),new Point(pos.x+this._margin+this._text.bounds.width,pos.y+this._margin+this._text.bounds.height))}}),Object.defineProperty(that,"position",{get:function(){return this._text.position}}),that.content=text,Object.defineProperty(that,"fontSize",{get:function(){return this._text.fontSize},set:function(newValue){this._text.fontSize=newValue;var pos=this._text.bounds.topLeft;this._background.bounds=new Rectangle(new Point(pos.x-this._margin,pos.y-this._margin),new Point(pos.x+this._margin+this._text.bounds.width,pos.y+this._margin+this._text.bounds.height))}}),that._itemTracker=tracker,that},Game.Table=function(r,c){checkArgs("Table",arguments,["number",["number","undefined"]]);for(var tracker=trackItem("Table",{row:r,col:c}),rows=r,cols=c||r,items=[],positions=[],labels=[],width=paper.view.bounds.width/rows,height=paper.view.bounds.height/cols,i=0;i<cols;i++)for(var j=0;j<rows;j++)items[i*cols+j]=null,positions[i*cols+j]=new Point(width/2+width*j,height/2+height*i);var drawGridLines=function(rows,cols,bounds){for(var i=0;i<=rows;i++){var xPos=bounds.left+i*width,topPoint=new paper.Point(xPos,bounds.top),bottomPoint=new paper.Point(xPos,bounds.bottom),aLine=new paper.Path.Line(topPoint,bottomPoint);aLine.strokeColor="black"}for(var i=0;i<=cols;i++){var yPos=bounds.top+i*height,leftPoint=new paper.Point(bounds.left,yPos),rightPoint=new paper.Point(bounds.right,yPos),aLine=new paper.Path.Line(leftPoint,rightPoint);aLine.strokeColor="black"}};drawGridLines(rows,cols,paper.view.bounds),this.get=function(row,column){return null==column&&row<items.length?items[row]:row*cols+column<items.length?items[row*cols+column]:null},this.set=function(item,row,column){if("string"==typeof item){var text=new PointText(new Point(0,0));text.justification="center",text.fillColor="black",text.content=item,text.fontSize=width/2,item=text}null==column&&row<items.length?(items[row]=item,items[row].position=positions[row]):row*cols+column<items.length&&(items[row*cols+column]=item,items[row*cols+column].position=positions[row*cols+column])},this.show=function(row,column){null==column&&row<items.length?items[row]&&(items[row].visible=!0):row*cols+column<items.length&&items[row*cols+column]&&(items[row*cols+column].visible=!0)},this.hide=function(row,column){null==column&&row<items.length?items[row]&&(items[row].visible=!1):row*cols+column<items.length&&items[row*cols+column]&&(items[row*cols+column].visible=!1)},this.shuffleItems=function(){for(var i=items.length,j,x;i;j=Math.floor(Math.random()*i),x=items[--i],items[i]=items[j],items[j]=x);;this.resetPositions()},this.resetPositions=function(){for(var i=0;i<items.length;i++)items[i].position=positions[i]},this.showLabels=function(){if(0<labels.length)for(var i=0;i<items.length;i++)labels[i].visible=!0;else for(var i=0;i<items.length;i++){var point=new Point(positions[i].x-width/3,positions[i].y-height/3),text=new PointText(point);text.justification="center",text.fillColor="black",text.content=i+1,text.fontSize=width/8,labels[i]=text}},this.hideLabels=function(){if(0<labels.length)for(var i=0;i<items.length;i++)labels[i].visible=!1}},Game.Timer=function(seconds,callback,position,justify){checkArgs("Timer",arguments,["number",["function","undefined","number","object"],["number","undefined","string","object"],["string","undefined"]]);var tracker=trackItem("Timer",{seconds:seconds,callback:callback,position:position,justify:justify});seconds=seconds||10,position=position||[5,20],"object"==typeof callback&&(justify=position,position=callback,callback=null),this.status=new Game.Status(" ",position,justify||"left"),this.limit=seconds,this.onTimeout=callback;var that=this;this.reset=function(){this.startTime=null,this.stopTime=null,this.update()},this.restart=function(){this.reset(),this.start(),this.update()},this.add=function(seconds){this.startTime+=1000*seconds,this.update()},this.stop=function(){this.stopTime=new Date().getTime()},this.setTime=function(seconds){this.limit=seconds},this.getTimeElapsed=function(){return this.startTime?(new Date().getTime()-this.startTime)/1000:0},this.getTimeRemaining=function(){var elapsed=this.startTime?(new Date().getTime()-this.startTime)/1000:0,remaining=Math.max(0,this.limit-elapsed).toFixed(1);return remaining},this.isRunning=function(){return!this.stopTime&&this.startTime},this.start=function(){this.startTime?this.stopTime&&0<this.getTimeRemaining()&&(this.startTime+=new Date().getTime()-this.stopTime,this.stopTime=null):this.startTime=new Date().getTime()},this.update=function(){var remaining=this.getTimeRemaining();4>remaining.length&&(remaining="0"+remaining),remaining!=that.last&&(that.last=remaining,that.status.content="Time: "+remaining,"00.0"==remaining&&(that.stop(),that.onTimeout&&that.onTimeout()))},this.update(seconds),paper.getView().attach("frame",function(e){that.isRunning()&&that.update()})},Game.Bar=function(seconds,w){checkArgs("Bar",arguments,["number",["number","undefined"]]);var tracker=trackItem("Bar",{seconds:seconds,width:w});this.width=w||200;var rect=new Rectangle([5,5],[this.width+5,30]);this.bar=new Shape.Rectangle(rect,8),this.bar.fillColor="#196E27",this.limit=seconds,this.stopTime=new Date().getTime();var that=this;this.startTime=null,this.stopTime=null,this.reset=function(){this.startTime=null,this.stopTime=null},this.restart=function(){this.reset(),this.start()},this.add=function(seconds){this.startTime+=1000*seconds,this.update()},this.stop=function(){this.stopTime=new Date().getTime()},this.isRunning=function(){return!this.stopTime&&this.startTime},this.start=function(){this.startTime?this.stopTime&&(this.startTime+=new Date().getTime()-this.stopTime,this.stopTime=null):this.startTime=new Date().getTime()},this.update=function(){var elapsed=this.startTime?(new Date().getTime()-this.startTime)/1000:0,remaining=Math.max(0,this.limit-elapsed).toFixed(1);0<remaining&&(this.bar.bounds.width=remaining/this.limit*this.width),0==remaining&&(that.stop(),that.onTimeout&&that.onTimeout())},Object.defineProperty(this,"visible",{get:function(){return this.bar.visible},set:function(newValue){this.bar.visible=newValue}}),this.update(seconds),paper.getView().attach("frame",function(e){that.isRunning()&&that.update()}),this._itemTracker=tracker},Game.Score=function(label,position,justify){checkArgs("Score",arguments,[["string","undefined"],["number","object","undefined"],["string","undefined"]]);var tracker=trackItem("Score",{label:label,position:position,justify:justify}),that={};return Game.scores||(Game.scores=[]),position=position||new Point(Game.getBounds().width-5,20+40*Game.scores.length),Game.scores.push(that),label=label||"Score",that.points=0,that.status=new Game.Status(" ",position,justify),that.add=function(points){this.set(this.points+(points||1))},that.reset=function(){this.set(0)},that.get=function(){return this.points},that.set=function(points){this.points=points||0,0>this.points&&(this.points=0),this.status.content=label+": "+(10>this.points?"0":"")+this.points},that.reset(),that._itemTracker=tracker,that},Game.Raster=function(x,y,image){checkArgs("Raster",arguments,["number","number","string"]);var tracker=trackItem("Raster",{x:x,y:y,source:image}),raster=new Raster(image,x,y);return raster._itemTracker=tracker,raster},Game.SQUARE_SIZE=50,Game.GRID_SQUARES=10,Game.setCursor=function(name,valueX,valueY){var tracker=trackItem("setCursor",{name:name,valueX:valueX,valueY:valueY});if(name&&!/^w+$/.test(name)){var center=valueX&&valueY?valueX+" "+valueY:"";name="url("+name+") "+center+", pointer"}paper.view.getElement().style.cursor=name},Game.getBounds=function(){return paper.view.bounds},Game.SpriteCache={};var directionsMap=["down","up","left","right"],directionsMap2=["left","right"];Game.Sprite=function(source,frameGap,aliveFrameCount,deadFrameCount,width,height,x,y){var tracker=trackItem("Sprite",{source:source,frameGap:frameGap,aliveFrameCount:aliveFrameCount,deadFrameCount:deadFrameCount,width:width,height:height,x:x,y:y});x=x||0,y=y||0,aliveFrameCount=aliveFrameCount||1;var frameCount;"number"==typeof aliveFrameCount&&(frameCount={up:aliveFrameCount,down:aliveFrameCount,left:aliveFrameCount,right:aliveFrameCount});var startFrame=0,isArray=Array.isArray(source),defaultSource,defaultScaling,sprite;if(isArray){function spriteImageLoaded(raster,directionIndex,index){var direction=dMap[directionIndex];sprite.data[direction]||(sprite.data[direction]=[]),sprite.data[direction][index]=raster.getImageData(),loadedCount++,loadedCount==count&&sprite.onLoad()}sprite={data:{}},defaultScaling=1;for(var count=0,loadedCount=0,dMap=2===source.length?directionsMap2:directionsMap,i=0;i<source.length;i++){Array.isArray(source[i])||(source[i]=[source[i]]);var c=source[i].length;count+=c,aliveFrameCount||(frameCount[dMap[i]]=c)}defaultSource=source[0][0],source.forEach(function(directionSource,direction){directionSource.forEach(function(src,index){var image=new Raster(src,-2000,-2000);image.onLoad=function(){spriteImageLoaded(this,direction,index)}})})}else{defaultScaling=.6;var sprite=new Raster(source,-2000,-2000);sprite.visible=!1,sprite.pos={down:new Point(0,0*height),up:new Point(0,1*height),left:new Point(0,2*height),right:new Point(0,3*height)},Game.SpriteCache[source]||(Game.SpriteCache[source]={}),sprite.data=Game.SpriteCache[source]}sprite.counter=0,sprite.frame=0,sprite.direction=null;var image=new Raster(defaultSource,x,y);return image.visible=!0,image.size=new Size(width,height),sprite.onLoad=function(){image.loaded||(image.loaded=!0,!image.scaled&&(image.scaling=new Point(defaultScaling,defaultScaling)),image.setSprite=function(direction,onIce){if(direction&&isArray&&!sprite.data[direction]&&(direction=sprite.direction),sprite.direction==direction){if(onIce)return;if(sprite.counter=(sprite.counter+1)%frameGap,0<sprite.counter)return;var fc;if("number"!=typeof frameCount)fc=frameCount[direction];else if(fc=frameCount,0==fc)return;if(sprite.frame=(sprite.frame+1)%fc,!sprite.data[direction][sprite.frame+startFrame]){var pos=sprite.pos[direction];sprite.data[direction][sprite.frame+startFrame]=sprite.getImageData(new Rectangle(new Point(pos.x+image.width*(sprite.frame+startFrame),pos.y),image.size))}return void image.setImageData(sprite.data[direction][sprite.frame+startFrame])}if(!direction){if(direction=sprite.direction,0==sprite.frame)return;sprite.frame=0}var resetFrame=!0;sprite.data[direction]||(sprite.data[direction]=[sprite.getImageData(new Rectangle(sprite.pos[direction],image.size))]),image.setImageData(sprite.data[direction][0]),sprite.direction=direction,sprite.frame=0},image.setSprite(INITIAL_SPRITE_DIRECTION))},image.getHitBounds=function(){var img=this,p=img.position;return img.hitBounds||(img.hitSize=new Size(35,45),img.hitBounds=new Rectangle(new Point(0,0),img.hitSize)),img.hitBounds.x=p.x-img.hitSize.width/1.5,img.hitBounds.y=p.y-img.hitSize.height/2.5,img.hitBounds},image.setDead=function(){"number"!=typeof frameCount&&(startFrame=frameCount[sprite.direction],frameCount=deadFrameCount||0)},image.setFrames=function(start,count){startFrame=start,frameCount=count},image.sprite=sprite,image._itemTracker=tracker,image},Game.Bullet=function(x,y,params,path,power){var tracker=trackItem("Bullet",{params:params,x:x,y:y,path:path,power:power}),source=params.source||params,bullet=new Raster(source,x,y),canKill=!1;return params.scaling?bullet.scaling=params.scaling:!/\/image\/game\/bullet/.test(source)&&scaleItem(bullet,Game.OBJECT_SIZE/2),bullet.rotation=path.angle+(params.startingRotation||0),bullet.onFrame=function(){if(this.position.x+=path.x,this.position.y+=path.y,(-50>this.position.x||-50>this.position.y||this.position.x>Game.getBounds().width+50||this.position.y>Game.getBounds().height+50)&&this.remove(),Game.goodItems){var result=Game.goodItems.hitTest(this.position);result&&null!=result.item.health&&(result.item.health-=power,0>=result.item.health&&(result.item.onDestroy(),Game.goodItems.remove(result.item)),this.remove())}if(Game.badItems){var result=Game.badItems.hitTest(this.position);result&&null!=result.item.health&&(result.item.health-=power,0>=result.item.health&&(result.item.onDestroy(),Game.badItems.remove(result.item)),this.remove())}if(Game.obstacles){var result=Game.obstacles.hitTest(this.position);result&&null!=result.item.health?(result.item.health-=power,0>=result.item.health&&(result.item.onDestroy(),Game.obstacles.remove(result.item)),this.remove()):result&&result.item.visible&&this.remove()}if(!canKill&&50<this.position.subtract(new Point(x,y)).length&&(canKill=!0),Game.enemies){var result=Game.enemies.hitTest(this.position);result&&canKill&&(result.item.health-=power,this.remove(),0>=result.item.health&&Game.enemies.remove(result.item))}var resultPlayer;Game.players.forEach(function(e,i,a){e.image.getBounds().contains(bullet.position)&&e.alive&&(resultPlayer={item:e})}),resultPlayer&&canKill&&(Game.damagePlayer(resultPlayer.item,power),this.remove())},bullet._itemTracker=tracker,bullet},Game.damagePlayer=function(player,power){player.health-=power,player.onTakeDamage&&player.onTakeDamage(),0>=player.health&&player.kill()},Game.Gun=function(){var tracker=trackItem("Gun",{}),center=new Point(0,0);this.positions=[center,center,center,center,center,center,center,center];var bulletSpeed=Game.Gun.bulletSpeed,paths=[new Point(0,-bulletSpeed),new Point(bulletSpeed,-bulletSpeed).normalize(bulletSpeed),new Point(bulletSpeed,0),new Point(bulletSpeed,bulletSpeed).normalize(bulletSpeed),new Point(0,bulletSpeed),new Point(-bulletSpeed,bulletSpeed).normalize(bulletSpeed),new Point(-bulletSpeed,0),new Point(-bulletSpeed,-bulletSpeed).normalize(bulletSpeed)];this.UP=0,this.RIGHT_UP=1,this.RIGHT=2,this.RIGHT_DOWN=3,this.DOWN=4,this.LEFT_DOWN=5,this.LEFT=6,this.LEFT_UP=7,addDefaultProperties(this,Game.Gun),this.onlyDirection;var canFire=!0,that=this,owner;this.setPositions=function(pos){Array.isArray(pos)?1==pos.length?that.positions=[pos[0],pos[0],pos[0],pos[0],pos[0],pos[0],pos[0],pos[0]]:4==pos.length?that.positions=[pos[0],pos[1],pos[1],pos[1],pos[2],pos[3],pos[3],pos[3]]:8==pos.length&&(that.positions=pos):that.positions=[pos,pos,pos,pos,pos,pos,pos,pos]},this.fire=function(bounds,direction){if("string"==typeof direction&&(direction=that[direction]||0),direction=isNaN(that.onlyDirection)?direction:that.onlyDirection,canFire){that.onFire(),Game.playSound(that.fireSound.src,{volume:that.fireVolume}),canFire=!1,setTimeout(function(){canFire=!0},1000/that.fireSpeed);var sPoint=bounds.center.add(that.positions[direction]);new Game.Bullet(sPoint.x,sPoint.y,that.bullet,paths[direction],that.power)}}},Game.Gun.bulletSpeed=6,Game.Gun.bullet={source:"/image/game/bullet.png"},Game.Gun.fireSound=new Audio("/audio/game/gun1.mp3"),Game.Gun.fireVolume=0.2,Game.Gun.fireSpeed=3,Game.Gun.power=1,Game.Gun.onFire=function(){},Game.ICE_BACKGROUND_RE=/^\s*([\\/]\.)*[\\/]image[\\/]+game[\\/]+tile[\\/]+3\.png\s*(\.+|[#?].*|$)/i,Game.PLAYER_SPRITE_RE=/^\s*([\\/]\.)*[\\/]image(?:s[\\/]+players[\\/]\w+|[\\/]+game[\\/]+player\d+[a-z]?)\.png\s*(\.+|[#?].*|$)/i;var INITIAL_SPRITE_DIRECTION="right";Game.Avatar=Game.Player=function(xPos,yPos,source,up,left,down,right){checkArgs("Player",arguments,[["number","undefined"],["number","undefined"],["string","undefined"],["string","undefined"],["string","undefined"],["string","undefined"],["string","undefined"]]);var tracker=trackItem("Player",{x:xPos,y:yPos,source:source,up:up,left:left,down:down,right:right}),dieFrameCount=32,that=createCharacter(arguments,"Player");Game.players.push(that),that.index=Game.players.length-1,that.startTime=new Date().getTime(),that.speed=2,that.score=0,that.alive=!0;var explosionSound=new Audio("/audio/game/explosion2.mp3");explosionSound.volume=0.4,that.killedSound=Game.Player.killedSound||explosionSound,that.facingRight=!0,that.health=1,that.startingRotation=0;var x=xPos,y=yPos;null==x&&(x=that.radius),null==y&&(y=that.radius),ai.data.set("playerImage"+Game.players.length,source),that.upKey=up||"up",that.rightKey=right||"right",that.downKey=down||"down",that.leftKey=left||"left",that.fireKey="space";var direction=new Point(-2,0),fireDirection="down",isSprite=!1,slideDirection,spriteDirection;that.setGun=function(gun,fireKey){that.gun=gun,fireKey&&(that.fireKey=fireKey)},that.onFrame,source=source||"/image/game/player1.png","string"==typeof source&&source.trim(),Array.isArray(source)?(that.image=new Game.Sprite(source,5,null,null,null,null,x,y),isSprite=!0):"object"==typeof source?(that.image=source,that.image.position.x=x,that.image.position.y=y,isSprite=!0):Game.PLAYER_SPRITE_RE.test(source)?(that.image=new Game.Sprite(source,5,7,4,150,117,x,y),isSprite=!0):(that.image=new Raster(source,x,y),that.image.getHitBounds=function(){return this.getBounds()},that.rotateImage=!!source.match(/(tank|robot\d?a?|car|player|enemy|craft1)\./i),scaleItem(that.image,50));var SPRITE_SIZE=64,lastCount=0,lastSec=0,count=0,start=new Date().getTime(),gunRotations={0:"DOWN",45:"LEFT_DOWN",90:"LEFT",135:"LEFT_UP",180:"UP",225:"RIGHT_UP",270:"RIGHT",315:"RIGHT_DOWN",360:"DOWN","-135":"RIGHT_UP","-45":"RIGHT_DOWN"},directionsPressed,r1,r2;that.getFireDirection=function(){if(fireDirection)return fireDirection.toUpperCase();var rot=Math.round(this.image.rotation-this.startingRotation);return gunRotations[normalizeRotation(rot)]};var playerDirectionRotation={left:90,up:180,right:270,down:360},setPlayerDirection=function(player,direction){"string"==typeof player&&(direction=player,player=this.image);var playerRotation=playerDirectionRotation[direction];that.rotateImage?r1?r2=playerRotation:r1=playerRotation:spriteDirection=direction,directionsPressed++,that.rotateImage||player.sprite||("right"!=direction||that.facingRight?"left"==direction&&that.facingRight&&(player.scale(-1,1),that.facingRight=!1):(player.scale(-1,1),that.facingRight=!0))};return that.setDirection=setPlayerDirection,that.kill=function(){that.alive=!1,that.onKilled(),Game.playSound(that.killedSound)},that.onKilled=function(){},that.image.onFrame=function(event){if(Game.itemsLoaded()&&!Game.gameOver){if(directionsPressed=0,!that.alive)return this.visible?(this.dyingFrame===dieFrameCount&&(that.onKilled(),this.visible=!1,this.sprite&&(this.sprite.visible=!1)),this.setDead?(this.setDead(),this.setSprite(spriteDirection||INITIAL_SPRITE_DIRECTION)):this.opacity-=0.02,void(this.dyingFrame=(this.dyingFrame||0)+1)):void 0;if(this.loaded){r1=null,r2=null;var xi=this.position.x||x,yi=this.position.y||y,ri=this.rotation,bounds=this.getHitBounds(),onIce="ice"==Game.backgroundSurface;if(that.onFrame?that.onFrame():onIce?slideDirection?"up"==slideDirection?0>=bounds.top?slideDirection=null:this.position.y-=that.speed:"down"==slideDirection?bounds.bottom>=Game.getBounds().height?slideDirection=null:this.position.y+=that.speed:"right"==slideDirection?bounds.right>=Game.getBounds().width?slideDirection=null:this.position.x+=that.speed:"left"==slideDirection&&(0>=bounds.left?slideDirection=null:this.position.x-=that.speed):Key.isDown(that.upKey)&&0<bounds.top?(slideDirection="up",this.position.y-=that.speed,setPlayerDirection(this,"up")):Key.isDown(that.downKey)&&bounds.bottom<Game.getBounds().height?(slideDirection="down",this.position.y+=that.speed,setPlayerDirection(this,"down")):Key.isDown(that.rightKey)&&bounds.right<Game.getBounds().width?(slideDirection="right",this.position.x+=that.speed,setPlayerDirection(this,"right")):Key.isDown(that.leftKey)&&0<bounds.left&&(slideDirection="left",this.position.x-=that.speed,setPlayerDirection(this,"left")):(spriteDirection="",Key.isDown(that.upKey)&&0<bounds.top&&(this.position.y-=that.speed,setPlayerDirection(this,"up")),Key.isDown(that.downKey)&&bounds.bottom<Game.getBounds().height&&(this.position.y+=that.speed,setPlayerDirection(this,"down")),Key.isDown(that.rightKey)&&bounds.right<Game.getBounds().width&&(this.position.x+=that.speed,setPlayerDirection(this,"right")),Key.isDown(that.leftKey)&&0<bounds.left&&(this.position.x-=that.speed,setPlayerDirection(this,"left"))),r1){if(r2){var r3=r1>r2?r1-r2:r2-r1;this.rotation=90==r3?(r1+r2)/2:270==r3?45:r1}else that.rotateImage&&(this.rotation=r1);this.rotation+=that.startingRotation}if(1<directionsPressed&&(this.position.x-=0.3*(this.position.x-xi),this.position.y-=0.3*(this.position.y-yi)),spriteDirection&&(fireDirection=spriteDirection),that.gun&&Key.isDown(that.fireKey))if(that.rotateImage){var rot=Math.round(this.rotation-that.startingRotation);that.gun.fire(bounds,that.gun[gunRotations[normalizeRotation(rot)]])}else fireDirection&&that.gun.fire(bounds,that.gun[fireDirection.toUpperCase()]);var hitBounds=this.getHitBounds(),rotation=this.rotation%90;that.teleported&&!that.teleported.hitTest(hitBounds.center)&&(that.teleported=null);var hitObstacle;if(Game.obstacles)var hitObstacle=Game.obstacles.checkCollision(hitBounds,rotation);if(hitObstacle&&hitObstacle.item.moveable){if(this.position.y==yi){var oxi=hitObstacle.item.position.x;this.position.x>xi?hitObstacle.item.position.x+=that.speed:this.position.x<xi&&(hitObstacle.item.position.x-=that.speed),(Game.obstacles.checkCollision(hitObstacle.item.bounds,rotation,hitObstacle.item)||!boundsOnScreen(hitObstacle.item.bounds,Game.getBounds().width,Game.getBounds().height)||Game.obstacles.checkCollision(this.getHitBounds(),rotation,hitObstacle.item))&&(this.position.x=xi,this.position.y=yi,hitObstacle.item.position.x=oxi)}else if(this.position.x==xi){var oyi=hitObstacle.item.position.y;this.position.y>yi?hitObstacle.item.position.y+=that.speed:this.position.y<yi&&(hitObstacle.item.position.y-=that.speed),(Game.obstacles.checkCollision(hitObstacle.item.bounds,rotation,hitObstacle.item)||!boundsOnScreen(hitObstacle.item.bounds,Game.getBounds().width,Game.getBounds().height)||Game.obstacles.checkCollision(this.getHitBounds(),rotation,hitObstacle.item))&&(this.position.x=xi,this.position.y=yi,hitObstacle.item.position.y=oyi)}else{var yn=this.position.y;this.position.y=yi,(this.position.x==xi||Game.obstacles.checkCollision(this.getHitBounds(),rotation))&&(this.position.x=xi,this.position.y=yn,(this.position.y==yi||Game.obstacles.checkCollision(this.getHitBounds(),rotation))&&(this.position.y=yi,this.rotation=ri,slideDirection=null))}}else if(hitObstacle){var yn=this.position.y;this.position.y=yi,(this.position.x==xi||Game.obstacles.checkCollision(this.getHitBounds(),rotation))&&(this.position.x=xi,this.position.y=yn,(this.position.y==yi||Game.obstacles.checkCollision(this.getHitBounds(),rotation))&&(this.position.y=yi,this.rotation=ri,slideDirection=null)),that.health-=hitObstacle.item.power,0>=that.health&&that.kill()}if(Game.checkPlayerCollision(that)){var yn=this.position.y;this.position.y=yi,(this.position.x==xi||Game.checkPlayerCollision(that))&&(this.position.x=xi,this.position.y=yn,(this.position.y==yi||Game.checkPlayerCollision(that))&&(this.position.y=yi,this.rotation=ri,slideDirection=null))}if(Game.goodItems){var result=Game.goodItems.hitTest(this.position,10);if(result){Game.playSound(result.item.hitSound),Game.goodItems.totalCollectedValue+=result.item.value,Game.goodItems.remove(result.item),that.score+=result.item.value;var scoreStatus=Game.getScores()[that.index];scoreStatus&&result.item.value&&scoreStatus.add(result.item.value),result.item.onCollect(that),that.health-=result.item.power,0>=that.health&&that.kill()}}if(Game.badItems){var result=Game.badItems.checkCollision(hitBounds,rotation);result&&(Game.playSound(result.item.hitSound),result.item.onDestroy(),Game.badItems.remove(result.item),that.health-=result.item.power,0>=that.health&&that.kill())}this.sprite&&(spriteDirection?this.setSprite(spriteDirection,onIce):this.setSprite()),hitBounds=this.getHitBounds();var ch=paper.project.activeLayer.children,lastAbove=0,j=this._index;if(0<=j-1&&!ch[j-1].position.y<=hitBounds.bottom||j+1<ch.length&&!ch[j+1].position.y>hitBounds.bottom){for(var i=0;i<ch.length&&!(ch[i].position&&ch[i].position.y>hitBounds.bottom);i++)lastAbove=i;this.moveAbove(ch[lastAbove])}}}},that._itemTracker=tracker,that},Game.getScores=function(){return Game.scores||(Game.scores=[]),Game.scores},Game.checkEnemyCollision=function(enemy){for(var i=0,it;i<Game.enemies.items.length;i++)if(it=Game.enemies.items[i],!1!==it.visible&&it!==enemy){var r1=enemy.getBounds(),r2=it.getBounds();if(35>Math.abs(r1.x-r2.x)&&35>Math.abs(r1.y-r2.y))return{item:it}}},Game.checkPlayerCollision=function(player){for(var i=0,it;i<Game.players.length;i++)if(it=Game.players[i],!1!==it.alive&&it!==player){var r1=player.image.getHitBounds(),r2=it.image.getHitBounds(),wDiff=r1.x>r2.x?r2.width:r1.width,hDiff=r1.y>r2.y?r2.height:r1.height;if(Math.abs(r1.x-r2.x)<wDiff&&Math.abs(r1.y-r2.y)<hDiff)return{item:it}}},Game.noLivePlayer=function(){for(var i=0;i<Game.players.length;i++)if(Game.players[i].alive)return!1;return!0},Game.Enemy=function(xPos,yPos,source){checkArgs("Enemy",arguments,[["number","undefined"],["number","undefined"],["string","undefined"]]);var tracker=trackItem("Enemy",{x:xPos,y:yPos,source:source}),that=createCharacter(arguments,"Enemy");Game.enemies.push(that);var enemyNo=Game.enemies.length-1;that.speed=1.5,that.health=1,that.lastPos,that.tempTarget,that.autoSortDepth=!0,that.power=1,that.playerNo=0==Game.players.length?null:enemyNo%Game.players.length,that.getPlayer=function(){return Game.players[that.playerNo]};var x=xPos||Game.getBounds().width-that.radius,y=yPos||Game.getBounds().height-that.radius;source=source||Game.Enemy.source,Game.PLAYER_SPRITE_RE.test(source)?that.image=new Game.Sprite(source,7,7,4,150,117,x,y):(that.image=new Raster(source,x,y),that.image.getHitBounds=function(){return this.getBounds()},scaleItem(that.image,50)),that.getBounds=function(){return that.image.getBounds()},that.onKilled=function(){},that.remove=function(){that.onKilled(),that.image.remove()},that.gunAI=function(direction){if(that.gun){var bounds=that.getBounds();"left"==direction&&that.gun.fire(bounds,that.gun.LEFT),"right"==direction&&that.gun.fire(bounds,that.gun.RIGHT),"up"==direction&&that.gun.fire(bounds,that.gun.UP),"down"==direction&&that.gun.fire(bounds,that.gun.DOWN)}};var getNextPathTarget=function(enemy){enemy.movePath.closed?enemy.segmentNumber==enemy.movePath.segments.length-1?enemy.segmentNumber=0:enemy.segmentNumber++:enemy.reversePath?0==enemy.segmentNumber?(enemy.segmentNumber++,enemy.reversePath=!1):enemy.segmentNumber--:enemy.segmentNumber==enemy.movePath.segments.length-1?(enemy.segmentNumber--,enemy.reversePath=!0):enemy.segmentNumber++};return that.image.move=function(){if(0==that.speed)return null;var direction=null,THRESHOLD=2,hitBounds,target;if(that.tempTarget)target=that.tempTarget;else if(that.movePath)target=that.movePath.segments[that.segmentNumber].point;else if(null!=that.playerNo)target=that.getPlayer().image.position;else{for(var tempX=0,tempY=0;1>tempX||tempX+1>Game.getBounds().width;)tempX=Game.randomInt(75,1500,!0)+this.position.x;for(;1>tempY||tempY+1>Game.getBounds().height;)tempY=Game.randomInt(75,150,!0)+this.position.y;that.tempTarget=new Point(tempX,tempY),target=that.tempTarget}var deltaX=target.x-this.position.x,deltaY=target.y-this.position.y,absX=Math.abs(deltaX),absY=Math.abs(deltaY);if(deltaX=absX<THRESHOLD?0:10*(deltaX/Math.abs(absX)),deltaY=absY<THRESHOLD?0:10*(deltaY/Math.abs(absY)),deltaX&&deltaY){var speed=new Point(deltaX,deltaY).normalize(that.speed);if(this.position.x+=speed.x,this.position.y+=speed.y,hitBounds=this.getHitBounds(),!Game.obstacles.checkCollision(hitBounds)&&!Game.badItems.checkCollision(hitBounds)&&!Game.checkEnemyCollision(that))return 0<deltaX?"right":"left";this.position.x-=speed.x,this.position.y-=speed.y}if(deltaX){var speed=new Point(deltaX,0).normalize(that.speed);if(this.position.x+=speed.x,hitBounds=this.getHitBounds(),!Game.obstacles.checkCollision(hitBounds)&&!Game.badItems.checkCollision(hitBounds)&&!Game.checkEnemyCollision(that))return 0<deltaX?"right":"left";this.position.x-=speed.x}if(deltaY){var speed=new Point(0,deltaY).normalize(that.speed);if(this.position.y+=speed.y,hitBounds=this.getHitBounds(),!Game.obstacles.checkCollision(hitBounds)&&!Game.badItems.checkCollision(hitBounds)&&!Game.checkEnemyCollision(that))return 0<deltaY?"down":"up";this.position.y-=speed.y}return null},that.image.onFrame=function(event){if(Game.itemsLoaded()&&this.loaded){if(that.getPlayer()&&!that.getPlayer().alive){var closestDistance=-1,closestPlayerNo=null;if(Game.noLivePlayer())that.playerNo=null;else for(var i=0,player;i<Game.players.length;i++)if(player=Game.players[i],player.alive){var d=Math.abs(this.position.subtract(player.image.position).length);(!closestPlayerNo||d<closestDistance)&&(closestDistance=d,closestPlayerNo=i)}null!=closestPlayerNo&&(that.playerNo=closestPlayerNo)}that.lastPos=that.image.position;var direction=this.move();if(that.gunAI(direction),that.lastPos.x==that.image.position.x&&that.lastPos.y==that.image.position.y)if(that.movePath)getNextPathTarget(that);else{for(var tempX=parseInt(301*Math.random()-150)+this.position.x;1>tempX||tempX+1>Game.getBounds().width;)tempX=parseInt(401*Math.random()-200)+this.position.x;for(var tempY=parseInt(301*Math.random()-150)+this.position.y;1>tempY||tempY+1>Game.getBounds().height;)tempY=parseInt(401*Math.random()-200)+this.position.y;that.tempTarget=new Point(tempX,tempY)}if(that.tempTarget&&this.hitTest(that.tempTarget)?that.tempTarget=null:that.movePath&&this.hitTest(that.movePath.segments[that.segmentNumber].point)&&getNextPathTarget(that),Game.players.forEach(function(e){e.image.bounds.x&&e.alive&&that.image.hitTest(e.image.position)&&Game.damagePlayer(e,that.power)}),this.sprite&&this.setSprite(direction),that.autoSortDepth){hitBounds=this.getHitBounds();var ch=paper.project.activeLayer.children,lastAbove=0,j=this._index;if(0<=j-1&&!ch[j-1].position.y<=hitBounds.bottom||j+1<ch.length&&!ch[j+1].position.y>hitBounds.bottom){for(var i=0;i<ch.length&&!(!ch[i]._bgimage&&ch[i].position&&ch[i].position.y>hitBounds.bottom);i++)lastAbove=i;this.moveAbove(ch[lastAbove])}}}},that.setPath=function(path){that.movePath=path,that.segmentNumber=0,that.reversePath=!1},that._itemTracker=tracker,that},Game.Enemy.source="/image/game/player2.png",Game.backgroundSurface,Game.getBackgroundImage=function(){return this._backgroundImage||{}};;Game.setBackgroundColor=function(color){var tracker=trackItem("setBackgroundColor",{color:color}),canvasElement=paper.view.getElement();canvasElement.classList.toggle("hasBackgroundColor",!!color);var canvasStyle=canvasElement.style;if("object"==typeof color){var c=color.components;color="rgb("+Math.floor(255*c[0])+","+Math.floor(255*c[1])+","+Math.floor(255*c[2])+")"}canvasStyle.backgroundColor=color},Game.getBackgroundColor=function(){return paper.view.getElement().style.backgroundColor},Game.SCROLL_SPEED=2,Game.setScrollingBackground=function(source,speed,canFlip){checkArgs("setScrollingBackground",arguments,["string",["number","undefined"],["boolean","undefined"]]);var tracker=trackItem("setScrollingBackground",{source:source,speed:speed,canFlip:canFlip});speed=null==speed?Game.SCROLL_SPEED:speed;var bg1=new Raster(source,Game.getBounds().width/2,Game.getBounds().height/2),bg2=new Raster(source,Game.getBounds().width/2,Game.getBounds().height/2);bg1._bgimage=!0,bg2._bgimage=!0,bg1.onLoad=function(){this.width=Game.getBounds().width,this.position.y=this.height/2},sortOnLoad(bg1),bg2.onLoad=function(){this.width=Game.getBounds().width,this.position.y=-(this.height/2),canFlip&&(this.scaling=new Point(1,-1))},sortOnLoad(bg2),bg1.onFrame=function(){this.position.y+=speed,this.sendToBack(),bg2.position.y+=speed,bg2.sendToBack(),this.bounds.top>Game.getBounds().height&&(this.position.y=bg2.position.y-this.height),bg2.bounds.top>Game.getBounds().height&&(bg2.position.y=bg1.position.y-bg2.height)}},Game.setBackgroundImage=setBackgroundImage,Game.BackgroundImage=function(source,size){checkArgs("BackgroundImage",arguments,["string",["number","undefined","boolean","string"]]);var tracker=trackItem("setBackgroundImage",{source:source,size:size});setBackgroundImage(source,size)},Game.hasScoreboard=function(){return this._hasScoreboard},Game.Scoreboard=function(){var tracker=trackItem("Scoreboard",{});Game._hasScoreboard=!0,Game.gameOver=!1,this.path=new Path;var height=100,width=200,xpos=paper.view.bounds.width/2,ypos=paper.view.bounds.height/2;this.path.onFrame=function(event){if(!Game.gameOver){if(0<Game.goodItems.getLength())for(var i=0;i<Game.players.length;i++)if(Game.players[i].alive)return;var box=new Path.Rectangle(xpos-width/2,ypos-height/2,width,height);box.fillColor="black",box.opacity=0.8;var text=new PointText(new Point(xpos,ypos));if(text.justification="center",text.fillColor="white",text.opacity=0.8,text.fontSize=16,1==Game.players.length)text.content="Your score: "+Game.players[0].score;else{var scores="";Game.players.forEach(function(p,i){scores&&(scores+="\n"),scores+="Player "+(i+1)+" score: "+p.score}),text.content=scores}Game.enemies&&Game.enemies.forEach(function(e){e.image.remove()}),Game.gameOver=!0}}},Game.itemLoadCount=0,Game.runOnFrameFunctions=!1,Game.itemsLoaded=function(){return!!Game.runOnFrameFunctions||0==Game.itemLoadCount&&(Game.runOnFrameFunctions=!0,!0)},ItemGroup.prototype.hitTest=function(p,t){t=t||0;for(var i=0,r;i<this.items.length;i++)if(r=this.items[i].getBounds(),p.x+t>=r.x&&p.x-t<=r.x+r.width&&p.y+t>=r.y&&p.y-t<=r.y+r.height)return{item:this.items[i]};return null},ItemGroup.prototype.checkCollision=function(r1,angle,item){var t=5;if(!r1||null==r1.topLeft)return!1;try{for(var i=0,it;i<this.items.length;i++)if(it=this.items[i],!1!==it.visible&&it!==item){var r2=it.getBounds();if(r1.x+r1.width>=r2.x+t&&r1.x+t<=r2.x+r2.width&&r1.y+r1.height>=r2.y+t&&r1.y+t<=r2.y+r2.height)return{item:it}}}catch(err){if(err.message+"Cannot read property 'x' of null")throw ai.m.gameImageUrlError}return!1},Game.OBJECT_SIZE=40,Game.Moveable=function(x,y,image){checkArgs("Moveable",arguments,[["number","undefined"],["number","undefined"],["string","undefined"]]);var tracker=trackItem("Moveable",{x:x,y:y,source:image,image:image}),source=image||Game.Moveable.source,obs=new Game.Obstacle(x,y,source);return obs.moveable=!0,obs},Game.Moveable.source="/image/game/obstacle/1.png",Game.createStaticItemLines=function(name,defaultImage,path,source,mouseDown,mouseDrag){for(var objectSize=Game[name].size||Game.OBJECT_SIZE,obstacles=[],MAX_LINE_LENGTH=100,i=0;i+1<path.segments.length;i++){var p1=path.segments[i].point,p2=path.segments[i+1].point,xDiff=Math.abs(p1.x-p2.x),yDiff=Math.abs(p1.y-p2.y);if(xDiff>yDiff)for(var xStep=p1.x<p2.x?objectSize:-objectSize,count=Math.floor(xDiff/objectSize),yStep=p1.y<p2.y?yDiff/count:-yDiff/count,xPos=p1.x+xStep,yPos=p1.y+yStep,j=0;j<count&&j<MAX_LINE_LENGTH;j++)obstacles.push(new Game[name](xPos,yPos,source,mouseDown,mouseDrag)),xPos+=xStep,yPos+=yStep;else for(var yStep=p1.y<p2.y?objectSize:-objectSize,count=Math.floor(yDiff/objectSize),xStep=p1.x<p2.x?xDiff/count:-xDiff/count,xPos=p1.x+xStep,yPos=p1.y+yStep,j=0;j<count&&j<MAX_LINE_LENGTH;j++)obstacles.push(new Game[name](xPos,yPos,source,mouseDown,mouseDrag)),xPos+=xStep,yPos+=yStep}return obstacles};var itemMap;trackReset(),Game.getItemMap=function(){return itemMap};var defaultHitSounds={food:"/audio/game/bite.mp3"},STATIC_ITEM_ARGS=[["object","number","undefined"],["string","number","undefined"],["string","object","undefined"],["function","undefined"],["function","undefined"]];Game.Item=function(x,y,source,mouseDown,mouseDrag){return checkArgs("Item",arguments,STATIC_ITEM_ARGS),item=new StaticItem("Item",Game.Item.source,x,y,source,mouseDown,mouseDrag)},Game.Item.source="/image/game/obstacle/9.png",Game.GoodItem=function(x,y,source,mouseDown,mouseDrag){checkArgs("GoodItem",arguments,STATIC_ITEM_ARGS);var item=new StaticItem("GoodItem",Game.GoodItem.source,x,y,source,mouseDown,mouseDrag);return addDefaultProperties(item,Game.GoodItem),item},Game.GoodItem.onCollect=function(){},Game.GoodItem.onDestroy=function(){},Game.GoodItem.source="/image/game/goodItem/1.png",Game.GoodItem.power=0,Game.GoodItem.value=1,Game.GoodItem.speed=0,Game.BadItem=function(x,y,source,mouseDown,mouseDrag){checkArgs("BadItem",arguments,STATIC_ITEM_ARGS);var item=new StaticItem("BadItem",Game.BadItem.source,x,y,source,mouseDown,mouseDrag);return addDefaultProperties(item,Game.BadItem),item},Game.BadItem.onDestroy=function(){},Game.BadItem.source="/image/game/badItem/1.png",Game.BadItem.power=1,Game.BadItem.health=1,Game.BadItem.speed=0,Game.Obstacle=function(x,y,source,mouseDown,mouseDrag){if(checkArgs("Obstacle",arguments,[["number","object","undefined"],["number","string","undefined"],["string","undefined","number","object"],["function","number","undefined"],["function","number","undefined"]]),"number"==typeof source&&"number"==typeof mouseDown){if(trackItem("Obstacle",{x:x,y:y,width:source,height:mouseDown,type:mouseDrag}),230400<source*mouseDown)throw"The obstacle you are trying to draw is too big";if(7==mouseDrag)for(var j=y+mouseDown;j>y;j-=48)for(var i=0;i<source;i+=48)new StaticItem("Obstacle","/image/game/obstacle/tile/"+mouseDrag+"a.png",x+i+24,j-24,null,null,null,!0);else if("number"!=typeof mouseDrag)for(var j=y+mouseDown;j>y;j-=48)for(var i=0;i<source;i+=48)new StaticItem("Obstacle",mouseDrag,x+i+24,j-24,null,null,null,!0);else{for(var j=y+mouseDown,i=0;i<source;i+=144)new StaticItem("Obstacle","/image/game/obstacle/tile/"+mouseDrag+"a.png",x+i+24,j-24,null,null,null,!0),new StaticItem("Obstacle","/image/game/obstacle/tile/"+mouseDrag+"b.png",x+i+72,j-24,null,null,null,!0),new StaticItem("Obstacle","/image/game/obstacle/tile/"+mouseDrag+"c.png",x+i+120,j-24,null,null,null,!0);for(var j=y+mouseDown-48;j>y;j-=48)for(var i=0;i<source;i+=144)new StaticItem("Obstacle","/image/game/obstacle/tile/"+mouseDrag+"d.png",x+i+24,j-24,null,null,null,!0),new StaticItem("Obstacle","/image/game/obstacle/tile/"+mouseDrag+"e.png",x+i+72,j-24,null,null,null,!0),new StaticItem("Obstacle","/image/game/obstacle/tile/"+mouseDrag+"f.png",x+i+120,j-24,null,null,null,!0)}}else{var obs=new StaticItem("Obstacle",Game.Obstacle.source,x,y,source,mouseDown,mouseDrag);return addDefaultProperties(obs,Game.Obstacle),obs}},Game.Obstacle.onDestroy=function(){},Game.Obstacle.source="/image/game/obstacle/1.png",Game.Obstacle.power=0;var PLAYER_STAMP="tankSouth.png",PLAYER_STAMP_FULL="/image/game/tankSouth.png";Game.createItem=function(point,stampImage,removeItem,dragItem){if(stampImage==PLAYER_STAMP){Game.players||(Game.players=[]),2<=Game.players.length&&(Game.players[0].kill(),Game.players.splice(0,1));var p=new Game.Player(point.x,point.y,PLAYER_STAMP_FULL);p.image.onMouseDown=removeItem,p.image.onMouseDrag=dragItem,Game.players[0].upKey="up",Game.players[0].rightKey="right",Game.players[0].downKey="down",Game.players[0].leftKey="left",2==Game.players.length&&(Game.players[1].upKey="w",Game.players[1].rightKey="d",Game.players[1].downKey="s",Game.players[1].leftKey="a")}else if("enemy.png"==stampImage){var enemy=new Game.Enemy(point.x,point.y,"/image/game/enemy.png");enemy.image.onMouseDown=removeItem,enemy.image.onMouseDrag=dragItem}else"goodItem/1.png"==stampImage?new Game.GoodItem(point.x,point.y,null,removeItem,dragItem):"badItem/1.png"==stampImage?new Game.BadItem(point.x,point.y,null,removeItem,dragItem):new Game.Obstacle(point.x,point.y,null,removeItem,dragItem)},Game.nextStamp=function(stampImage){return stampImage="tankSouth.png"==stampImage?"enemy.png":"enemy.png"==stampImage?"goodItem/1.png":"goodItem/1.png"==stampImage?"badItem/1.png":"badItem/1.png"==stampImage?"obstacle/1.png":"tankSouth.png",stampImage},Game.fadeOut=function(message,callback,delay,wait){checkArgs("fadeOut",arguments,[["number","string","undefined"],["function","string","undefined"],["number","undefined"],["boolean","undefined"]]);var tracker=trackItem("fadeOut",{message:message,callback:callback,delay:delay,wait:wait});callback=callback||function(){},delay=null==delay?2000:delay;var screen=new Shape.Rectangle(0,0,Game.getBounds().width,Game.getBounds().height);screen.fillColor="black",screen.opacity=0;var image=new Raster;image.bounds=Game.getBounds(),image.opacity=0;var text=new Game.Text(message);text.fontSize=30,text.textColor="white",text.visible=!1;var fade={screen:screen,image:image,message:text,callback:callback,delay:delay,wait:wait,_itemTracker:tracker};return screen.onFrame=function(event){fade.wait||(screen.opacity+=0.01,image.opacity+=0.01,1<=screen.opacity&&!text.visible&&(text.visible=!0,text._text.bringToFront(),"string"==typeof callback?Game.setTimeout(function(){Game.reset(),Game.nextLevel(callback)},fade.delay):Game.setTimeout(callback,fade.delay),screen.onFrame=function(){}))},fade},Game.Switch=function(x,y,imageOn,imageOff,obstacle){checkArgs("Switch",[x,y,imageOn,imageOff],["number","number","string",["string","undefined","object"],["object","undefined"]]);var tracker=trackItem("Switch",{x:x,y:y,imageOn:imageOn,imageOff:imageOff,sourceOn:imageOn,sourceOff:imageOff,obstacle:obstacle}),that={};return"object"==typeof imageOff&&(obstacle=imageOff,imageOff=imageOn),that.hiddenBlock=new Game.Obstacle(x,y),that.hiddenBlock.opacity=0,that.imageOn=new Game.Raster(x,y,imageOn),that.imageOff=new Game.Raster(x,y,imageOff),addDefaultProperties(that,Game.Switch),sortOnLoad(that.imageOn),that.imageOff.onLoad=function(){if(this.visible=!1,this._parent)this.sendToBack();else{var that=this;setTimeout(function(){that.onLoad()},100)}},sortOnLoad(that.imageOff),that.hiddenBlock.onFrame=function(e){Game.players&&Game.players.forEach(function(player){var playerBounds=player.image.getHitBounds(),dist=playerBounds.center.subtract(that.hiddenBlock.bounds.center),collision=Math.abs(dist.length)<(playerBounds.width+that.hiddenBlock.bounds.width)/2;!player.touching&&collision?(obstacle.visible=!obstacle.visible,that.onChange(),that.imageOn.visible=!that.imageOn.visible,that.imageOff.visible=!that.imageOff.visible,player.touching=!0):!collision&&(player.touching=!1)})},that._itemTracker=tracker,that},Game.Switch.onChange=function(){},Game.playSound=function(audio,options){var tracker=trackItem("playSound",{audio:audio,options:options});Game.soundOn&&audio&&("string"==typeof audio&&(audio=new Audio(audio)),options&&"object"==typeof options&&Object.keys(options).forEach(function(key){audio[key]=options[key]}),audio.play())},Game.Door=function(x,y,imageClosed,imageOpen,key){checkArgs("Door",arguments,["number","number",["string","undefined"],["string","object"],["object","undefined"]]);var tracker=trackItem("Door",{x:x,y:y,imageClosed:imageClosed,imageOpen:imageOpen,key:key}),b1=new Game.Obstacle(x,y-2);b1.opacity=0,imageClosed=imageClosed||Game.Door.source,"string"!=typeof imageOpen&&(key=imageOpen,imageOpen=imageClosed);var openDoor=new Raster(imageOpen,x,y-1),image=new Raster(imageClosed,x,y);sortOnLoad(openDoor),sortOnLoad(image);var collected=!1;return setupEndObject(image),addDefaultProperties(image,Game.Door),image.onOpen=function(){},image._scaling=image.scaling,Object.defineProperty(image,"scaling",{get:function(){return this.getScaling()},set:function(newValue){this.setScaling(newValue),openDoor.setScaling(newValue),this.scaled=!0,openDoor.scaled=!0}}),image.onFrame=function(event){Game.players.forEach(function(player){var dist=player.image.getHitBounds().center.subtract(image.bounds.center),collision=75>Math.abs(dist.length);collected&&collision&&(image.fade?image.fade.wait=!1:fade=new Game.fadeOut(image.message,image.onFade,image.delay),openDoor.moveAbove(image),image.onOpen(),image.onFrame=null)})},key?(image.key=key,key.onFrame=function(event){Game.players.forEach(function(player){var dist=player.image.getHitBounds().center.subtract(key.bounds.center),collision=25>Math.abs(dist.length);collision&&(key.remove(),collected=!0,image.onUnlock())})}):(collected=!0,image.onUnlock()),image._itemTracker=tracker,image},Game.Door.source="/image/game/obstacle/8.png",Game.Door.onFade=function(){},Game.Door.onOpen=function(){},Game.Door.onUnlock=function(){},Game.Goal=function(x,y,goalImage,activeImage){function onFrameLocked(e){image.checkUnlock()&&("string"==typeof activeImage?(image.source=activeImage,sortOnLoad(image,switchOnFrame)):switchOnFrame())}function switchOnFrame(){image.onUnlock(),image.opacity=unlockedOpacity,image.onFrame=onFrameUnlocked}function onFrameUnlocked(e){Game.players.forEach(function(player){var dist=player.image.getHitBounds().center.subtract(image.bounds.center),collision=Math.abs(dist.length)<hitRadius;collision&&(!image.fade||image.fade.wait)&&(image.onCollect(),Game.playSound(image.hitSound,{playbackRate:2}),image.fade?image.fade.wait=!1:image.fade=Game.fadeOut(image.message,image.onFade,image.delay),image.onFrame=null)})}function attatchOnFrameLocked(){return image._project.view?void(image.onFrame=onFrameLocked):void setTimeout(attatchOnFrameLocked,100)}checkArgs("Goal",arguments,[["number","undefined"],["number","undefined"],["number","string","undefined"],["number","string","undefined"]]);var tracker=trackItem("Goal",{x:x,y:y,goalImage:goalImage,activeImage:activeImage});null==x&&(x=Game.getBounds().width/2),null==y&&(y=Game.getBounds().height/2),goalImage=goalImage||Game.Goal.source;var lockedOpacity="number"==typeof goalImage?goalImage:0,unlockedOpacity="number"==typeof activeImage?activeImage:1,image,hitRadius;return"number"==typeof goalImage&&"number"==typeof activeImage?image=new Raster(Game.Goal.source,x,y):"number"==typeof goalImage?(activeImage=activeImage||Game.Goal.source,image=new Raster(activeImage,x,y)):"string"==typeof goalImage&&null!=activeImage?(lockedOpacity=1,image=new Raster(goalImage,x,y)):image=new Raster(goalImage,x,y),setupEndObject(image),addDefaultProperties(image,Game.Goal),image.checkUnlock=function(){return!!(Game.goodItems.totalCollectedValue>=image.unlockValue)},image.setUnlock=function(c){"number"==typeof c&&(image.unlockValue=c)},image.onLoad=function(){image.opacity=lockedOpacity,attatchOnFrameLocked();var maxScale=this.height>this.width?Game.OBJECT_SIZE/this.height:Game.OBJECT_SIZE/this.width;this.scaled||(this.scaling=maxScale),hitRadius=image.bounds.width>image.bounds.height?(image.bounds.width-image.bounds.height)/2+image.bounds.height:(image.bounds.height-image.bounds.width)/2+image.bounds.width,hitRadius-=10},sortOnLoad(image),image._itemTracker=tracker,image},Game.Goal.source="/image/game/goodItem/2.png",Game.Goal.onCollect=function(){},Game.Goal.onFade=function(){},Game.Goal.onUnlock=function(){},Game.Goal.unlockValue=0;;Game.Teleport=function(x,y,image,dx,dy){checkArgs("Teleport",arguments,[["number","object"],["number","object"],["string","undefined"],["number"],["number"]]);var tracker=trackItem("Teleport",{x:x,y:y,source:image,dx:dx,dy:dy});if(Game.teleports||(Game.teleports=[]),"number"==typeof x){image=image||Game.Teleport.source;var tele=new Raster(image,x,y);return sortOnLoad(tele),Game.teleports.push(tele),tele.onFrame=function(){checkTeleport.call(this,new Point(dx,dy))},tele._itemTracker=tracker,tele}Game.teleports.push(x,y),x.onFrame=function(){checkTeleport.call(this,y.position)},y.onFrame=function(){checkTeleport.call(this,x.position)},sortOnLoad(x),sortOnLoad(y)},Game.Teleport.source="/image/game/goodItem/5.png",Game.downKeys={},Game.DPad=function(w,b,margin){var tracker=trackItem("DPad",{w:w,b:b,margin:margin}),originalKeyIsDown=paper.Key.isDown;paper.Key.isDown=function(key){return!!Game.downKeys[key]||originalKeyIsDown(key)};var width=w,m=margin||5,y=paper.view.bounds.height-w-m,x=m,e=width/8,q=width/4,h=width/2,b=b,o=0.6,pad=new Group,up=new Path;up.add(new Point(x+q+b,y+q)),up.add(new Point(x+h,y)),up.add(new Point(x+q+h-b,y+q)),up.fillColor="darkGray",up.opacity=o,up.onMouseDown=function(e){Game.downKeys.up=!0},up.onMouseUp=function(e){Game.downKeys.up=null},up.onMouseDrag=function(e){this.hitTest(e.point)||(Game.downKeys.up=null),this.hitTest(e.point)&&(Game.downKeys.up=!0)};var down=new Path;down.add(new Point(x+q+b,y+q+h)),down.add(new Point(x+h,y+width)),down.add(new Point(x+q+h-b,y+q+h)),down.fillColor="darkGray",down.opacity=o,down.onMouseDown=function(e){Game.downKeys.down=!0},down.onMouseUp=function(e){Game.downKeys.down=null},down.onMouseDrag=function(e){this.hitTest(e.point)||(Game.downKeys.down=null),this.hitTest(e.point)&&(Game.downKeys.down=!0)};var left=new Path;left.add(new Point(x+q,y+q+b)),left.add(new Point(x,y+h)),left.add(new Point(x+q,y+q+h-b)),left.fillColor="darkGray",left.opacity=o,left.onMouseDown=function(e){Game.downKeys.left=!0},left.onMouseUp=function(e){Game.downKeys.left=null},left.onMouseDrag=function(e){this.hitTest(e.point)||(Game.downKeys.left=null),this.hitTest(e.point)&&(Game.downKeys.left=!0)};var right=new Path;right.add(new Point(x+q+h,y+q+b)),right.add(new Point(x+width,y+h)),right.add(new Point(x+q+h,y+q+h-b)),right.fillColor="darkGray",right.opacity=o,right.onMouseDown=function(e){Game.downKeys.right=!0},right.onMouseUp=function(e){Game.downKeys.right=null},right.onMouseDrag=function(e){this.hitTest(e.point)||(Game.downKeys.right=null),this.hitTest(e.point)&&(Game.downKeys.right=!0)};var thing=new Shape.Rectangle(x,2*y,50,50);pad.addChild(up),pad.addChild(down),pad.addChild(left),pad.addChild(right),pad.addChild(thing)},Game.SoundcloudTracks=["169657357","155714715","152113818","149914850","149914604","144285513","138748059","130525370","106445336","102675875"],Game.setBackgroundMusic=function(track,volume){if(checkArgs("setBackgroundMusic",arguments,[["number","string"],["number","undefined"]]),trackItem("setBackgroundMusic",{track:track,volume:volume}),Game.soundOn){track=track||1;var v=volume||.1;if(!window.SC)return void loadScript("https://connect.soundcloud.com/sdk/sdk-3.1.2.js",function(){SC.initialize({client_id:"6143a4b659c3034b50b389a0a0519da8"}),Game.setBackgroundMusic(track)});Game.BackgroundSong&&Game.BackgroundSong.pause();var path="/tracks/"+track;"number"==typeof track&&track<=Game.SoundcloudTracks.length&&(path="/tracks/"+Game.SoundcloudTracks[track-1]),this.scPlayer&&this.scPlayer.pause(),SC.stream(path).then(function(player){Game.scPlayer=player,player.seek(0),player.play(),player.setVolume(v),Game.BackgroundSong=player})}};for(var getKeys=function(obj){var r=[];for(var k in obj)obj.hasOwnProperty(k)&&r.push(k);return r},gameKeys=getKeys(Game),GAME_OBJECT_RE=/^[A-Z]+[a-z]/,i=0,key;i<gameKeys.length;i++)if(key=gameKeys[i],GAME_OBJECT_RE.test(gameKeys[i])){var camelcase=key.charAt(0).toLowerCase()+key.slice(1),lowercase=key.toLowerCase();Game[lowercase]||(Game[lowercase]=createBadFunctionCallCatcher(lowercase,key)),Game[camelcase]||lowercase==camelcase||(Game[camelcase]=createBadFunctionCallCatcher(camelcase,key))}return paper=new(PaperScope.inject(new Base(Base.exports,{enumerable:!0,Base:Base,Numerical:Numerical,DomElement:DomElement,DomEvent:DomEvent,Http:Http,Key:Key,UI:UI,Game:Game,Sprite:Sprite,Turtle:Turtle,TextInput:TextInput,tkinter:tkinter}))),"function"==typeof define&&define.amd&&define("paper",paper),paper}})(); })();